/*
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
*/
var require={},util=require._=function(){function l(c,b,e){if(c){if(!e){e=b;b=this}if(Object.prototype.toString.call(c)==="[object Array]")for(var h=0;h<c.length;h++)e.call(b,c[h],h);else for(h in c)e.call(b,c[h],h)}}var d=require["api/fin/util"]={exports:{}};d.exports={bind:function(c,b){if(!c||!b||typeof b=="string"&&!c[b])throw"bad bind arguments";var e=Array.prototype.slice.call(arguments,2);return function(){fn=typeof b=="string"?c[b]:b;return fn.apply(c,e.concat(Array.prototype.slice.call(arguments,
0)))}},curry:function(c){var b=Array.prototype.slice.call(arguments,1);return function(){var e=b.concat(Array.prototype.slice.call(arguments,0));c.apply(this,e)}},blockCallback:function(c,b){b=b||{};b.fireOnce=typeof b.fireOnce!="undefined"?b.fireOnce:true;var e=0,h=false,m={addBlock:function(){e++;var u=false;return function(s){if(s&&b.throwErr)throw Error(s);if(u)m.tryNow();else{u=true;e--;setTimeout(m.tryNow)}}},tryNow:function(){if(!(h&&b.fireOnce))if(e==0){h=true;c()}}};return m},each:l,map:function(c,
b){var e=[];l(c,function(h,m){e.push(b(h,m))});return e},pick:function(c,b){for(var e=[],h=0,m;h<c.length;h++)(m=b(c[h]))&&e.push(m);return e},copyArray:function(c){return Array.prototype.slice.call(c,0)},defineGetter:function(c){var b=c.defineGetter?g:c.__defineGetter__?j:Object.defineProperty?a:function(){throw"defineGetter not supported";};d.exports.defineGetter=b;b.apply(this,arguments)}};var g=function(c,b,e){c.defineGetter(b,e)},j=function(c,b,e){c.__defineGetter__(b,e)},a=function(c,b,e){Object.defineProperty(c,
b,{value:e,enumerable:true,configurable:true})};return d.exports}(),Pool=require._=function(){var l=require["api/fin/Pool"]={exports:{}};l.exports=function(){this._pool={};this._counts={};this._uniqueId=0};l.exports.prototype={add:function(d,g){if(!this._pool[d]){this._pool[d]={};this._counts[d]=0}this._counts[d]++;var j="p"+this._uniqueId++;this._pool[d][j]=g;return j},remove:function(d,g){var j=this._pool[d][g];delete this._pool[d][g];if(this._counts[d]--==0){delete this._counts[d];delete this._pool[d]}return j},
get:function(d){return this._pool[d]},count:function(d){return this._counts[d]||0}};return l.exports}(),keys=require._=function(){var l=require["api/fin/keys"]={exports:{}};l.exports={getItemPropertyKey:function(d,g){if(d===undefined||g===undefined)throw Error("itemID and propName are required for keys.getItemPropertyKey");return"I"+d+"@"+g},getKeyInfo:function(d){var g=d[0];d=d.substr(1).split("@");return{type:g,id:parseInt(d[0]),property:d[1]}},getPropertyChannel:function(d){return"#P"+d},getFocusProperty:function(d){return"_focus_"+
d},uniqueIdKey:"__fin_unique_id"};return l.exports}();
require._=function(){function l(a,c){this.target=a;this.remoteTypeCache={};this.remoteInstanceCache={};this.remoteFunctionCache={};this.localFunctionCache={};this.bridgeID=l.nextBridgeID++;this.name=c;this.nextLocalFuncID=0;l.instances[this.name]=this;l.idMap[this.bridgeID]=this;return this}function d(a){this.fb_instance_id=a;return this}var g=require["lib/socket.io/support/socket.io-client/socket.io"]={exports:{}};this.io={version:"0.6.2",setPath:function(a){window.console&&console.error&&console.error("io.setPath will be removed. Please set the variable WEB_SOCKET_SWF_LOCATION pointing to WebSocketMain.swf");
this.path=/\/$/.test(a)?a:a+"/";WEB_SOCKET_SWF_LOCATION=a+"lib/vendor/web-socket-js/WebSocketMain.swf"}};if("jQuery"in this)jQuery.io=this.io;if(typeof window!="undefined")if(typeof WEB_SOCKET_SWF_LOCATION==="undefined")WEB_SOCKET_SWF_LOCATION="/socket.io/lib/vendor/web-socket-js/WebSocketMain.swf";(function(){var a=false;io.util={ios:false,load:function(c){if(/loaded|complete/.test(document.readyState)||a)return c();"attachEvent"in window?window.attachEvent("onload",c):window.addEventListener("load",
c,false)},inherit:function(c,b){for(var e in b.prototype)c.prototype[e]=b.prototype[e]},indexOf:function(c,b,e){var h=c.length;for(e=e<0?Math.max(0,h+e):e||0;e<h;e++)if(c[e]===b)return e;return-1},isArray:function(c){return Object.prototype.toString.call(c)==="[object Array]"},merge:function(c,b){for(var e in b)if(b.hasOwnProperty(e))c[e]=b[e]}};io.util.ios=/iphone|ipad/i.test(navigator.userAgent);io.util.android=/android/i.test(navigator.userAgent);io.util.opera=/opera/i.test(navigator.userAgent);
io.util.load(function(){a=true})})();(function(){Transport=io.Transport=function(a,c){this.base=a;this.options={timeout:15E3};io.util.merge(this.options,c)};Transport.prototype.send=function(){throw Error("Missing send() implementation");};Transport.prototype.connect=function(){throw Error("Missing connect() implementation");};Transport.prototype.disconnect=function(){throw Error("Missing disconnect() implementation");};Transport.prototype._encode=function(a){var c="",b;a=io.util.isArray(a)?a:[a];
for(var e=0,h=a.length;e<h;e++){if(a[e]===null||a[e]===undefined)b="";else{b=a[e];if(Object.prototype.toString.call(b)=="[object Object]")if("JSON"in window)b="~j~"+JSON.stringify(b);else{"console"in window&&console.error&&console.error("Trying to encode as JSON, but JSON.stringify is missing.");b='{ "$error": "Invalid message" }'}else b=String(b)}b=b;c+="~m~"+b.length+"~m~"+b}return c};Transport.prototype._decode=function(a){var c=[],b,e;do{if(a.substr(0,3)!=="~m~")return c;a=a.substr(3);b="";for(var h=
0,m=a.length;h<m;h++){e=Number(a.substr(h,1));if(a.substr(h,1)==e)b+=e;else{a=a.substr(b.length+3);b=Number(b);break}}c.push(a.substr(0,b));a=a.substr(b)}while(a!=="");return c};Transport.prototype._onData=function(a){this._setTimeout();if((a=this._decode(a))&&a.length)for(var c=0,b=a.length;c<b;c++)this._onMessage(a[c])};Transport.prototype._setTimeout=function(){var a=this;this._timeout&&clearTimeout(this._timeout);this._timeout=setTimeout(function(){a._onTimeout()},this.options.timeout)};Transport.prototype._onTimeout=
function(){this._onDisconnect()};Transport.prototype._onMessage=function(a){if(this.sessionid)if(a.substr(0,3)=="~h~")this._onHeartbeat(a.substr(3));else a.substr(0,3)=="~j~"?this.base._onMessage(JSON.parse(a.substr(3))):this.base._onMessage(a);else{this.sessionid=a;this._onConnect()}};Transport.prototype._onHeartbeat=function(a){this.send("~h~"+a)};Transport.prototype._onConnect=function(){this.connected=true;this.connecting=false;this.base._onConnect();this._setTimeout()};Transport.prototype._onDisconnect=
function(){this.connected=this.connecting=false;this.sessionid=null;this.base._onDisconnect()};Transport.prototype._prepareUrl=function(){return(this.base.options.secure?"https":"http")+"://"+this.base.host+":"+this.base.options.port+"/"+this.base.options.resource+"/"+this.type+(this.sessionid?"/"+this.sessionid:"/")}})();(function(){var a=new Function,c;c="XMLHttpRequest"in window?(new XMLHttpRequest).withCredentials!=undefined:false;var b=function(h){if("XDomainRequest"in window&&h)return new XDomainRequest;
if("XMLHttpRequest"in window&&(!h||c))return new XMLHttpRequest;if(!h){try{return new ActiveXObject("MSXML2.XMLHTTP")}catch(m){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(u){}}return false},e=io.Transport.XHR=function(){io.Transport.apply(this,arguments);this._sendBuffer=[]};io.util.inherit(e,io.Transport);e.prototype.connect=function(){this._get();return this};e.prototype._checkSend=function(){if(!this._posting&&this._sendBuffer.length){var h=this._encode(this._sendBuffer);this._sendBuffer=
[];this._send(h)}};e.prototype.send=function(h){io.util.isArray(h)?this._sendBuffer.push.apply(this._sendBuffer,h):this._sendBuffer.push(h);this._checkSend();return this};e.prototype._send=function(h){var m=this;this._posting=true;this._sendXhr=this._request("send","POST");this._sendXhr.onreadystatechange=function(){var u;if(m._sendXhr.readyState==4){m._sendXhr.onreadystatechange=a;try{u=m._sendXhr.status}catch(s){}m._posting=false;u==200?m._checkSend():m._onDisconnect()}};this._sendXhr.send("data="+
encodeURIComponent(h))};e.prototype.disconnect=function(){this._onDisconnect();return this};e.prototype._onDisconnect=function(){if(this._xhr){this._xhr.onreadystatechange=a;try{this._xhr.abort()}catch(h){}this._xhr=null}if(this._sendXhr){this._sendXhr.onreadystatechange=a;try{this._sendXhr.abort()}catch(m){}this._sendXhr=null}this._sendBuffer=[];io.Transport.prototype._onDisconnect.call(this)};e.prototype._request=function(h,m,u){var s=b(this.base._isXDomain());if(u)s.multipart=true;s.open(m||"GET",
this._prepareUrl()+(h?"/"+h:""));m=="POST"&&"setRequestHeader"in s&&s.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8");return s};e.check=function(h){try{if(b(h))return true}catch(m){}return false};e.xdomainCheck=function(){return e.check(true)};e.request=b})();(function(){var a=io.Transport.websocket=function(){io.Transport.apply(this,arguments)};io.util.inherit(a,io.Transport);a.prototype.type="websocket";a.prototype.connect=function(){var c=this;this.socket=new WebSocket(this._prepareUrl());
this.socket.onmessage=function(b){c._onData(b.data)};this.socket.onclose=function(){c._onClose()};this.socket.onerror=function(b){c._onError(b)};return this};a.prototype.send=function(c){this.socket&&this.socket.send(this._encode(c));return this};a.prototype.disconnect=function(){this.socket&&this.socket.close();return this};a.prototype._onClose=function(){this._onDisconnect();return this};a.prototype._onError=function(c){this.base.emit("error",[c])};a.prototype._prepareUrl=function(){return(this.base.options.secure?
"wss":"ws")+"://"+this.base.host+":"+this.base.options.port+"/"+this.base.options.resource+"/"+this.type+(this.sessionid?"/"+this.sessionid:"")};a.check=function(){return"WebSocket"in window&&WebSocket.prototype&&WebSocket.prototype.send&&!!WebSocket.prototype.send.toString().match(/native/i)&&typeof WebSocket!=="undefined"};a.xdomainCheck=function(){return true}})();(function(){var a=io.Transport.flashsocket=function(){io.Transport.websocket.apply(this,arguments)};io.util.inherit(a,io.Transport.websocket);
a.prototype.type="flashsocket";a.prototype.connect=function(){var c=this,b=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.connect.apply(c,b)});return this};a.prototype.send=function(){var c=this,b=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.send.apply(c,b)});return this};a.check=function(){if(typeof WebSocket=="undefined"||!("__addTask"in WebSocket))return false;if(io.util.opera)return false;if("navigator"in window&&"plugins"in navigator&&navigator.plugins["Shockwave Flash"])return!!navigator.plugins["Shockwave Flash"].description;
if("ActiveXObject"in window)try{return!!(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(c){}return false};a.xdomainCheck=function(){return true}})();(function(){var a=io.Transport.htmlfile=function(){io.Transport.XHR.apply(this,arguments)};io.util.inherit(a,io.Transport.XHR);a.prototype.type="htmlfile";a.prototype._get=function(){var c=this;this._open();window.attachEvent("onunload",function(){c._destroy()})};a.prototype._open=function(){this._doc=new ActiveXObject("htmlfile");
this._doc.open();this._doc.write("<html></html>");this._doc.parentWindow.s=this;this._doc.close();var c=this._doc.createElement("div");this._doc.body.appendChild(c);this._iframe=this._doc.createElement("iframe");c.appendChild(this._iframe);this._iframe.src=this._prepareUrl()+"/"+ +new Date};a.prototype._=function(c,b){this._onData(c);var e=b.getElementsByTagName("script")[0];e.parentNode.removeChild(e)};a.prototype._destroy=function(){if(this._iframe){this._iframe.src="about:blank";this._doc=null;
CollectGarbage()}};a.prototype.disconnect=function(){this._destroy();return io.Transport.XHR.prototype.disconnect.call(this)};a.check=function(){if("ActiveXObject"in window)try{return new ActiveXObject("htmlfile")&&io.Transport.XHR.check()}catch(c){}return false};a.xdomainCheck=function(){return false}})();(function(){var a=io.Transport["xhr-multipart"]=function(){io.Transport.XHR.apply(this,arguments)};io.util.inherit(a,io.Transport.XHR);a.prototype.type="xhr-multipart";a.prototype._get=function(){var c=
this;this._xhr=this._request("","GET",true);this._xhr.onreadystatechange=function(){c._xhr.readyState==4&&c._onData(c._xhr.responseText)};this._xhr.send(null)};a.check=function(){return"XMLHttpRequest"in window&&"prototype"in XMLHttpRequest&&"multipart"in XMLHttpRequest.prototype};a.xdomainCheck=function(){return true}})();(function(){var a=new Function,c=io.Transport["xhr-polling"]=function(){io.Transport.XHR.apply(this,arguments)};io.util.inherit(c,io.Transport.XHR);c.prototype.type="xhr-polling";
c.prototype.connect=function(){if(io.util.ios||io.util.android){var b=this;io.util.load(function(){setTimeout(function(){io.Transport.XHR.prototype.connect.call(b)},10)})}else io.Transport.XHR.prototype.connect.call(this)};c.prototype._get=function(){var b=this;this._xhr=this._request(+new Date,"GET");this._xhr.onreadystatechange=function(){var e;if(b._xhr.readyState==4){b._xhr.onreadystatechange=a;try{e=b._xhr.status}catch(h){}if(e==200){b._onData(b._xhr.responseText);b._get()}else b._onDisconnect()}};
this._xhr.send(null)};c.check=function(){return io.Transport.XHR.check()};c.xdomainCheck=function(){return io.Transport.XHR.xdomainCheck()}})();io.JSONP=[];JSONPPolling=io.Transport["jsonp-polling"]=function(){io.Transport.XHR.apply(this,arguments);this._insertAt=document.getElementsByTagName("script")[0];this._index=io.JSONP.length;io.JSONP.push(this)};io.util.inherit(JSONPPolling,io.Transport["xhr-polling"]);JSONPPolling.prototype.type="jsonp-polling";JSONPPolling.prototype._send=function(a){function c(){b();
e._posting=false;e._checkSend()}function b(){e._iframe&&e._form.removeChild(e._iframe);try{s=document.createElement('<iframe name="'+e._iframeId+'">')}catch(L){s=document.createElement("iframe");s.name=e._iframeId}s.id=e._iframeId;e._form.appendChild(s);e._iframe=s}var e=this;if(!("_form"in this)){var h=document.createElement("FORM"),m=document.createElement("TEXTAREA"),u=this._iframeId="socket_io_iframe_"+this._index,s;h.style.position="absolute";h.style.top="-1000px";h.style.left="-1000px";h.target=
u;h.method="POST";h.action=this._prepareUrl()+"/"+ +new Date+"/"+this._index;m.name="data";h.appendChild(m);this._insertAt.parentNode.insertBefore(h,this._insertAt);document.body.appendChild(h);this._form=h;this._area=m}b();this._posting=true;this._area.value=a;try{this._form.submit()}catch(Y){}if(this._iframe.attachEvent)s.onreadystatechange=function(){e._iframe.readyState=="complete"&&c()};else this._iframe.onload=c};JSONPPolling.prototype._get=function(){var a=this,c=document.createElement("SCRIPT");
if(this._script){this._script.parentNode.removeChild(this._script);this._script=null}c.async=true;c.src=this._prepareUrl()+"/"+ +new Date+"/"+this._index;c.onerror=function(){a._onDisconnect()};this._insertAt.parentNode.insertBefore(c,this._insertAt);this._script=c};JSONPPolling.prototype._=function(){this._onData.apply(this,arguments);this._get();return this};JSONPPolling.check=function(){return true};JSONPPolling.xdomainCheck=function(){return true};(function(){var a=io.Socket=function(c,b){this.host=
c||document.domain;this.options={secure:false,document:document,port:document.location.port||80,resource:"socket.io",transports:["websocket","flashsocket","htmlfile","xhr-multipart","xhr-polling","jsonp-polling"],transportOptions:{"xhr-polling":{timeout:25E3},"jsonp-polling":{timeout:25E3}},connectTimeout:5E3,tryTransportsOnConnectTimeout:true,rememberTransport:true};io.util.merge(this.options,b);this.connecting=this.connected=false;this._events={};this.transport=this.getTransport();!this.transport&&
"console"in window&&console.error("No transport available")};a.prototype.getTransport=function(c){var b=c||this.options.transports;if(this.options.rememberTransport&&!c)if(c=this.options.document.cookie.match("(?:^|;)\\s*socketio=([^;]*)")){this._rememberedTransport=true;b=[decodeURIComponent(c[1])]}c=0;for(var e;e=b[c];c++)if(io.Transport[e]&&io.Transport[e].check()&&(!this._isXDomain()||io.Transport[e].xdomainCheck()))return new io.Transport[e](this,this.options.transportOptions[e]||{});return null};
a.prototype.connect=function(){if(this.transport&&!this.connected){this.connecting&&this.disconnect();this.connecting=true;this.emit("connecting",[this.transport.type]);this.transport.connect();if(this.options.connectTimeout){var c=this;this.connectTimeoutTimer=setTimeout(function(){if(!c.connected){c.disconnect();if(c.options.tryTransportsOnConnectTimeout&&!c._rememberedTransport){if(!c._remainingTransports)c._remainingTransports=c.options.transports.slice(0);for(var b=c._remainingTransports;b.length>
0&&b.splice(0,1)[0]!=c.transport.type;);if(b.length){c.transport=c.getTransport(b);c.connect()}}if(!c._remainingTransports||c._remainingTransports.length==0)c.emit("connect_failed")}c._remainingTransports&&c._remainingTransports.length==0&&delete c._remainingTransports},this.options.connectTimeout)}}return this};a.prototype.send=function(c){if(!this.transport||!this.transport.connected)return this._queue(c);this.transport.send(c);return this};a.prototype.disconnect=function(){this.connectTimeoutTimer&&
clearTimeout(this.connectTimeoutTimer);this.transport.disconnect();return this};a.prototype.on=function(c,b){c in this._events||(this._events[c]=[]);this._events[c].push(b);return this};a.prototype.emit=function(c,b){if(c in this._events)for(var e=this._events[c].concat(),h=0,m=e.length;h<m;h++)e[h].apply(this,b===undefined?[]:b);return this};a.prototype.removeEvent=function(c,b){if(c in this._events)for(var e=0,h=this._events[c].length;e<h;e++)this._events[c][e]==b&&this._events[c].splice(e,1);return this};
a.prototype._queue=function(c){if(!("_queueStack"in this))this._queueStack=[];this._queueStack.push(c);return this};a.prototype._doQueue=function(){if(!("_queueStack"in this)||!this._queueStack.length)return this;this.transport.send(this._queueStack);this._queueStack=[];return this};a.prototype._isXDomain=function(){return this.host!==document.domain};a.prototype._onConnect=function(){this.connected=true;this.connecting=false;this._doQueue();if(this.options.rememberTransport)this.options.document.cookie=
"socketio="+encodeURIComponent(this.transport.type);this.emit("connect")};a.prototype._onMessage=function(c){this.emit("message",[c])};a.prototype._onDisconnect=function(){var c=this.connected;this.connecting=this.connected=false;this._queueStack=[];c&&this.emit("disconnect")};a.prototype.fire=a.prototype.emit;a.prototype.addListener=a.prototype.addEvent=a.prototype.addEventListener=a.prototype.on})();var j=function(){function a(){if(!G){try{var f=q.getElementsByTagName("body")[0].appendChild(q.createElement("span"));
f.parentNode.removeChild(f)}catch(i){return}G=true;f=M.length;for(var k=0;k<f;k++)M[k]()}}function c(f){if(G)f();else M[M.length]=f}function b(f){if(typeof y.addEventListener!=v)y.addEventListener("load",f,false);else if(typeof q.addEventListener!=v)q.addEventListener("load",f,false);else if(typeof y.attachEvent!=v)fa(y,"onload",f);else if(typeof y.onload=="function"){var i=y.onload;y.onload=function(){i();f()}}else y.onload=f}function e(){var f=q.getElementsByTagName("body")[0],i=q.createElement(A);
i.setAttribute("type",N);var k=f.appendChild(i);if(k){var n=0;(function(){if(typeof k.GetVariable!=v){var o=k.GetVariable("$version");if(o){o=o.split(" ")[1].split(",");p.pv=[parseInt(o[0],10),parseInt(o[1],10),parseInt(o[2],10)]}}else if(n<10){n++;setTimeout(arguments.callee,10);return}f.removeChild(i);k=null;h()})()}else h()}function h(){var f=D.length;if(f>0)for(var i=0;i<f;i++){var k=D[i].id,n=D[i].callbackFn,o={success:false,id:k};if(p.pv[0]>0){var t=z(k);if(t)if(O(D[i].swfVersion)&&!(p.wk&&
p.wk<312)){H(k,true);if(n){o.success=true;o.ref=m(k);n(o)}}else if(D[i].expressInstall&&u()){o={};o.data=D[i].expressInstall;o.width=t.getAttribute("width")||"0";o.height=t.getAttribute("height")||"0";if(t.getAttribute("class"))o.styleclass=t.getAttribute("class");if(t.getAttribute("align"))o.align=t.getAttribute("align");var r={};t=t.getElementsByTagName("param");for(var w=t.length,x=0;x<w;x++)if(t[x].getAttribute("name").toLowerCase()!="movie")r[t[x].getAttribute("name")]=t[x].getAttribute("value");
s(o,r,k,n)}else{Y(t);n&&n(o)}}else{H(k,true);if(n){if((k=m(k))&&typeof k.SetVariable!=v){o.success=true;o.ref=k}n(o)}}}}function m(f){var i=null;if((f=z(f))&&f.nodeName=="OBJECT")if(typeof f.SetVariable!=v)i=f;else if(f=f.getElementsByTagName(A)[0])i=f;return i}function u(){return!P&&O("6.0.65")&&(p.win||p.mac)&&!(p.wk&&p.wk<312)}function s(f,i,k,n){P=true;V=n||null;Z={success:false,id:k};var o=z(k);if(o){if(o.nodeName=="OBJECT"){J=L(o);Q=null}else{J=o;Q=k}f.id=$;if(typeof f.width==v||!/%$/.test(f.width)&&
parseInt(f.width,10)<310)f.width="310";if(typeof f.height==v||!/%$/.test(f.height)&&parseInt(f.height,10)<137)f.height="137";q.title=q.title.slice(0,47)+" - Flash Player Installation";n=p.ie&&p.win?"ActiveX":"PlugIn";n="MMredirectURL="+y.location.toString().replace(/&/g,"%26")+"&MMplayerType="+n+"&MMdoctitle="+q.title;if(typeof i.flashvars!=v)i.flashvars+="&"+n;else i.flashvars=n;if(p.ie&&p.win&&o.readyState!=4){n=q.createElement("div");k+="SWFObjectNew";n.setAttribute("id",k);o.parentNode.insertBefore(n,
o);o.style.display="none";(function(){o.readyState==4?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)})()}W(f,i,k)}}function Y(f){if(p.ie&&p.win&&f.readyState!=4){var i=q.createElement("div");f.parentNode.insertBefore(i,f);i.parentNode.replaceChild(L(f),i);f.style.display="none";(function(){f.readyState==4?f.parentNode.removeChild(f):setTimeout(arguments.callee,10)})()}else f.parentNode.replaceChild(L(f),f)}function L(f){var i=q.createElement("div");if(p.win&&p.ie)i.innerHTML=f.innerHTML;
else if(f=f.getElementsByTagName(A)[0])if(f=f.childNodes)for(var k=f.length,n=0;n<k;n++)!(f[n].nodeType==1&&f[n].nodeName=="PARAM")&&f[n].nodeType!=8&&i.appendChild(f[n].cloneNode(true));return i}function W(f,i,k){var n,o=z(k);if(p.wk&&p.wk<312)return n;if(o){if(typeof f.id==v)f.id=k;if(p.ie&&p.win){var t="";for(var r in f)if(f[r]!=Object.prototype[r])if(r.toLowerCase()=="data")i.movie=f[r];else if(r.toLowerCase()=="styleclass")t+=' class="'+f[r]+'"';else if(r.toLowerCase()!="classid")t+=" "+r+'="'+
f[r]+'"';r="";for(var w in i)if(i[w]!=Object.prototype[w])r+='<param name="'+w+'" value="'+i[w]+'" />';o.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+t+">"+r+"</object>";R[R.length]=f.id;n=z(f.id)}else{w=q.createElement(A);w.setAttribute("type",N);for(var x in f)if(f[x]!=Object.prototype[x])if(x.toLowerCase()=="styleclass")w.setAttribute("class",f[x]);else x.toLowerCase()!="classid"&&w.setAttribute(x,f[x]);for(t in i)if(i[t]!=Object.prototype[t]&&t.toLowerCase()!="movie"){f=
w;r=t;x=i[t];k=q.createElement("param");k.setAttribute("name",r);k.setAttribute("value",x);f.appendChild(k)}o.parentNode.replaceChild(w,o);n=w}}return n}function aa(f){var i=z(f);if(i&&i.nodeName=="OBJECT")if(p.ie&&p.win){i.style.display="none";(function(){if(i.readyState==4){var k=z(f);if(k){for(var n in k)if(typeof k[n]=="function")k[n]=null;k.parentNode.removeChild(k)}}else setTimeout(arguments.callee,10)})()}else i.parentNode.removeChild(i)}function z(f){var i=null;try{i=q.getElementById(f)}catch(k){}return i}
function fa(f,i,k){f.attachEvent(i,k);I[I.length]=[f,i,k]}function O(f){var i=p.pv;f=f.split(".");f[0]=parseInt(f[0],10);f[1]=parseInt(f[1],10)||0;f[2]=parseInt(f[2],10)||0;return i[0]>f[0]||i[0]==f[0]&&i[1]>f[1]||i[0]==f[0]&&i[1]==f[1]&&i[2]>=f[2]?true:false}function ba(f,i,k,n){if(!(p.ie&&p.mac)){var o=q.getElementsByTagName("head")[0];if(o){k=k&&typeof k=="string"?k:"screen";if(n)X=B=null;if(!B||X!=k){n=q.createElement("style");n.setAttribute("type","text/css");n.setAttribute("media",k);B=o.appendChild(n);
if(p.ie&&p.win&&typeof q.styleSheets!=v&&q.styleSheets.length>0)B=q.styleSheets[q.styleSheets.length-1];X=k}if(p.ie&&p.win)B&&typeof B.addRule==A&&B.addRule(f,i);else B&&typeof q.createTextNode!=v&&B.appendChild(q.createTextNode(f+" {"+i+"}"))}}}function H(f,i){if(ca){var k=i?"visible":"hidden";if(G&&z(f))z(f).style.visibility=k;else ba("#"+f,"visibility:"+k)}}function da(f){return/[\\\"<>\.;]/.exec(f)!=null&&typeof encodeURIComponent!=v?encodeURIComponent(f):f}var v="undefined",A="object",N="application/x-shockwave-flash",
$="SWFObjectExprInst",y=window,q=document,E=navigator,ea=false,M=[function(){ea?e():h()}],D=[],R=[],I=[],J,Q,V,Z,G=false,P=false,B,X,ca=true,p=function(){var f=typeof q.getElementById!=v&&typeof q.getElementsByTagName!=v&&typeof q.createElement!=v,i=E.userAgent.toLowerCase(),k=E.platform.toLowerCase(),n=k?/win/.test(k):/win/.test(i);k=k?/mac/.test(k):/mac/.test(i);i=/webkit/.test(i)?parseFloat(i.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false;var o=!+"\u000b1",t=[0,0,0],r=null;if(typeof E.plugins!=
v&&typeof E.plugins["Shockwave Flash"]==A){if((r=E.plugins["Shockwave Flash"].description)&&!(typeof E.mimeTypes!=v&&E.mimeTypes[N]&&!E.mimeTypes[N].enabledPlugin)){ea=true;o=false;r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1");t[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10);t[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10);t[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof y.ActiveXObject!=v)try{var w=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(w)if(r=w.GetVariable("$version")){o=
true;r=r.split(" ")[1].split(",");t=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]}}catch(x){}return{w3:f,pv:t,wk:i,ie:o,win:n,mac:k}}();(function(){if(p.w3){if(typeof q.readyState!=v&&q.readyState=="complete"||typeof q.readyState==v&&(q.getElementsByTagName("body")[0]||q.body))a();if(!G){typeof q.addEventListener!=v&&q.addEventListener("DOMContentLoaded",a,false);if(p.ie&&p.win){q.attachEvent("onreadystatechange",function(){if(q.readyState=="complete"){q.detachEvent("onreadystatechange",
arguments.callee);a()}});y==top&&function(){if(!G){try{q.documentElement.doScroll("left")}catch(f){setTimeout(arguments.callee,0);return}a()}}()}p.wk&&function(){G||(/loaded|complete/.test(q.readyState)?a():setTimeout(arguments.callee,0))}();b(a)}}})();(function(){p.ie&&p.win&&window.attachEvent("onunload",function(){for(var f=I.length,i=0;i<f;i++)I[i][0].detachEvent(I[i][1],I[i][2]);f=R.length;for(i=0;i<f;i++)aa(R[i]);for(var k in p)p[k]=null;p=null;for(var n in j)j[n]=null;j=null})})();return{registerObject:function(f,
i,k,n){if(p.w3&&f&&i){var o={};o.id=f;o.swfVersion=i;o.expressInstall=k;o.callbackFn=n;D[D.length]=o;H(f,false)}else n&&n({success:false,id:f})},getObjectById:function(f){if(p.w3)return m(f)},embedSWF:function(f,i,k,n,o,t,r,w,x,K){var S={success:false,id:i};if(p.w3&&!(p.wk&&p.wk<312)&&f&&i&&k&&n&&o){H(i,false);c(function(){k+="";n+="";var F={};if(x&&typeof x===A)for(var C in x)F[C]=x[C];F.data=f;F.width=k;F.height=n;C={};if(w&&typeof w===A)for(var T in w)C[T]=w[T];if(r&&typeof r===A)for(var U in r)if(typeof C.flashvars!=
v)C.flashvars+="&"+U+"="+r[U];else C.flashvars=U+"="+r[U];if(O(o)){T=W(F,C,i);F.id==i&&H(i,true);S.success=true;S.ref=T}else if(t&&u()){F.data=t;s(F,C,i,K);return}else H(i,true);K&&K(S)})}else K&&K(S)},switchOffAutoHideShow:function(){ca=false},ua:p,getFlashPlayerVersion:function(){return{major:p.pv[0],minor:p.pv[1],release:p.pv[2]}},hasFlashPlayerVersion:O,createSWF:function(f,i,k){if(p.w3)return W(f,i,k)},showExpressInstall:function(f,i,k,n){p.w3&&u()&&s(f,i,k,n)},removeSWF:function(f){p.w3&&aa(f)},
createCSS:function(f,i,k,n){p.w3&&ba(f,i,k,n)},addDomLoadEvent:c,addLoadEvent:b,getQueryParamValue:function(f){var i=q.location.search||q.location.hash;if(i){if(/\?/.test(i))i=i.split("?")[1];if(f==null)return da(i);i=i.split("&");for(var k=0;k<i.length;k++)if(i[k].substring(0,i[k].indexOf("="))==f)return da(i[k].substring(i[k].indexOf("=")+1))}return""},expressInstallCallback:function(){if(P){var f=z($);if(f&&J){f.parentNode.replaceChild(J,f);if(Q){H(Q,true);if(p.ie&&p.win)J.style.display="block"}V&&
V(Z)}P=false}}}}();l.TYPE_ASINSTANCE=1;l.TYPE_ASFUNCTION=2;l.TYPE_JSFUNCTION=3;l.TYPE_ANONYMOUS=4;l.initCallbacks={};l.userTypes={};l.addToUserTypes=function(){for(var a=0;a<arguments.length;a++)l.userTypes[arguments[a]]={typeName:arguments[a],enriched:false}};l.argsToArray=function(a){for(var c=[],b=0;b<a.length;b++)c[b]=a[b];return c};l.addInitializationCallback=function(a,c){var b=l.instances[a];if(b!=undefined)c.call(b);else{b=l.initCallbacks[a];if(b==null)l.initCallbacks[a]=b=[];b.push(c)}};
l.nextBridgeID=0;l.instances={};l.idMap={};l.refCount=0;l.extractBridgeFromID=function(a){return l.idMap[a>>16]};l.attachBridge=function(a,c){var b=new l(a,c);l[c]=b;var e=l.initCallbacks[c];if(e!=null){for(var h=0;h<e.length;h++)e[h].call(b);delete l.initCallbacks[c]}};l.blockedMethods={toString:true,get:true,set:true,call:true};l.prototype={root:function(){return this.deserialize(this.target.getRoot())},releaseASObjects:function(){return this.target.releaseASObjects()},releaseNamedASObject:function(a){return typeof a!=
"object"?false:this.target.releaseNamedASObject(a.fb_instance_id)},create:function(a){return this.deserialize(this.target.create(a))},makeID:function(a){return(this.bridgeID<<16)+a},getPropertyFromAS:function(a,c){if(l.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{l.refCount++;retVal=this.target.getPropFromAS(a,c);retVal=this.handleError(retVal);l.refCount--;
return retVal}},setPropertyInAS:function(a,c,b){if(l.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{l.refCount++;retVal=this.target.setPropInAS(a,c,this.serialize(b));retVal=this.handleError(retVal);l.refCount--;return retVal}},callASFunction:function(a,c){if(l.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");
else{l.refCount++;retVal=this.target.invokeASFunction(a,this.serialize(c));retVal=this.handleError(retVal);l.refCount--;return retVal}},callASMethod:function(a,c,b){if(l.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{l.refCount++;b=this.serialize(b);retVal=this.target.invokeASMethod(a,c,b);retVal=this.handleError(retVal);l.refCount--;return retVal}},invokeLocalFunction:function(a,
c){var b,e=this.localFunctionCache[a];if(e!=undefined)b=this.serialize(e.apply(null,this.deserialize(c)));return b},getTypeFromName:function(a){return this.remoteTypeCache[a]},createProxy:function(a,c){var b=this.getTypeFromName(c);d.prototype=b;b=new d(a);return this.remoteInstanceCache[a]=b},getProxy:function(a){return this.remoteInstanceCache[a]},addTypeDataToCache:function(a){for(var c=new ASProxy(this,a.name),b=a.accessors,e=0;e<b.length;e++)this.addPropertyToType(c,b[e]);a=a.methods;for(e=0;e<
a.length;e++)l.blockedMethods[a[e]]==undefined&&this.addMethodToType(c,a[e]);return this.remoteTypeCache[c.typeName]=c},addPropertyToType:function(a,c){var b=c.charAt(0),e;if(b>="a"&&b<="z"){e="get"+b.toUpperCase()+c.substr(1);b="set"+b.toUpperCase()+c.substr(1)}else{e="get"+c;b="set"+c}a[b]=function(h){this.bridge.setPropertyInAS(this.fb_instance_id,c,h)};a[e]=function(){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,c))}},addMethodToType:function(a,c){a[c]=function(){return this.bridge.deserialize(this.bridge.callASMethod(this.fb_instance_id,
c,l.argsToArray(arguments)))}},getFunctionProxy:function(a){var c=this;if(this.remoteFunctionCache[a]==null)this.remoteFunctionCache[a]=function(){c.callASFunction(a,l.argsToArray(arguments))};return this.remoteFunctionCache[a]},getFunctionID:function(a){if(a.__bridge_id__==undefined){a.__bridge_id__=this.makeID(this.nextLocalFuncID++);this.localFunctionCache[a.__bridge_id__]=a}return a.__bridge_id__},serialize:function(a){var c={},b=typeof a;if(b=="number"||b=="string"||b=="boolean"||b==null||b==
undefined)c=a;else if(a instanceof Array){c=[];for(b=0;b<a.length;b++)c[b]=this.serialize(a[b])}else if(b=="function"){c.type=l.TYPE_JSFUNCTION;c.value=this.getFunctionID(a)}else if(a instanceof ASProxy){c.type=l.TYPE_ASINSTANCE;c.value=a.fb_instance_id}else{c.type=l.TYPE_ANONYMOUS;c.value=a}return c},deserialize:function(a){var c,b=typeof a;if(b=="number"||b=="string"||b=="boolean"||a==null||a==undefined)c=this.handleError(a);else if(a instanceof Array){c=[];for(b=0;b<a.length;b++)c[b]=this.deserialize(a[b])}else if(b==
"object"){for(b=0;b<a.newTypes.length;b++)this.addTypeDataToCache(a.newTypes[b]);for(var e in a.newRefs)this.createProxy(e,a.newRefs[e]);if(a.type==l.TYPE_PRIMITIVE)c=a.value;else if(a.type==l.TYPE_ASFUNCTION)c=this.getFunctionProxy(a.value);else if(a.type==l.TYPE_ASINSTANCE)c=this.getProxy(a.value);else if(a.type==l.TYPE_ANONYMOUS)c=a.value}return c},addRef:function(a){this.target.incRef(a.fb_instance_id)},release:function(a){this.target.releaseRef(a.fb_instance_id)},handleError:function(a){if(typeof a==
"string"&&a.indexOf("__FLASHERROR")==0){a=a.split("||");l.refCount>0&&l.refCount--;throw Error(a[1]);}return a}};ASProxy=function(a,c){this.bridge=a;this.typeName=c;return this};ASProxy.prototype={get:function(a){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,a))},set:function(a,c){this.bridge.setPropertyInAS(this.fb_instance_id,a,c)},call:function(a,c){this.bridge.callASMethod(this.fb_instance_id,a,c)},addRef:function(){this.bridge.addRef(this)},release:function(){this.bridge.release(this)}};
(function(){function a(){}if(!window.WebSocket){var c=window.console;if(!c||!c.log||!c.error)c={log:function(){},error:function(){}};if(j.hasFlashPlayerVersion("9.0.0")){location.protocol=="file:"&&c.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://...");WebSocket=function(b,e,h,m,u){var s=this;s.readyState=WebSocket.CONNECTING;s.bufferedAmount=0;setTimeout(function(){WebSocket.__addTask(function(){s.__createFlash(b,
e,h,m,u)})},0)};WebSocket.prototype.__createFlash=function(b,e,h,m,u){var s=this;s.__flash=WebSocket.__flash.create(b,e,h||null,m||0,u||null);s.__flash.addEventListener("event",function(){setTimeout(function(){s.__handleEvents()},0)})};WebSocket.prototype.send=function(b){if(!this.__flash||this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";b=this.__flash.send(encodeURIComponent(b));if(b<0)return true;else{this.bufferedAmount+=b;return false}};
WebSocket.prototype.close=function(){if(this.__flash)if(!(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING)){this.__flash.close();this.readyState=WebSocket.CLOSED;this.__timer&&clearInterval(this.__timer);this.onclose&&setTimeout(this.onclose,0)}};WebSocket.prototype.addEventListener=function(b,e){if(!("__events"in this))this.__events={};if(!(b in this.__events)){this.__events[b]=[];if("function"==typeof this["on"+b]){this.__events[b].defaultHandler=this["on"+b];this["on"+b]=
this.__createEventHandler(this,b)}}this.__events[b].push(e)};WebSocket.prototype.removeEventListener=function(b,e){if(!("__events"in this))this.__events={};if(b in this.__events)for(var h=this.__events.length;h>-1;--h)if(e===this.__events[b][h]){this.__events[b].splice(h,1);break}};WebSocket.prototype.dispatchEvent=function(b){if(!("__events"in this))throw"UNSPECIFIED_EVENT_TYPE_ERR";if(!(b.type in this.__events))throw"UNSPECIFIED_EVENT_TYPE_ERR";for(var e=0,h=this.__events[b.type].length;e<h;++e){this.__events[b.type][e](b);
if(b.cancelBubble)break}false!==b.returnValue&&"function"==typeof this.__events[b.type].defaultHandler&&this.__events[b.type].defaultHandler(b)};WebSocket.prototype.__handleEvents=function(){for(var b=this.__flash.receiveEvents(),e=0;e<b.length;e++)try{var h=b[e];if("readyState"in h)this.readyState=h.readyState;if(h.type=="open"){this.__timer&&clearInterval(this.__timer);if(window.opera)this.__timer=setInterval(function(){this.__handleEvents()},500);this.onopen&&this.onopen()}else if(h.type=="close"){this.__timer&&
clearInterval(this.__timer);this.onclose&&this.onclose()}else if(h.type=="message"){if(this.onmessage){var m=decodeURIComponent(h.data),u;if(window.MessageEvent&&!window.opera){u=document.createEvent("MessageEvent");u.initMessageEvent("message",false,false,m,null,null,window,null)}else u={data:m};this.onmessage(u)}}else if(h.type=="error"){this.__timer&&clearInterval(this.__timer);this.onerror&&this.onerror()}else throw"unknown event type: "+h.type;}catch(s){c.error(s.toString())}};WebSocket.prototype.__createEventHandler=
function(b,e){return function(h){var m=new a;m.initEvent(e,true,true);m.target=m.currentTarget=b;for(var u in h)m[u]=h[u];b.dispatchEvent(m,arguments)}};a.prototype.cancelable=true;a.prototype.cancelBubble=false;a.prototype.preventDefault=function(){if(this.cancelable)this.returnValue=false};a.prototype.stopPropagation=function(){this.cancelBubble=true};a.prototype.initEvent=function(b,e,h){this.type=b;this.cancelable=h;this.timeStamp=new Date};WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=
2;WebSocket.CLOSED=3;WebSocket.__tasks=[];WebSocket.loadFlashPolicyFile=function(b){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(b)})};WebSocket.__initialize=function(){if(WebSocket.__swfLocation)window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation;if(window.WEB_SOCKET_SWF_LOCATION){var b=document.createElement("div");b.id="webSocketContainer";b.style.position="absolute";if(WebSocket.__isFlashLite()){b.style.left="0px";b.style.top="0px"}else{b.style.left="-100px";b.style.top=
"-100px"}var e=document.createElement("div");e.id="webSocketFlash";b.appendChild(e);document.body.appendChild(b);j.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","9.0.0",null,{bridgeName:"webSocket"},{hasPriority:true,allowScriptAccess:"always"},null,function(h){h.success||c.error("[WebSocket] swfobject.embedSWF failed")});l.addInitializationCallback("webSocket",function(){try{WebSocket.__flash=l.webSocket.root();WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);
for(var h=0;h<WebSocket.__tasks.length;++h)WebSocket.__tasks[h]();WebSocket.__tasks=[]}catch(m){c.error("[WebSocket] "+m.toString())}})}else c.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")};WebSocket.__addTask=function(b){WebSocket.__flash?b():WebSocket.__tasks.push(b)};WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return false;var b=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!b||!b.enabledPlugin||!b.enabledPlugin.filename)return false;
return b.enabledPlugin.filename.match(/flashlite/i)?true:false};window.webSocketLog=function(b){c.log(decodeURIComponent(b))};window.webSocketError=function(b){c.error(decodeURIComponent(b))};window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",WebSocket.__initialize,false):window.attachEvent("onload",WebSocket.__initialize))}else c.error("Flash Player is not installed.")}})();return g.exports}();var bind=util.bind,forEach=util.forEach,copyArray=util.copyArray;
fin=new (function(){this.connect=function(d,g,j){if(this._socket)throw"fin.connect has already been called";this._doConnect(d,g,j)};this.create=function(d,g){if(typeof g!="function")throw"Second argument to fin.create should be a callback";for(var j in d)d[j]instanceof Array&&!d[j].length&&delete d[j];this.requestResponse("create",{data:d},g)};this.observe=function(d,g,j){if(typeof d!="number"||!g||!j)throw"observe requires three arguments: "+[itemId,g,j?"function":j].join(" ");return this._observeChain(d,
g,0,j,{})};this.set=function(d,g,j){this._mutate("set",d,g,[j])};this.release=function(d){var g=this._subIdToKey[d],j=keys.getKeyInfo(g),a=j.id;this._subscriptionPool.remove(g,d);if(this._subscriptionPool.count(g)==0){a!=this._localID&&this.request("unsubscribe",{id:a,property:j.property});delete this._mutationCache[g];delete this._listLength[g]}delete this._subIdToKey[d];if(this._chainDependants[d]){this.release(this._chainDependants[d]);delete this._chainDependants[d]}};this.getCachedMutation=function(d,
g){var j=this._getItemID(d);return this._mutationCache[keys.getItemPropertyKey(j,g)]};this.observeSet=function(d,g,j){this._observe({id:d,property:g,type:"SET"},j)};this.addToSet=function(d,g,j){this._mutate("sadd",d,g,[j])};this.removeFromSet=function(d,g,j){this._mutate("srem",d,g,[j])};this.observeList=function(d,g,j,a){if(typeof d!="number"||!g||!j)throw"observe requires at least three arguments: "+[itemName,g,j?"function":j,a].join(" ");j=this._observeChain(d,g,0,j,{snapshot:false});this.extendList(d,
g,a);return j};this._listLength={};this.extendList=function(d,g,j){if(typeof d!="number"||!g)throw"extendList requires a numeric ID and a property: "+[itemID,g].join(" ");this._resolvePropertyChain(d,g,bind(this,function(a){var c=this._getItemID(a.id),b=a.property;a=keys.getItemPropertyKey(c,b);var e=this._listLength[a]||0;if(!(j<=e)){this._listLength[a]=j;a={id:c,property:b,from:e};if(j)a.to=j;this.requestResponse("extend_list",a,bind(this,function(h){this._handleMutation({id:c,property:b,op:"push",
args:h,index:e})}))}}))};this.push=function(d,g){var j=Array.prototype.slice.call(arguments,2);this._listOp(d,g,"push",j)};this.unshift=function(d,g){var j=Array.prototype.slice.call(arguments,2);this._listOp(d,g,"unshift",j)};this.request=function(d,g,j){g=g||{};g.request=d;this._send(g,j)};this.requestResponse=function(d,g,j,a){j=this._scheduleCallback(j);g.request=d;g._requestId=j;this._send(g,a)};this._send=function(d,g){var j=this._transactionStack[this._transactionStack.length-1];j&&g?this._transactions[j].actions.push(d):
this._socket.send(d)};this.handle=function(d,g){this._eventHandlers[d]=g};this.transact=function(d){var g="t"+this._uniqueRequestId++;this._transactions[g]={waitingFor:1,actions:[]};this._transactionStack.push(g);d(g);this._endTransaction(g)};this._endTransaction=function(d){var g=this._transactionStack.pop();if(g!=d)throw"transaction ID mismatch in _endTransaction! "+g+" "+d;if(!--this._transactions[g].waitingFor){this.request("transact",{actions:this._transactions[g].actions});delete this._transactions[g]}};
var l={resume:function(){},complete:function(){}};this._holdTransaction=function(){var d=this._transactionStack[this._transactionStack.length-1];if(!d)return l;this._transactions[d].waitingFor++;return{resume:function(){fin._transactionStack.push(d)},complete:function(){fin._endTransaction(d)}}};this.focus=function(d,g,j){var a=this._client.getSessionID(),c=keys.getFocusProperty(g);g={session:a,user:gUserId,time:this.now()};var b,e;this.set(d,c,JSON.stringify(g));b=this._observe({id:d,property:c,
useCache:false,snapshot:false},bind(this,function(h,m){if(b){var u;try{u=JSON.parse(m)}catch(s){}if(!(!u||u.session==a)){e();j(u)}}}));return e=bind(this,function(){if(b){this.release(b);b=null;this.set(d,c,null)}})};this.now=function(){return(new Date).getTime()};this._init=function(){this._requestCallbacks={};this._eventHandlers={};this._transactions={};this._transactionStack=[];this.handle("mutation",bind(this,"_onMutationMessage"))};this._doConnect=function(d,g,j){this._socket=new io.Socket(d,
{port:g,connectTimeout:500,transports:"websocket,xhr-multipart,flashsocket,htmlfile,xhr-polling,jsonp-polling".split(",")});this._socket.on("connect",bind(this,j)).on("message",bind(this,"_handleMessage")).on("disconnect",bind(this,"_handleDisconnect"));this._socket.connect()};this._onMutationMessage=function(d){this._handleMutation(JSON.parse(d))};this._handleMessage=function(d){if(d.response)this._executeCallback(d.response,d.data);else if(this._eventHandlers[d.event])this._eventHandlers[d.event](d.data);
else throw"received unknown message: "+JSON.stringify(d);};this._handleDisconnect=function(){console.log("_handleDisconnect",arguments)};this._listOp=function(d,g,j,a){this._mutate(j,d,g,a)};this._chainDependants={};this._observeChain=function(d,g,j,a,c){var b=typeof g=="string"?g.split("."):g;g=b[j];var e,h,m;if(j==b.length-1){c.id=d;c.property=g;return this._observe(c,a)}else return e=this._observe({id:d,property:g},bind(this,function(u,s){if(s!=m){m=s;h&&this.release(h);h=this._observeChain(s,
b,j+1,a,c);this._chainDependants[e]=h}}))};this._getItemID=function(d){return d=="LOCAL"?this._localID:d=="GLOBAL"?this._globalID:d};this._subIdToKey={};this._subscriptionPool=new Pool;this._observe=function(d,g){var j=this._getItemID(d.id),a=d.property,c=this._subscriptionPool,b=keys.getItemPropertyKey(j,a),e=c.add(b,g),h=d.type||"BYTES",m=this._mutationCache[b];if(j==this._localID&&!m)m=this._getNullMutation(h);if(j!=this._localID&&c.count(b)==1){if(typeof j!="number")throw"Expected numeric ID but got: "+
j;j={id:j,property:a,type:h};if(typeof d.snapshot!="undefined")j.snapshot=d.snapshot;this.request("observe",j)}else m&&d.useCache!==false&&this._handleMutation(m,g);this._subIdToKey[e]=b;return e};this._getNullMutation=function(d){switch(d){case "LIST":case "BYTES":default:}return{op:"set",args:[""],value:""}};this._resolvePropertyChain=function(d,g,j){var a=typeof g=="string"?g.split("."):copyArray(g);a.pop();if(a.length)var c=this._observeChain(d,a,0,bind(this,function(){j(this._resolveCachedPropertyChain(d,
g));setTimeout(bind(this,function(){this.release(c)}),0)}),{});else j(this._resolveCachedPropertyChain(d,g))};this._resolveCachedPropertyChain=function(d,g){for(var j=typeof g=="string"?g.split("."):copyArray(g);j.length>1;)d=this.getCachedMutation(d,j.shift()).value;return{id:d,property:j[0]}};this._localID=-1;this._globalID=0;this._mutate=function(d,g,j,a){j=this._resolveCachedPropertyChain(g,j);g=this._getItemID(j.id);d={op:d,args:a,id:g,property:j.property};g!=this._localID&&this.request("mutate",
{mutation:d},true);this._handleMutation(d)};this._deserializeMutation=function(d){var g=d.args,j=d.op;switch(j){case "set":d.value=g[0];break;case "push":case "unshift":case "sadd":case "srem":for(d=0;d<g.length;d++)g[d]=g[d];break;case "increment":case "decrement":if(g.length)throw"Argument for operation without signature: "+j;break;case "add":case "subtract":if(g.length!=1)throw"Missing argument for: "+j;break;default:throw"Unknown operation for deserialization: "+j;}};this._mutationCache={};this._handleMutation=
function(d,g){if(g){[d.op].concat(d.args);g(d,d.value)}else{var j=keys.getItemPropertyKey(d.id,d.property),a=this._subscriptionPool.get(j);this._deserializeMutation(d);this._cacheMutation(d,j);for(var c in a)a[c](d,d.value)}};this._cacheMutation=function(d,g){var j=this._mutationCache,a=j[g],c=a&&a.args,b=a&&a.value;if(!a)return j[g]=d;switch(d.op){case "set":j[g]=d;break;case "push":a.args=a.args.concat(d.args);break;case "unshift":a.args=d.args.concat(a.args);break;case "sadd":for(a=0;b=d.args[a];a++)c.indexOf(b)==
-1&&c.push(b);break;case "srem":for(a=0;b=d.args[a];a++)c.splice(c.indexOf(b),1);break;case "increment":a.value=d.value=(b||0)+1;break;case "decrement":a.value=d.value=(b||0)-1;break;case "add":a.value=d.value=(b||0)+d.args[0];break;case "subtract":a.value=d.value=(b||0)-d.args[0];break;default:throw"Unknown operation for caching: "+d.op;}return j[g]};this._uniqueRequestId=0;this._scheduleCallback=function(d){var g="r"+this._uniqueRequestId++;this._requestCallbacks[g]=d;return g};this._executeCallback=
function(d,g){var j=this._requestCallbacks[d];delete this._requestCallbacks[d];j(g)};this._init()});
