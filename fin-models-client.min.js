/*
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
*/
var require={};
require._=function(){var w=require["api/client"]={exports:{}},y=require._=function(){function l(b,c,f){if(b){if(!f){f=c;c=this}if(Object.prototype.toString.call(b)==="[object Array]")for(var i=0;i<b.length;i++)f.call(c,b[i],i);else for(i in b)f.call(c,b[i],i)}}var d=require["api/fin/util"]={exports:{}};d.exports={bind:function(b,c){if(!b||!c||typeof c=="string"&&!b[c])throw"bad bind arguments";var f=Array.prototype.slice.call(arguments,2);return function(){fn=typeof c=="string"?b[c]:c;return fn.apply(b,
f.concat(Array.prototype.slice.call(arguments,0)))}},curry:function(b){var c=Array.prototype.slice.call(arguments,1);return function(){var f=c.concat(Array.prototype.slice.call(arguments,0));b.apply(this,f)}},blockCallback:function(b,c){c=c||{};c.fireOnce=typeof c.fireOnce!="undefined"?c.fireOnce:true;var f=0,i=false,m={addBlock:function(){f++;var u=false;return function(s){if(s&&c.throwErr)throw Error(s);if(u)m.tryNow();else{u=true;f--;setTimeout(m.tryNow)}}},tryNow:function(){if(!(i&&c.fireOnce))if(f==
0){i=true;b()}}};return m},each:l,map:function(b,c){var f=[];l(b,function(i,m){f.push(c(i,m))});return f},pick:function(b,c){for(var f=[],i=0,m;i<b.length;i++)(m=c(b[i]))&&f.push(m);return f},copyArray:function(b){return Array.prototype.slice.call(b,0)},defineGetter:function(b){var c=b.defineGetter?e:b.__defineGetter__?h:Object.defineProperty?a:function(){throw"defineGetter not supported";};d.exports.defineGetter=c;c.apply(this,arguments)}};var e=function(b,c,f){b.defineGetter(c,f)},h=function(b,
c,f){b.__defineGetter__(c,f)},a=function(b,c,f){Object.defineProperty(b,c,{value:f,enumerable:true,configurable:true})};return d.exports}(),G=require._=function(){var l=require["api/fin/Pool"]={exports:{}};l.exports=function(){this._pool={};this._counts={};this._uniqueId=0};l.exports.prototype={add:function(d,e){if(!this._pool[d]){this._pool[d]={};this._counts[d]=0}this._counts[d]++;var h="p"+this._uniqueId++;this._pool[d][h]=e;return h},remove:function(d,e){var h=this._pool[d][e];delete this._pool[d][e];
if(this._counts[d]--==0){delete this._counts[d];delete this._pool[d]}return h},get:function(d){return this._pool[d]},count:function(d){return this._counts[d]||0}};return l.exports}(),F=require._=function(){var l=require["api/fin/keys"]={exports:{}};l.exports={getItemPropertyKey:function(d,e){if(d===undefined||e===undefined)throw Error("itemID and propName are required for keys.getItemPropertyKey");return"I"+d+"@"+e},getKeyInfo:function(d){var e=d[0];d=d.substr(1).split("@");return{type:e,id:parseInt(d[0]),
property:d[1]}},getPropertyChannel:function(d){return"#P"+d},getFocusProperty:function(d){return"_focus_"+d},uniqueIdKey:"__fin_unique_id"};return l.exports}();require._=function(){function l(a,b){this.target=a;this.remoteTypeCache={};this.remoteInstanceCache={};this.remoteFunctionCache={};this.localFunctionCache={};this.bridgeID=l.nextBridgeID++;this.name=b;this.nextLocalFuncID=0;l.instances[this.name]=this;l.idMap[this.bridgeID]=this;return this}function d(a){this.fb_instance_id=a;return this}var e=
require["lib/socket.io/support/socket.io-client/socket.io"]={exports:{}};this.io={version:"0.6.2",setPath:function(a){window.console&&console.error&&console.error("io.setPath will be removed. Please set the variable WEB_SOCKET_SWF_LOCATION pointing to WebSocketMain.swf");this.path=/\/$/.test(a)?a:a+"/";WEB_SOCKET_SWF_LOCATION=a+"lib/vendor/web-socket-js/WebSocketMain.swf"}};if("jQuery"in this)jQuery.io=this.io;if(typeof window!="undefined")if(typeof WEB_SOCKET_SWF_LOCATION==="undefined")WEB_SOCKET_SWF_LOCATION=
"/socket.io/lib/vendor/web-socket-js/WebSocketMain.swf";(function(){var a=false;io.util={ios:false,load:function(b){if(/loaded|complete/.test(document.readyState)||a)return b();"attachEvent"in window?window.attachEvent("onload",b):window.addEventListener("load",b,false)},inherit:function(b,c){for(var f in c.prototype)b.prototype[f]=c.prototype[f]},indexOf:function(b,c,f){var i=b.length;for(f=f<0?Math.max(0,i+f):f||0;f<i;f++)if(b[f]===c)return f;return-1},isArray:function(b){return Object.prototype.toString.call(b)===
"[object Array]"},merge:function(b,c){for(var f in c)if(c.hasOwnProperty(f))b[f]=c[f]}};io.util.ios=/iphone|ipad/i.test(navigator.userAgent);io.util.android=/android/i.test(navigator.userAgent);io.util.opera=/opera/i.test(navigator.userAgent);io.util.load(function(){a=true})})();(function(){Transport=io.Transport=function(a,b){this.base=a;this.options={timeout:15E3};io.util.merge(this.options,b)};Transport.prototype.send=function(){throw Error("Missing send() implementation");};Transport.prototype.connect=
function(){throw Error("Missing connect() implementation");};Transport.prototype.disconnect=function(){throw Error("Missing disconnect() implementation");};Transport.prototype._encode=function(a){var b="",c;a=io.util.isArray(a)?a:[a];for(var f=0,i=a.length;f<i;f++){if(a[f]===null||a[f]===undefined)c="";else{c=a[f];if(Object.prototype.toString.call(c)=="[object Object]")if("JSON"in window)c="~j~"+JSON.stringify(c);else{"console"in window&&console.error&&console.error("Trying to encode as JSON, but JSON.stringify is missing.");
c='{ "$error": "Invalid message" }'}else c=String(c)}c=c;b+="~m~"+c.length+"~m~"+c}return b};Transport.prototype._decode=function(a){var b=[],c,f;do{if(a.substr(0,3)!=="~m~")return b;a=a.substr(3);c="";for(var i=0,m=a.length;i<m;i++){f=Number(a.substr(i,1));if(a.substr(i,1)==f)c+=f;else{a=a.substr(c.length+3);c=Number(c);break}}b.push(a.substr(0,c));a=a.substr(c)}while(a!=="");return b};Transport.prototype._onData=function(a){this._setTimeout();if((a=this._decode(a))&&a.length)for(var b=0,c=a.length;b<
c;b++)this._onMessage(a[b])};Transport.prototype._setTimeout=function(){var a=this;this._timeout&&clearTimeout(this._timeout);this._timeout=setTimeout(function(){a._onTimeout()},this.options.timeout)};Transport.prototype._onTimeout=function(){this._onDisconnect()};Transport.prototype._onMessage=function(a){if(this.sessionid)if(a.substr(0,3)=="~h~")this._onHeartbeat(a.substr(3));else a.substr(0,3)=="~j~"?this.base._onMessage(JSON.parse(a.substr(3))):this.base._onMessage(a);else{this.sessionid=a;this._onConnect()}};
Transport.prototype._onHeartbeat=function(a){this.send("~h~"+a)};Transport.prototype._onConnect=function(){this.connected=true;this.connecting=false;this.base._onConnect();this._setTimeout()};Transport.prototype._onDisconnect=function(){this.connected=this.connecting=false;this.sessionid=null;this.base._onDisconnect()};Transport.prototype._prepareUrl=function(){return(this.base.options.secure?"https":"http")+"://"+this.base.host+":"+this.base.options.port+"/"+this.base.options.resource+"/"+this.type+
(this.sessionid?"/"+this.sessionid:"/")}})();(function(){var a=new Function,b;b="XMLHttpRequest"in window?(new XMLHttpRequest).withCredentials!=undefined:false;var c=function(i){if("XDomainRequest"in window&&i)return new XDomainRequest;if("XMLHttpRequest"in window&&(!i||b))return new XMLHttpRequest;if(!i){try{return new ActiveXObject("MSXML2.XMLHTTP")}catch(m){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(u){}}return false},f=io.Transport.XHR=function(){io.Transport.apply(this,arguments);
this._sendBuffer=[]};io.util.inherit(f,io.Transport);f.prototype.connect=function(){this._get();return this};f.prototype._checkSend=function(){if(!this._posting&&this._sendBuffer.length){var i=this._encode(this._sendBuffer);this._sendBuffer=[];this._send(i)}};f.prototype.send=function(i){io.util.isArray(i)?this._sendBuffer.push.apply(this._sendBuffer,i):this._sendBuffer.push(i);this._checkSend();return this};f.prototype._send=function(i){var m=this;this._posting=true;this._sendXhr=this._request("send",
"POST");this._sendXhr.onreadystatechange=function(){var u;if(m._sendXhr.readyState==4){m._sendXhr.onreadystatechange=a;try{u=m._sendXhr.status}catch(s){}m._posting=false;u==200?m._checkSend():m._onDisconnect()}};this._sendXhr.send("data="+encodeURIComponent(i))};f.prototype.disconnect=function(){this._onDisconnect();return this};f.prototype._onDisconnect=function(){if(this._xhr){this._xhr.onreadystatechange=a;try{this._xhr.abort()}catch(i){}this._xhr=null}if(this._sendXhr){this._sendXhr.onreadystatechange=
a;try{this._sendXhr.abort()}catch(m){}this._sendXhr=null}this._sendBuffer=[];io.Transport.prototype._onDisconnect.call(this)};f.prototype._request=function(i,m,u){var s=c(this.base._isXDomain());if(u)s.multipart=true;s.open(m||"GET",this._prepareUrl()+(i?"/"+i:""));m=="POST"&&"setRequestHeader"in s&&s.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8");return s};f.check=function(i){try{if(c(i))return true}catch(m){}return false};f.xdomainCheck=function(){return f.check(true)};
f.request=c})();(function(){var a=io.Transport.websocket=function(){io.Transport.apply(this,arguments)};io.util.inherit(a,io.Transport);a.prototype.type="websocket";a.prototype.connect=function(){var b=this;this.socket=new WebSocket(this._prepareUrl());this.socket.onmessage=function(c){b._onData(c.data)};this.socket.onclose=function(){b._onClose()};this.socket.onerror=function(c){b._onError(c)};return this};a.prototype.send=function(b){this.socket&&this.socket.send(this._encode(b));return this};a.prototype.disconnect=
function(){this.socket&&this.socket.close();return this};a.prototype._onClose=function(){this._onDisconnect();return this};a.prototype._onError=function(b){this.base.emit("error",[b])};a.prototype._prepareUrl=function(){return(this.base.options.secure?"wss":"ws")+"://"+this.base.host+":"+this.base.options.port+"/"+this.base.options.resource+"/"+this.type+(this.sessionid?"/"+this.sessionid:"")};a.check=function(){return"WebSocket"in window&&WebSocket.prototype&&WebSocket.prototype.send&&!!WebSocket.prototype.send.toString().match(/native/i)&&
typeof WebSocket!=="undefined"};a.xdomainCheck=function(){return true}})();(function(){var a=io.Transport.flashsocket=function(){io.Transport.websocket.apply(this,arguments)};io.util.inherit(a,io.Transport.websocket);a.prototype.type="flashsocket";a.prototype.connect=function(){var b=this,c=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.connect.apply(b,c)});return this};a.prototype.send=function(){var b=this,c=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.send.apply(b,
c)});return this};a.check=function(){if(typeof WebSocket=="undefined"||!("__addTask"in WebSocket))return false;if(io.util.opera)return false;if("navigator"in window&&"plugins"in navigator&&navigator.plugins["Shockwave Flash"])return!!navigator.plugins["Shockwave Flash"].description;if("ActiveXObject"in window)try{return!!(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(b){}return false};a.xdomainCheck=function(){return true}})();(function(){var a=io.Transport.htmlfile=
function(){io.Transport.XHR.apply(this,arguments)};io.util.inherit(a,io.Transport.XHR);a.prototype.type="htmlfile";a.prototype._get=function(){var b=this;this._open();window.attachEvent("onunload",function(){b._destroy()})};a.prototype._open=function(){this._doc=new ActiveXObject("htmlfile");this._doc.open();this._doc.write("<html></html>");this._doc.parentWindow.s=this;this._doc.close();var b=this._doc.createElement("div");this._doc.body.appendChild(b);this._iframe=this._doc.createElement("iframe");
b.appendChild(this._iframe);this._iframe.src=this._prepareUrl()+"/"+ +new Date};a.prototype._=function(b,c){this._onData(b);var f=c.getElementsByTagName("script")[0];f.parentNode.removeChild(f)};a.prototype._destroy=function(){if(this._iframe){this._iframe.src="about:blank";this._doc=null;CollectGarbage()}};a.prototype.disconnect=function(){this._destroy();return io.Transport.XHR.prototype.disconnect.call(this)};a.check=function(){if("ActiveXObject"in window)try{return new ActiveXObject("htmlfile")&&
io.Transport.XHR.check()}catch(b){}return false};a.xdomainCheck=function(){return false}})();(function(){var a=io.Transport["xhr-multipart"]=function(){io.Transport.XHR.apply(this,arguments)};io.util.inherit(a,io.Transport.XHR);a.prototype.type="xhr-multipart";a.prototype._get=function(){var b=this;this._xhr=this._request("","GET",true);this._xhr.onreadystatechange=function(){b._xhr.readyState==4&&b._onData(b._xhr.responseText)};this._xhr.send(null)};a.check=function(){return"XMLHttpRequest"in window&&
"prototype"in XMLHttpRequest&&"multipart"in XMLHttpRequest.prototype};a.xdomainCheck=function(){return true}})();(function(){var a=new Function,b=io.Transport["xhr-polling"]=function(){io.Transport.XHR.apply(this,arguments)};io.util.inherit(b,io.Transport.XHR);b.prototype.type="xhr-polling";b.prototype.connect=function(){if(io.util.ios||io.util.android){var c=this;io.util.load(function(){setTimeout(function(){io.Transport.XHR.prototype.connect.call(c)},10)})}else io.Transport.XHR.prototype.connect.call(this)};
b.prototype._get=function(){var c=this;this._xhr=this._request(+new Date,"GET");this._xhr.onreadystatechange=function(){var f;if(c._xhr.readyState==4){c._xhr.onreadystatechange=a;try{f=c._xhr.status}catch(i){}if(f==200){c._onData(c._xhr.responseText);c._get()}else c._onDisconnect()}};this._xhr.send(null)};b.check=function(){return io.Transport.XHR.check()};b.xdomainCheck=function(){return io.Transport.XHR.xdomainCheck()}})();io.JSONP=[];JSONPPolling=io.Transport["jsonp-polling"]=function(){io.Transport.XHR.apply(this,
arguments);this._insertAt=document.getElementsByTagName("script")[0];this._index=io.JSONP.length;io.JSONP.push(this)};io.util.inherit(JSONPPolling,io.Transport["xhr-polling"]);JSONPPolling.prototype.type="jsonp-polling";JSONPPolling.prototype._send=function(a){function b(){c();f._posting=false;f._checkSend()}function c(){f._iframe&&f._form.removeChild(f._iframe);try{s=document.createElement('<iframe name="'+f._iframeId+'">')}catch(q){s=document.createElement("iframe");s.name=f._iframeId}s.id=f._iframeId;
f._form.appendChild(s);f._iframe=s}var f=this;if(!("_form"in this)){var i=document.createElement("FORM"),m=document.createElement("TEXTAREA"),u=this._iframeId="socket_io_iframe_"+this._index,s;i.style.position="absolute";i.style.top="-1000px";i.style.left="-1000px";i.target=u;i.method="POST";i.action=this._prepareUrl()+"/"+ +new Date+"/"+this._index;m.name="data";i.appendChild(m);this._insertAt.parentNode.insertBefore(i,this._insertAt);document.body.appendChild(i);this._form=i;this._area=m}c();this._posting=
true;this._area.value=a;try{this._form.submit()}catch(T){}if(this._iframe.attachEvent)s.onreadystatechange=function(){f._iframe.readyState=="complete"&&b()};else this._iframe.onload=b};JSONPPolling.prototype._get=function(){var a=this,b=document.createElement("SCRIPT");if(this._script){this._script.parentNode.removeChild(this._script);this._script=null}b.async=true;b.src=this._prepareUrl()+"/"+ +new Date+"/"+this._index;b.onerror=function(){a._onDisconnect()};this._insertAt.parentNode.insertBefore(b,
this._insertAt);this._script=b};JSONPPolling.prototype._=function(){this._onData.apply(this,arguments);this._get();return this};JSONPPolling.check=function(){return true};JSONPPolling.xdomainCheck=function(){return true};(function(){var a=io.Socket=function(b,c){this.host=b||document.domain;this.options={secure:false,document:document,port:document.location.port||80,resource:"socket.io",transports:["websocket","flashsocket","htmlfile","xhr-multipart","xhr-polling","jsonp-polling"],transportOptions:{"xhr-polling":{timeout:25E3},
"jsonp-polling":{timeout:25E3}},connectTimeout:5E3,tryTransportsOnConnectTimeout:true,rememberTransport:true};io.util.merge(this.options,c);this.connecting=this.connected=false;this._events={};this.transport=this.getTransport();!this.transport&&"console"in window&&console.error("No transport available")};a.prototype.getTransport=function(b){var c=b||this.options.transports;if(this.options.rememberTransport&&!b)if(b=this.options.document.cookie.match("(?:^|;)\\s*socketio=([^;]*)")){this._rememberedTransport=
true;c=[decodeURIComponent(b[1])]}b=0;for(var f;f=c[b];b++)if(io.Transport[f]&&io.Transport[f].check()&&(!this._isXDomain()||io.Transport[f].xdomainCheck()))return new io.Transport[f](this,this.options.transportOptions[f]||{});return null};a.prototype.connect=function(){if(this.transport&&!this.connected){this.connecting&&this.disconnect();this.connecting=true;this.emit("connecting",[this.transport.type]);this.transport.connect();if(this.options.connectTimeout){var b=this;this.connectTimeoutTimer=
setTimeout(function(){if(!b.connected){b.disconnect();if(b.options.tryTransportsOnConnectTimeout&&!b._rememberedTransport){if(!b._remainingTransports)b._remainingTransports=b.options.transports.slice(0);for(var c=b._remainingTransports;c.length>0&&c.splice(0,1)[0]!=b.transport.type;);if(c.length){b.transport=b.getTransport(c);b.connect()}}if(!b._remainingTransports||b._remainingTransports.length==0)b.emit("connect_failed")}b._remainingTransports&&b._remainingTransports.length==0&&delete b._remainingTransports},
this.options.connectTimeout)}}return this};a.prototype.send=function(b){if(!this.transport||!this.transport.connected)return this._queue(b);this.transport.send(b);return this};a.prototype.disconnect=function(){this.connectTimeoutTimer&&clearTimeout(this.connectTimeoutTimer);this.transport.disconnect();return this};a.prototype.on=function(b,c){b in this._events||(this._events[b]=[]);this._events[b].push(c);return this};a.prototype.emit=function(b,c){if(b in this._events)for(var f=this._events[b].concat(),
i=0,m=f.length;i<m;i++)f[i].apply(this,c===undefined?[]:c);return this};a.prototype.removeEvent=function(b,c){if(b in this._events)for(var f=0,i=this._events[b].length;f<i;f++)this._events[b][f]==c&&this._events[b].splice(f,1);return this};a.prototype._queue=function(b){if(!("_queueStack"in this))this._queueStack=[];this._queueStack.push(b);return this};a.prototype._doQueue=function(){if(!("_queueStack"in this)||!this._queueStack.length)return this;this.transport.send(this._queueStack);this._queueStack=
[];return this};a.prototype._isXDomain=function(){return this.host!==document.domain};a.prototype._onConnect=function(){this.connected=true;this.connecting=false;this._doQueue();if(this.options.rememberTransport)this.options.document.cookie="socketio="+encodeURIComponent(this.transport.type);this.emit("connect")};a.prototype._onMessage=function(b){this.emit("message",[b])};a.prototype._onDisconnect=function(){var b=this.connected;this.connecting=this.connected=false;this._queueStack=[];b&&this.emit("disconnect")};
a.prototype.fire=a.prototype.emit;a.prototype.addListener=a.prototype.addEvent=a.prototype.addEventListener=a.prototype.on})();var h=function(){function a(){if(!U){try{var g=r.getElementsByTagName("body")[0].appendChild(r.createElement("span"));g.parentNode.removeChild(g)}catch(j){return}U=true;g=Y.length;for(var k=0;k<g;k++)Y[k]()}}function b(g){if(U)g();else Y[Y.length]=g}function c(g){if(typeof H.addEventListener!=A)H.addEventListener("load",g,false);else if(typeof r.addEventListener!=A)r.addEventListener("load",
g,false);else if(typeof H.attachEvent!=A)J(H,"onload",g);else if(typeof H.onload=="function"){var j=H.onload;H.onload=function(){j();g()}}else H.onload=g}function f(){var g=r.getElementsByTagName("body")[0],j=r.createElement(L);j.setAttribute("type",Z);var k=g.appendChild(j);if(k){var n=0;(function(){if(typeof k.GetVariable!=A){var o=k.GetVariable("$version");if(o){o=o.split(" ")[1].split(",");p.pv=[parseInt(o[0],10),parseInt(o[1],10),parseInt(o[2],10)]}}else if(n<10){n++;setTimeout(arguments.callee,
10);return}g.removeChild(j);k=null;i()})()}else i()}function i(){var g=P.length;if(g>0)for(var j=0;j<g;j++){var k=P[j].id,n=P[j].callbackFn,o={success:false,id:k};if(p.pv[0]>0){var v=z(k);if(v)if(K(P[j].swfVersion)&&!(p.wk&&p.wk<312)){M(k,true);if(n){o.success=true;o.ref=m(k);n(o)}}else if(P[j].expressInstall&&u()){o={};o.data=P[j].expressInstall;o.width=v.getAttribute("width")||"0";o.height=v.getAttribute("height")||"0";if(v.getAttribute("class"))o.styleclass=v.getAttribute("class");if(v.getAttribute("align"))o.align=
v.getAttribute("align");var t={};v=v.getElementsByTagName("param");for(var B=v.length,C=0;C<B;C++)if(v[C].getAttribute("name").toLowerCase()!="movie")t[v[C].getAttribute("name")]=v[C].getAttribute("value");s(o,t,k,n)}else{T(v);n&&n(o)}}else{M(k,true);if(n){if((k=m(k))&&typeof k.SetVariable!=A){o.success=true;o.ref=k}n(o)}}}}function m(g){var j=null;if((g=z(g))&&g.nodeName=="OBJECT")if(typeof g.SetVariable!=A)j=g;else if(g=g.getElementsByTagName(L)[0])j=g;return j}function u(){return!$&&K("6.0.65")&&
(p.win||p.mac)&&!(p.wk&&p.wk<312)}function s(g,j,k,n){$=true;fa=n||null;ha={success:false,id:k};var o=z(k);if(o){if(o.nodeName=="OBJECT"){W=q(o);aa=null}else{W=o;aa=k}g.id=ia;if(typeof g.width==A||!/%$/.test(g.width)&&parseInt(g.width,10)<310)g.width="310";if(typeof g.height==A||!/%$/.test(g.height)&&parseInt(g.height,10)<137)g.height="137";r.title=r.title.slice(0,47)+" - Flash Player Installation";n=p.ie&&p.win?"ActiveX":"PlugIn";n="MMredirectURL="+H.location.toString().replace(/&/g,"%26")+"&MMplayerType="+
n+"&MMdoctitle="+r.title;if(typeof j.flashvars!=A)j.flashvars+="&"+n;else j.flashvars=n;if(p.ie&&p.win&&o.readyState!=4){n=r.createElement("div");k+="SWFObjectNew";n.setAttribute("id",k);o.parentNode.insertBefore(n,o);o.style.display="none";(function(){o.readyState==4?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)})()}D(g,j,k)}}function T(g){if(p.ie&&p.win&&g.readyState!=4){var j=r.createElement("div");g.parentNode.insertBefore(j,g);j.parentNode.replaceChild(q(g),j);g.style.display="none";
(function(){g.readyState==4?g.parentNode.removeChild(g):setTimeout(arguments.callee,10)})()}else g.parentNode.replaceChild(q(g),g)}function q(g){var j=r.createElement("div");if(p.win&&p.ie)j.innerHTML=g.innerHTML;else if(g=g.getElementsByTagName(L)[0])if(g=g.childNodes)for(var k=g.length,n=0;n<k;n++)!(g[n].nodeType==1&&g[n].nodeName=="PARAM")&&g[n].nodeType!=8&&j.appendChild(g[n].cloneNode(true));return j}function D(g,j,k){var n,o=z(k);if(p.wk&&p.wk<312)return n;if(o){if(typeof g.id==A)g.id=k;if(p.ie&&
p.win){var v="";for(var t in g)if(g[t]!=Object.prototype[t])if(t.toLowerCase()=="data")j.movie=g[t];else if(t.toLowerCase()=="styleclass")v+=' class="'+g[t]+'"';else if(t.toLowerCase()!="classid")v+=" "+t+'="'+g[t]+'"';t="";for(var B in j)if(j[B]!=Object.prototype[B])t+='<param name="'+B+'" value="'+j[B]+'" />';o.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+v+">"+t+"</object>";ba[ba.length]=g.id;n=z(g.id)}else{B=r.createElement(L);B.setAttribute("type",Z);for(var C in g)if(g[C]!=
Object.prototype[C])if(C.toLowerCase()=="styleclass")B.setAttribute("class",g[C]);else C.toLowerCase()!="classid"&&B.setAttribute(C,g[C]);for(v in j)if(j[v]!=Object.prototype[v]&&v.toLowerCase()!="movie"){g=B;t=v;C=j[v];k=r.createElement("param");k.setAttribute("name",t);k.setAttribute("value",C);g.appendChild(k)}o.parentNode.replaceChild(B,o);n=B}}return n}function E(g){var j=z(g);if(j&&j.nodeName=="OBJECT")if(p.ie&&p.win){j.style.display="none";(function(){if(j.readyState==4){var k=z(g);if(k){for(var n in k)if(typeof k[n]==
"function")k[n]=null;k.parentNode.removeChild(k)}}else setTimeout(arguments.callee,10)})()}else j.parentNode.removeChild(j)}function z(g){var j=null;try{j=r.getElementById(g)}catch(k){}return j}function J(g,j,k){g.attachEvent(j,k);V[V.length]=[g,j,k]}function K(g){var j=p.pv;g=g.split(".");g[0]=parseInt(g[0],10);g[1]=parseInt(g[1],10)||0;g[2]=parseInt(g[2],10)||0;return j[0]>g[0]||j[0]==g[0]&&j[1]>g[1]||j[0]==g[0]&&j[1]==g[1]&&j[2]>=g[2]?true:false}function Q(g,j,k,n){if(!(p.ie&&p.mac)){var o=r.getElementsByTagName("head")[0];
if(o){k=k&&typeof k=="string"?k:"screen";if(n)ga=N=null;if(!N||ga!=k){n=r.createElement("style");n.setAttribute("type","text/css");n.setAttribute("media",k);N=o.appendChild(n);if(p.ie&&p.win&&typeof r.styleSheets!=A&&r.styleSheets.length>0)N=r.styleSheets[r.styleSheets.length-1];ga=k}if(p.ie&&p.win)N&&typeof N.addRule==L&&N.addRule(g,j);else N&&typeof r.createTextNode!=A&&N.appendChild(r.createTextNode(g+" {"+j+"}"))}}}function M(g,j){if(ja){var k=j?"visible":"hidden";if(U&&z(g))z(g).style.visibility=
k;else Q("#"+g,"visibility:"+k)}}function ka(g){return/[\\\"<>\.;]/.exec(g)!=null&&typeof encodeURIComponent!=A?encodeURIComponent(g):g}var A="undefined",L="object",Z="application/x-shockwave-flash",ia="SWFObjectExprInst",H=window,r=document,R=navigator,la=false,Y=[function(){la?f():i()}],P=[],ba=[],V=[],W,aa,fa,ha,U=false,$=false,N,ga,ja=true,p=function(){var g=typeof r.getElementById!=A&&typeof r.getElementsByTagName!=A&&typeof r.createElement!=A,j=R.userAgent.toLowerCase(),k=R.platform.toLowerCase(),
n=k?/win/.test(k):/win/.test(j);k=k?/mac/.test(k):/mac/.test(j);j=/webkit/.test(j)?parseFloat(j.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false;var o=!+"\u000b1",v=[0,0,0],t=null;if(typeof R.plugins!=A&&typeof R.plugins["Shockwave Flash"]==L){if((t=R.plugins["Shockwave Flash"].description)&&!(typeof R.mimeTypes!=A&&R.mimeTypes[Z]&&!R.mimeTypes[Z].enabledPlugin)){la=true;o=false;t=t.replace(/^.*\s+(\S+\s+\S+$)/,"$1");v[0]=parseInt(t.replace(/^(.*)\..*$/,"$1"),10);v[1]=parseInt(t.replace(/^.*\.(.*)\s.*$/,
"$1"),10);v[2]=/[a-zA-Z]/.test(t)?parseInt(t.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof H.ActiveXObject!=A)try{var B=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(B)if(t=B.GetVariable("$version")){o=true;t=t.split(" ")[1].split(",");v=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)]}}catch(C){}return{w3:g,pv:v,wk:j,ie:o,win:n,mac:k}}();(function(){if(p.w3){if(typeof r.readyState!=A&&r.readyState=="complete"||typeof r.readyState==A&&(r.getElementsByTagName("body")[0]||r.body))a();
if(!U){typeof r.addEventListener!=A&&r.addEventListener("DOMContentLoaded",a,false);if(p.ie&&p.win){r.attachEvent("onreadystatechange",function(){if(r.readyState=="complete"){r.detachEvent("onreadystatechange",arguments.callee);a()}});H==top&&function(){if(!U){try{r.documentElement.doScroll("left")}catch(g){setTimeout(arguments.callee,0);return}a()}}()}p.wk&&function(){U||(/loaded|complete/.test(r.readyState)?a():setTimeout(arguments.callee,0))}();c(a)}}})();(function(){p.ie&&p.win&&window.attachEvent("onunload",
function(){for(var g=V.length,j=0;j<g;j++)V[j][0].detachEvent(V[j][1],V[j][2]);g=ba.length;for(j=0;j<g;j++)E(ba[j]);for(var k in p)p[k]=null;p=null;for(var n in h)h[n]=null;h=null})})();return{registerObject:function(g,j,k,n){if(p.w3&&g&&j){var o={};o.id=g;o.swfVersion=j;o.expressInstall=k;o.callbackFn=n;P[P.length]=o;M(g,false)}else n&&n({success:false,id:g})},getObjectById:function(g){if(p.w3)return m(g)},embedSWF:function(g,j,k,n,o,v,t,B,C,X){var ca={success:false,id:j};if(p.w3&&!(p.wk&&p.wk<312)&&
g&&j&&k&&n&&o){M(j,false);b(function(){k+="";n+="";var S={};if(C&&typeof C===L)for(var O in C)S[O]=C[O];S.data=g;S.width=k;S.height=n;O={};if(B&&typeof B===L)for(var da in B)O[da]=B[da];if(t&&typeof t===L)for(var ea in t)if(typeof O.flashvars!=A)O.flashvars+="&"+ea+"="+t[ea];else O.flashvars=ea+"="+t[ea];if(K(o)){da=D(S,O,j);S.id==j&&M(j,true);ca.success=true;ca.ref=da}else if(v&&u()){S.data=v;s(S,O,j,X);return}else M(j,true);X&&X(ca)})}else X&&X(ca)},switchOffAutoHideShow:function(){ja=false},ua:p,
getFlashPlayerVersion:function(){return{major:p.pv[0],minor:p.pv[1],release:p.pv[2]}},hasFlashPlayerVersion:K,createSWF:function(g,j,k){if(p.w3)return D(g,j,k)},showExpressInstall:function(g,j,k,n){p.w3&&u()&&s(g,j,k,n)},removeSWF:function(g){p.w3&&E(g)},createCSS:function(g,j,k,n){p.w3&&Q(g,j,k,n)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(g){var j=r.location.search||r.location.hash;if(j){if(/\?/.test(j))j=j.split("?")[1];if(g==null)return ka(j);j=j.split("&");for(var k=0;k<j.length;k++)if(j[k].substring(0,
j[k].indexOf("="))==g)return ka(j[k].substring(j[k].indexOf("=")+1))}return""},expressInstallCallback:function(){if($){var g=z(ia);if(g&&W){g.parentNode.replaceChild(W,g);if(aa){M(aa,true);if(p.ie&&p.win)W.style.display="block"}fa&&fa(ha)}$=false}}}}();l.TYPE_ASINSTANCE=1;l.TYPE_ASFUNCTION=2;l.TYPE_JSFUNCTION=3;l.TYPE_ANONYMOUS=4;l.initCallbacks={};l.userTypes={};l.addToUserTypes=function(){for(var a=0;a<arguments.length;a++)l.userTypes[arguments[a]]={typeName:arguments[a],enriched:false}};l.argsToArray=
function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c];return b};l.addInitializationCallback=function(a,b){var c=l.instances[a];if(c!=undefined)b.call(c);else{c=l.initCallbacks[a];if(c==null)l.initCallbacks[a]=c=[];c.push(b)}};l.nextBridgeID=0;l.instances={};l.idMap={};l.refCount=0;l.extractBridgeFromID=function(a){return l.idMap[a>>16]};l.attachBridge=function(a,b){var c=new l(a,b);l[b]=c;var f=l.initCallbacks[b];if(f!=null){for(var i=0;i<f.length;i++)f[i].call(c);delete l.initCallbacks[b]}};l.blockedMethods=
{toString:true,get:true,set:true,call:true};l.prototype={root:function(){return this.deserialize(this.target.getRoot())},releaseASObjects:function(){return this.target.releaseASObjects()},releaseNamedASObject:function(a){return typeof a!="object"?false:this.target.releaseNamedASObject(a.fb_instance_id)},create:function(a){return this.deserialize(this.target.create(a))},makeID:function(a){return(this.bridgeID<<16)+a},getPropertyFromAS:function(a,b){if(l.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");
else{l.refCount++;retVal=this.target.getPropFromAS(a,b);retVal=this.handleError(retVal);l.refCount--;return retVal}},setPropertyInAS:function(a,b,c){if(l.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{l.refCount++;retVal=this.target.setPropInAS(a,b,this.serialize(c));retVal=this.handleError(retVal);l.refCount--;return retVal}},callASFunction:function(a,b){if(l.refCount>
0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{l.refCount++;retVal=this.target.invokeASFunction(a,this.serialize(b));retVal=this.handleError(retVal);l.refCount--;return retVal}},callASMethod:function(a,b,c){if(l.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");
else{l.refCount++;c=this.serialize(c);retVal=this.target.invokeASMethod(a,b,c);retVal=this.handleError(retVal);l.refCount--;return retVal}},invokeLocalFunction:function(a,b){var c,f=this.localFunctionCache[a];if(f!=undefined)c=this.serialize(f.apply(null,this.deserialize(b)));return c},getTypeFromName:function(a){return this.remoteTypeCache[a]},createProxy:function(a,b){var c=this.getTypeFromName(b);d.prototype=c;c=new d(a);return this.remoteInstanceCache[a]=c},getProxy:function(a){return this.remoteInstanceCache[a]},
addTypeDataToCache:function(a){for(var b=new ASProxy(this,a.name),c=a.accessors,f=0;f<c.length;f++)this.addPropertyToType(b,c[f]);a=a.methods;for(f=0;f<a.length;f++)l.blockedMethods[a[f]]==undefined&&this.addMethodToType(b,a[f]);return this.remoteTypeCache[b.typeName]=b},addPropertyToType:function(a,b){var c=b.charAt(0),f;if(c>="a"&&c<="z"){f="get"+c.toUpperCase()+b.substr(1);c="set"+c.toUpperCase()+b.substr(1)}else{f="get"+b;c="set"+b}a[c]=function(i){this.bridge.setPropertyInAS(this.fb_instance_id,
b,i)};a[f]=function(){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,b))}},addMethodToType:function(a,b){a[b]=function(){return this.bridge.deserialize(this.bridge.callASMethod(this.fb_instance_id,b,l.argsToArray(arguments)))}},getFunctionProxy:function(a){var b=this;if(this.remoteFunctionCache[a]==null)this.remoteFunctionCache[a]=function(){b.callASFunction(a,l.argsToArray(arguments))};return this.remoteFunctionCache[a]},getFunctionID:function(a){if(a.__bridge_id__==
undefined){a.__bridge_id__=this.makeID(this.nextLocalFuncID++);this.localFunctionCache[a.__bridge_id__]=a}return a.__bridge_id__},serialize:function(a){var b={},c=typeof a;if(c=="number"||c=="string"||c=="boolean"||c==null||c==undefined)b=a;else if(a instanceof Array){b=[];for(c=0;c<a.length;c++)b[c]=this.serialize(a[c])}else if(c=="function"){b.type=l.TYPE_JSFUNCTION;b.value=this.getFunctionID(a)}else if(a instanceof ASProxy){b.type=l.TYPE_ASINSTANCE;b.value=a.fb_instance_id}else{b.type=l.TYPE_ANONYMOUS;
b.value=a}return b},deserialize:function(a){var b,c=typeof a;if(c=="number"||c=="string"||c=="boolean"||a==null||a==undefined)b=this.handleError(a);else if(a instanceof Array){b=[];for(c=0;c<a.length;c++)b[c]=this.deserialize(a[c])}else if(c=="object"){for(c=0;c<a.newTypes.length;c++)this.addTypeDataToCache(a.newTypes[c]);for(var f in a.newRefs)this.createProxy(f,a.newRefs[f]);if(a.type==l.TYPE_PRIMITIVE)b=a.value;else if(a.type==l.TYPE_ASFUNCTION)b=this.getFunctionProxy(a.value);else if(a.type==
l.TYPE_ASINSTANCE)b=this.getProxy(a.value);else if(a.type==l.TYPE_ANONYMOUS)b=a.value}return b},addRef:function(a){this.target.incRef(a.fb_instance_id)},release:function(a){this.target.releaseRef(a.fb_instance_id)},handleError:function(a){if(typeof a=="string"&&a.indexOf("__FLASHERROR")==0){a=a.split("||");l.refCount>0&&l.refCount--;throw Error(a[1]);}return a}};ASProxy=function(a,b){this.bridge=a;this.typeName=b;return this};ASProxy.prototype={get:function(a){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,
a))},set:function(a,b){this.bridge.setPropertyInAS(this.fb_instance_id,a,b)},call:function(a,b){this.bridge.callASMethod(this.fb_instance_id,a,b)},addRef:function(){this.bridge.addRef(this)},release:function(){this.bridge.release(this)}};(function(){function a(){}if(!window.WebSocket){var b=window.console;if(!b||!b.log||!b.error)b={log:function(){},error:function(){}};if(h.hasFlashPlayerVersion("9.0.0")){location.protocol=="file:"&&b.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://...");
WebSocket=function(c,f,i,m,u){var s=this;s.readyState=WebSocket.CONNECTING;s.bufferedAmount=0;setTimeout(function(){WebSocket.__addTask(function(){s.__createFlash(c,f,i,m,u)})},0)};WebSocket.prototype.__createFlash=function(c,f,i,m,u){var s=this;s.__flash=WebSocket.__flash.create(c,f,i||null,m||0,u||null);s.__flash.addEventListener("event",function(){setTimeout(function(){s.__handleEvents()},0)})};WebSocket.prototype.send=function(c){if(!this.__flash||this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";
c=this.__flash.send(encodeURIComponent(c));if(c<0)return true;else{this.bufferedAmount+=c;return false}};WebSocket.prototype.close=function(){if(this.__flash)if(!(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING)){this.__flash.close();this.readyState=WebSocket.CLOSED;this.__timer&&clearInterval(this.__timer);this.onclose&&setTimeout(this.onclose,0)}};WebSocket.prototype.addEventListener=function(c,f){if(!("__events"in this))this.__events={};if(!(c in this.__events)){this.__events[c]=
[];if("function"==typeof this["on"+c]){this.__events[c].defaultHandler=this["on"+c];this["on"+c]=this.__createEventHandler(this,c)}}this.__events[c].push(f)};WebSocket.prototype.removeEventListener=function(c,f){if(!("__events"in this))this.__events={};if(c in this.__events)for(var i=this.__events.length;i>-1;--i)if(f===this.__events[c][i]){this.__events[c].splice(i,1);break}};WebSocket.prototype.dispatchEvent=function(c){if(!("__events"in this))throw"UNSPECIFIED_EVENT_TYPE_ERR";if(!(c.type in this.__events))throw"UNSPECIFIED_EVENT_TYPE_ERR";
for(var f=0,i=this.__events[c.type].length;f<i;++f){this.__events[c.type][f](c);if(c.cancelBubble)break}false!==c.returnValue&&"function"==typeof this.__events[c.type].defaultHandler&&this.__events[c.type].defaultHandler(c)};WebSocket.prototype.__handleEvents=function(){for(var c=this.__flash.receiveEvents(),f=0;f<c.length;f++)try{var i=c[f];if("readyState"in i)this.readyState=i.readyState;if(i.type=="open"){this.__timer&&clearInterval(this.__timer);if(window.opera)this.__timer=setInterval(function(){this.__handleEvents()},
500);this.onopen&&this.onopen()}else if(i.type=="close"){this.__timer&&clearInterval(this.__timer);this.onclose&&this.onclose()}else if(i.type=="message"){if(this.onmessage){var m=decodeURIComponent(i.data),u;if(window.MessageEvent&&!window.opera){u=document.createEvent("MessageEvent");u.initMessageEvent("message",false,false,m,null,null,window,null)}else u={data:m};this.onmessage(u)}}else if(i.type=="error"){this.__timer&&clearInterval(this.__timer);this.onerror&&this.onerror()}else throw"unknown event type: "+
i.type;}catch(s){b.error(s.toString())}};WebSocket.prototype.__createEventHandler=function(c,f){return function(i){var m=new a;m.initEvent(f,true,true);m.target=m.currentTarget=c;for(var u in i)m[u]=i[u];c.dispatchEvent(m,arguments)}};a.prototype.cancelable=true;a.prototype.cancelBubble=false;a.prototype.preventDefault=function(){if(this.cancelable)this.returnValue=false};a.prototype.stopPropagation=function(){this.cancelBubble=true};a.prototype.initEvent=function(c,f,i){this.type=c;this.cancelable=
i;this.timeStamp=new Date};WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=2;WebSocket.CLOSED=3;WebSocket.__tasks=[];WebSocket.loadFlashPolicyFile=function(c){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(c)})};WebSocket.__initialize=function(){if(WebSocket.__swfLocation)window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation;if(window.WEB_SOCKET_SWF_LOCATION){var c=document.createElement("div");c.id="webSocketContainer";c.style.position="absolute";if(WebSocket.__isFlashLite()){c.style.left=
"0px";c.style.top="0px"}else{c.style.left="-100px";c.style.top="-100px"}var f=document.createElement("div");f.id="webSocketFlash";c.appendChild(f);document.body.appendChild(c);h.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","9.0.0",null,{bridgeName:"webSocket"},{hasPriority:true,allowScriptAccess:"always"},null,function(i){i.success||b.error("[WebSocket] swfobject.embedSWF failed")});l.addInitializationCallback("webSocket",function(){try{WebSocket.__flash=l.webSocket.root();WebSocket.__flash.setCallerUrl(location.href);
WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var i=0;i<WebSocket.__tasks.length;++i)WebSocket.__tasks[i]();WebSocket.__tasks=[]}catch(m){b.error("[WebSocket] "+m.toString())}})}else b.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")};WebSocket.__addTask=function(c){WebSocket.__flash?c():WebSocket.__tasks.push(c)};WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return false;var c=window.navigator.mimeTypes["application/x-shockwave-flash"];
if(!c||!c.enabledPlugin||!c.enabledPlugin.filename)return false;return c.enabledPlugin.filename.match(/flashlite/i)?true:false};window.webSocketLog=function(c){b.log(decodeURIComponent(c))};window.webSocketError=function(c){b.error(decodeURIComponent(c))};window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",WebSocket.__initialize,false):window.attachEvent("onload",WebSocket.__initialize))}else b.error("Flash Player is not installed.")}})();return e.exports}();
var x=y.bind,I=y.copyArray;fin=new (function(){this.connect=function(d,e,h){if(this._socket)throw"fin.connect has already been called";this._doConnect(d,e,h)};this.create=function(d,e){if(typeof e!="function")throw"Second argument to fin.create should be a callback";for(var h in d)d[h]instanceof Array&&!d[h].length&&delete d[h];this.requestResponse("create",{data:d},e)};this.observe=function(d,e,h){if(typeof d!="number"||!e||!h)throw"observe requires three arguments: "+[itemId,e,h?"function":h].join(" ");
return this._observeChain(d,e,0,h,{})};this.set=function(d,e,h){this._mutate("set",d,e,[h])};this.release=function(d){var e=this._subIdToKey[d],h=F.getKeyInfo(e),a=h.id;this._subscriptionPool.remove(e,d);if(this._subscriptionPool.count(e)==0){a!=this._localID&&this.request("unsubscribe",{id:a,property:h.property});delete this._mutationCache[e];delete this._listLength[e]}delete this._subIdToKey[d];if(this._chainDependants[d]){this.release(this._chainDependants[d]);delete this._chainDependants[d]}};
this.getCachedMutation=function(d,e){var h=this._getItemID(d);return this._mutationCache[F.getItemPropertyKey(h,e)]};this.observeSet=function(d,e,h){this._observe({id:d,property:e,type:"SET"},h)};this.addToSet=function(d,e,h){this._mutate("sadd",d,e,[h])};this.removeFromSet=function(d,e,h){this._mutate("srem",d,e,[h])};this.observeList=function(d,e,h,a){if(typeof d!="number"||!e||!h)throw"observe requires at least three arguments: "+[itemName,e,h?"function":h,a].join(" ");h=this._observeChain(d,e,
0,h,{snapshot:false});this.extendList(d,e,a);return h};this._listLength={};this.extendList=function(d,e,h){if(typeof d!="number"||!e)throw"extendList requires a numeric ID and a property: "+[itemID,e].join(" ");this._resolvePropertyChain(d,e,x(this,function(a){var b=this._getItemID(a.id),c=a.property;a=F.getItemPropertyKey(b,c);var f=this._listLength[a]||0;if(!(h<=f)){this._listLength[a]=h;a={id:b,property:c,from:f};if(h)a.to=h;this.requestResponse("extend_list",a,x(this,function(i){this._handleMutation({id:b,
property:c,op:"push",args:i,index:f})}))}}))};this.push=function(d,e){var h=Array.prototype.slice.call(arguments,2);this._listOp(d,e,"push",h)};this.unshift=function(d,e){var h=Array.prototype.slice.call(arguments,2);this._listOp(d,e,"unshift",h)};this.request=function(d,e,h){e=e||{};e.request=d;this._send(e,h)};this.requestResponse=function(d,e,h,a){h=this._scheduleCallback(h);e.request=d;e._requestId=h;this._send(e,a)};this._send=function(d,e){var h=this._transactionStack[this._transactionStack.length-
1];h&&e?this._transactions[h].actions.push(d):this._socket.send(d)};this.handle=function(d,e){this._eventHandlers[d]=e};this.transact=function(d){var e="t"+this._uniqueRequestId++;this._transactions[e]={waitingFor:1,actions:[]};this._transactionStack.push(e);d(e);this._endTransaction(e)};this._endTransaction=function(d){var e=this._transactionStack.pop();if(e!=d)throw"transaction ID mismatch in _endTransaction! "+e+" "+d;if(!--this._transactions[e].waitingFor){this.request("transact",{actions:this._transactions[e].actions});
delete this._transactions[e]}};var l={resume:function(){},complete:function(){}};this._holdTransaction=function(){var d=this._transactionStack[this._transactionStack.length-1];if(!d)return l;this._transactions[d].waitingFor++;return{resume:function(){fin._transactionStack.push(d)},complete:function(){fin._endTransaction(d)}}};this.focus=function(d,e,h){var a=this._client.getSessionID(),b=F.getFocusProperty(e);e={session:a,user:gUserId,time:this.now()};var c,f;this.set(d,b,JSON.stringify(e));c=this._observe({id:d,
property:b,useCache:false,snapshot:false},x(this,function(i,m){if(c){var u;try{u=JSON.parse(m)}catch(s){}if(!(!u||u.session==a)){f();h(u)}}}));return f=x(this,function(){if(c){this.release(c);c=null;this.set(d,b,null)}})};this.now=function(){return(new Date).getTime()};this._init=function(){this._requestCallbacks={};this._eventHandlers={};this._transactions={};this._transactionStack=[];this.handle("mutation",x(this,"_onMutationMessage"))};this._doConnect=function(d,e,h){this._socket=new io.Socket(d,
{port:e,connectTimeout:500,transports:"websocket,xhr-multipart,flashsocket,htmlfile,xhr-polling,jsonp-polling".split(",")});this._socket.on("connect",x(this,h)).on("message",x(this,"_handleMessage")).on("disconnect",x(this,"_handleDisconnect"));this._socket.connect()};this._onMutationMessage=function(d){this._handleMutation(JSON.parse(d))};this._handleMessage=function(d){if(d.response)this._executeCallback(d.response,d.data);else if(this._eventHandlers[d.event])this._eventHandlers[d.event](d.data);
else throw"received unknown message: "+JSON.stringify(d);};this._handleDisconnect=function(){console.log("_handleDisconnect",arguments)};this._listOp=function(d,e,h,a){this._mutate(h,d,e,a)};this._chainDependants={};this._observeChain=function(d,e,h,a,b){var c=typeof e=="string"?e.split("."):e;e=c[h];var f,i,m;if(h==c.length-1){b.id=d;b.property=e;return this._observe(b,a)}else return f=this._observe({id:d,property:e},x(this,function(u,s){if(s!=m){m=s;i&&this.release(i);i=this._observeChain(s,c,h+
1,a,b);this._chainDependants[f]=i}}))};this._getItemID=function(d){return d=="LOCAL"?this._localID:d=="GLOBAL"?this._globalID:d};this._subIdToKey={};this._subscriptionPool=new G;this._observe=function(d,e){var h=this._getItemID(d.id),a=d.property,b=this._subscriptionPool,c=F.getItemPropertyKey(h,a),f=b.add(c,e),i=d.type||"BYTES",m=this._mutationCache[c];if(h==this._localID&&!m)m=this._getNullMutation(i);if(h!=this._localID&&b.count(c)==1){if(typeof h!="number")throw"Expected numeric ID but got: "+
h;h={id:h,property:a,type:i};if(typeof d.snapshot!="undefined")h.snapshot=d.snapshot;this.request("observe",h)}else m&&d.useCache!==false&&this._handleMutation(m,e);this._subIdToKey[f]=c;return f};this._getNullMutation=function(d){switch(d){case "LIST":case "BYTES":default:}return{op:"set",args:[""],value:""}};this._resolvePropertyChain=function(d,e,h){var a=typeof e=="string"?e.split("."):I(e);a.pop();if(a.length)var b=this._observeChain(d,a,0,x(this,function(){h(this._resolveCachedPropertyChain(d,
e));setTimeout(x(this,function(){this.release(b)}),0)}),{});else h(this._resolveCachedPropertyChain(d,e))};this._resolveCachedPropertyChain=function(d,e){for(var h=typeof e=="string"?e.split("."):I(e);h.length>1;)d=this.getCachedMutation(d,h.shift()).value;return{id:d,property:h[0]}};this._localID=-1;this._globalID=0;this._mutate=function(d,e,h,a){h=this._resolveCachedPropertyChain(e,h);e=this._getItemID(h.id);d={op:d,args:a,id:e,property:h.property};e!=this._localID&&this.request("mutate",{mutation:d},
true);this._handleMutation(d)};this._deserializeMutation=function(d){var e=d.args,h=d.op;switch(h){case "set":d.value=e[0];break;case "push":case "unshift":case "sadd":case "srem":for(d=0;d<e.length;d++)e[d]=e[d];break;case "increment":case "decrement":if(e.length)throw"Argument for operation without signature: "+h;break;case "add":case "subtract":if(e.length!=1)throw"Missing argument for: "+h;break;default:throw"Unknown operation for deserialization: "+h;}};this._mutationCache={};this._handleMutation=
function(d,e){if(e){[d.op].concat(d.args);e(d,d.value)}else{var h=F.getItemPropertyKey(d.id,d.property),a=this._subscriptionPool.get(h);this._deserializeMutation(d);this._cacheMutation(d,h);for(var b in a)a[b](d,d.value)}};this._cacheMutation=function(d,e){var h=this._mutationCache,a=h[e],b=a&&a.args,c=a&&a.value;if(!a)return h[e]=d;switch(d.op){case "set":h[e]=d;break;case "push":a.args=a.args.concat(d.args);break;case "unshift":a.args=d.args.concat(a.args);break;case "sadd":for(a=0;c=d.args[a];a++)b.indexOf(c)==
-1&&b.push(c);break;case "srem":for(a=0;c=d.args[a];a++)b.splice(b.indexOf(c),1);break;case "increment":a.value=d.value=(c||0)+1;break;case "decrement":a.value=d.value=(c||0)-1;break;case "add":a.value=d.value=(c||0)+d.args[0];break;case "subtract":a.value=d.value=(c||0)-d.args[0];break;default:throw"Unknown operation for caching: "+d.op;}return h[e]};this._uniqueRequestId=0;this._scheduleCallback=function(d){var e="r"+this._uniqueRequestId++;this._requestCallbacks[e]=d;return e};this._executeCallback=
function(d,e){var h=this._requestCallbacks[d];delete this._requestCallbacks[d];h(e)};this._init()});return w.exports}();fin.models={process:process,_waitForID:_waitForID};
var CustomModelPrototype=require._=function(){function w(){if(this._id)return this;d(this,function(){I(this,function(e){this._id=e;F.each(this._waitingForID,function(h){h(e)});delete this._waitingForID})});return this}var y=require["api/models/CustomModel"]={exports:{}};y.exports={_instantiate:function(e){var h;if(typeof e=="number")this._id=e;else h=e;h=h||{};for(var a in this._constructor.description){var b=F.bind(this,x,a,h[a],this._constructor.description[a]);F.defineGetter(this,a,b)}this._id===
undefined&&e!==undefined&&w.call(this)},create:w};var G=require._=function(){function e(q){this._value=q}function h(q,D){this._value=q;this._of=D;this._ofCustomModel=!!fin.models[this._of]}function a(q,D){this._value=q;this._of=D;this._ofCustomModel=!!fin.models[this._of]}function b(q){u(this,function(D,E){q(D,E)})}function c(q,D){u(this,function(E,z){z==q&&D(E,z)})}var f=require["api/models/propertyModels"]={exports:{}};f.exports={Text:e,Number:e,List:h,Set:a};var i=f.exports,m=require["api/fin/util"].exports;
e.prototype={observe:b,set:function(q){var D=this._propertyID,E=fin._holdTransaction();fin.models._waitForID(this._parent,function(z){E.resume();fin.set(z,[D],q);E.complete()})}};h.prototype={observe:b,on:c,push:function(q){T(this,"push",q)},unshift:function(q){T(this,"unshift",q)}};a.prototype={observe:b,on:c,add:function(q){T(this,"addToSet",q)},remove:function(q){T(this,"removeFromSet",q)}};var u=function(q,D){s(q,function(E){var z=q._of;z?fin[q instanceof a?"observeSet":"observeList"](E.id,E.chain,
function(J){var K=i[z]||fin.models[z],Q=J.op;m.each(J.args,function(M){D.call(q,new K(M),Q)})}):fin.observe(E.id,E.chain,function(J){D.call(q,J.args[0],J.op)})})},s=function(q,D){for(var E=[];q._parent;){E.unshift(q._propertyID);q=q._parent}fin.models._waitForID(q,function(z){D({id:z,chain:E})})},T=function(q,D,E){function z(K,Q){J.resume();fin[D](K,[q._propertyID],Q);J.complete()}var J=fin._holdTransaction();fin.models._waitForID(q._parent,function(K){q._ofCustomModel?fin.models._waitForID(E,function(Q){z(K,
Q)}):z(itemID,E._value)})};return f.exports}(),F=require["api/fin/util"].exports,x=function(e,h,a){var b=a.type;if(fin.models[b]){if(typeof h!="object"){b=fin.models[b];h=new b(h)}}else{b=G[b];h=new b(h,a.of)}delete this[e];this[e]=h;this[e]._propertyID=a.id;this[e]._parent=this;return this[e]},I=function(e,h){fin.create(l(e),function(a){h.call(e,a)})},l=function(e){var h={};F.each(e._constructor.description,function(a,b){var c=e[b];h[a.id]=fin.models[a.type]?c._id:c._value});return h},d=function(e,
h){function a(){--b||h.call(e)}var b=1;F.each(e._constructor.description,function(c,f){if(!G[c.type]){b++;fin.models._waitForID(e[f],a)}});a()};return y.exports}(),propertyModels=require["api/models/propertyModels"].exports;function process(w){for(var y in w){_validateModelDescription(y,w[y]);_createModelConstructor(y,w[y])}if(fin.models.Global)fin.models.global=new fin.models.Global(0);if(fin.models.Local)fin.models.local=new fin.models.Local(-1)}
var _validateModelDescription=function(w,y){var G=w.charCodeAt(0),F={};assert(65<=G&&G<=90,'Model names should start with an upper case letter. "'+w+'" does not.');assert(!fin.models[w],'Model "'+w+'" already exists');assert(!propertyModels[w],'Property model "'+w+'" already exists');for(propertyName in y){var x=y[propertyName];G=propertyName.charCodeAt(0);var I=x.type,l=x.of,d=I=="List"||I=="Set";x=x.id;var e=w+"."+propertyName;d&&assert(l,'Collections (Sets and Lists) require the "of" descriptor, e.g. { id:1, type:"List" of:"Number" }. "'+
e+'" is a "'+I+'" but it does not have one.');l&&assert(d,'Only collections (Sets and Lists) should have an "of" descriptor. "'+e+'" has one but should not since it is of type "'+I+'".');assert(d==!!l,"Only collections (Sets and Lists) ");assert(97<=G&&G<=122,'Property names should start with a lowercase letter. "'+e+'" does not.');assert(typeof x=="number"||typeof x=="string",'Properties need an id. "'+e+'" does not have one.');prefer(typeof x=="number",'For better performance property IDs should be numeric. "'+
e+'" has ID "'+x+'".');assert(!CustomModelPrototype[propertyName],'Certain property names would overwrite important model methods. "'+e+'" is such a property - pick a different property name.');assert(!F[x],'Property IDs need to be unique. "'+w+'" has two properties with the id '+x+', "'+w+"."+F[x]+'" and "'+e+'"');F[x]=propertyName}},_createModelConstructor=function(w,y){var G=fin.models[w]=function(I){this._constructor=fin.models[w];this._instantiate.call(this,I)},F=[];for(var x in y)F.push(y[x].id);
G.prototype=CustomModelPrototype;G.description=y};function _waitForID(w,y){if(w._id!==undefined)y(w._id);else if(w._waitingForID)w._waitingForID.push(y);else w._waitingForID=[y]}function assert(w,y){if(!w)throw Error(y);}function prefer(w,y){w||(window.console?console.log("Warning: "+y):alert("Warning: "+y))};
