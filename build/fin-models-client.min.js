/*
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
*/
var require={};
require._=function(){var w=require["/Library/WebServer/Documents/fun/lib/fin/api/client"]={exports:{}},y=require._=function(){function k(b,c,e){if(b){if(!e){e=c;c=this}if(Object.prototype.toString.call(b)==="[object Array]")for(var h=0;h<b.length;h++)e.call(c,b[h],h);else for(h in b)e.call(c,b[h],h)}}var p=require["/Library/WebServer/Documents/fun/lib/fin/api/fin/util"]={exports:{}};p.exports={bind:function(b,c){if(!b||!c||typeof c=="string"&&!b[c]){console.log("bad bind arguments");debugger}var e=
Array.prototype.slice.call(arguments,2);return function(){fn=typeof c=="string"?b[c]:c;return fn.apply(b,e.concat(Array.prototype.slice.call(arguments,0)))}},curry:function(b){var c=Array.prototype.slice.call(arguments,1);return function(){var e=c.concat(Array.prototype.slice.call(arguments,0));b.apply(this,e)}},blockCallback:function(b,c){c=c||{};c.fireOnce=typeof c.fireOnce!="undefined"?c.fireOnce:true;var e=0,h=false,l={addBlock:function(){e++;var s=false;return function(t){if(t&&c.throwErr)throw Error(t);
if(s)l.tryNow();else{s=true;e--;setTimeout(l.tryNow)}}},tryNow:function(){if(!(h&&c.fireOnce))if(e==0){h=true;b()}}};return l},each:k,map:function(b,c){var e=[];k(b,function(h,l){e.push(c(h,l))});return e},pick:function(b,c){for(var e=[],h=0,l;h<b.length;h++)(l=c(b[h]))&&e.push(l);return e},copyArray:function(b){return Array.prototype.slice.call(b,0)},defineGetter:function(b){var c=b.defineGetter?d:b.__defineGetter__?f:Object.defineProperty?a:function(){throw"defineGetter not supported";};p.exports.defineGetter=
c;c.apply(this,arguments)}};var d=function(b,c,e){b.defineGetter(c,e)},f=function(b,c,e){b.__defineGetter__(c,e)},a=function(b,c,e){Object.defineProperty(b,c,{value:e,enumerable:true,configurable:true})};return p.exports}(),G=require._=function(){var k=require["/Library/WebServer/Documents/fun/lib/fin/api/fin/Pool"]={exports:{}};k.exports=function(){this._pool={};this._counts={};this._uniqueId=0};k.exports.prototype={add:function(p,d){if(!this._pool[p]){this._pool[p]={};this._counts[p]=0}this._counts[p]++;
var f="p"+this._uniqueId++;this._pool[p][f]=d;return f},remove:function(p,d){var f=this._pool[p][d];delete this._pool[p][d];if(this._counts[p]--==0){delete this._counts[p];delete this._pool[p]}return f},get:function(p){return this._pool[p]},count:function(p){return this._counts[p]||0}};return k.exports}(),F=require._=function(){var k=require["/Library/WebServer/Documents/fun/lib/fin/api/fin/keys"]={exports:{}};k.exports={getItemPropertyKey:function(p,d){if(p===undefined||d===undefined)throw Error("itemID and propName are required for keys.getItemPropertyKey");
return"I"+p+"@"+d},getKeyInfo:function(p){var d=p[0];p=p.substr(1).split("@");return{type:d,id:parseInt(p[0]),property:p[1]}},getPropertyChannel:function(p){return"#P"+p},getFocusProperty:function(p){return"_focus_"+p},uniqueIdKey:"__fin_unique_id"};return k.exports}();require._=function(){function k(a,b){this.target=a;this.remoteTypeCache={};this.remoteInstanceCache={};this.remoteFunctionCache={};this.localFunctionCache={};this.bridgeID=k.nextBridgeID++;this.name=b;this.nextLocalFuncID=0;k.instances[this.name]=
this;k.idMap[this.bridgeID]=this;return this}function p(a){this.fb_instance_id=a;return this}var d=require["/Library/WebServer/Documents/fun/lib/fin/lib/socket.io/support/socket.io-client/socket.io"]={exports:{}};this.io={version:"0.6.2",setPath:function(a){window.console&&console.error&&console.error("io.setPath will be removed. Please set the variable WEB_SOCKET_SWF_LOCATION pointing to WebSocketMain.swf");this.path=/\/$/.test(a)?a:a+"/";WEB_SOCKET_SWF_LOCATION=a+"lib/vendor/web-socket-js/WebSocketMain.swf"}};
if("jQuery"in this)jQuery.io=this.io;if(typeof window!="undefined")if(typeof WEB_SOCKET_SWF_LOCATION==="undefined")WEB_SOCKET_SWF_LOCATION="/socket.io/lib/vendor/web-socket-js/WebSocketMain.swf";(function(){var a=false;io.util={ios:false,load:function(b){if(/loaded|complete/.test(document.readyState)||a)return b();"attachEvent"in window?window.attachEvent("onload",b):window.addEventListener("load",b,false)},inherit:function(b,c){for(var e in c.prototype)b.prototype[e]=c.prototype[e]},indexOf:function(b,
c,e){var h=b.length;for(e=e<0?Math.max(0,h+e):e||0;e<h;e++)if(b[e]===c)return e;return-1},isArray:function(b){return Object.prototype.toString.call(b)==="[object Array]"},merge:function(b,c){for(var e in c)if(c.hasOwnProperty(e))b[e]=c[e]}};io.util.ios=/iphone|ipad/i.test(navigator.userAgent);io.util.android=/android/i.test(navigator.userAgent);io.util.opera=/opera/i.test(navigator.userAgent);io.util.load(function(){a=true})})();(function(){Transport=io.Transport=function(a,b){this.base=a;this.options=
{timeout:15E3};io.util.merge(this.options,b)};Transport.prototype.send=function(){throw Error("Missing send() implementation");};Transport.prototype.connect=function(){throw Error("Missing connect() implementation");};Transport.prototype.disconnect=function(){throw Error("Missing disconnect() implementation");};Transport.prototype._encode=function(a){var b="",c;a=io.util.isArray(a)?a:[a];for(var e=0,h=a.length;e<h;e++){if(a[e]===null||a[e]===undefined)c="";else{c=a[e];if(Object.prototype.toString.call(c)==
"[object Object]")if("JSON"in window)c="~j~"+JSON.stringify(c);else{"console"in window&&console.error&&console.error("Trying to encode as JSON, but JSON.stringify is missing.");c='{ "$error": "Invalid message" }'}else c=String(c)}c=c;b+="~m~"+c.length+"~m~"+c}return b};Transport.prototype._decode=function(a){var b=[],c,e;do{if(a.substr(0,3)!=="~m~")return b;a=a.substr(3);c="";for(var h=0,l=a.length;h<l;h++){e=Number(a.substr(h,1));if(a.substr(h,1)==e)c+=e;else{a=a.substr(c.length+3);c=Number(c);break}}b.push(a.substr(0,
c));a=a.substr(c)}while(a!=="");return b};Transport.prototype._onData=function(a){this._setTimeout();if((a=this._decode(a))&&a.length)for(var b=0,c=a.length;b<c;b++)this._onMessage(a[b])};Transport.prototype._setTimeout=function(){var a=this;this._timeout&&clearTimeout(this._timeout);this._timeout=setTimeout(function(){a._onTimeout()},this.options.timeout)};Transport.prototype._onTimeout=function(){this._onDisconnect()};Transport.prototype._onMessage=function(a){if(this.sessionid)if(a.substr(0,3)==
"~h~")this._onHeartbeat(a.substr(3));else a.substr(0,3)=="~j~"?this.base._onMessage(JSON.parse(a.substr(3))):this.base._onMessage(a);else{this.sessionid=a;this._onConnect()}};Transport.prototype._onHeartbeat=function(a){this.send("~h~"+a)};Transport.prototype._onConnect=function(){this.connected=true;this.connecting=false;this.base._onConnect();this._setTimeout()};Transport.prototype._onDisconnect=function(){this.connected=this.connecting=false;this.sessionid=null;this.base._onDisconnect()};Transport.prototype._prepareUrl=
function(){return(this.base.options.secure?"https":"http")+"://"+this.base.host+":"+this.base.options.port+"/"+this.base.options.resource+"/"+this.type+(this.sessionid?"/"+this.sessionid:"/")}})();(function(){var a=new Function,b;b="XMLHttpRequest"in window?(new XMLHttpRequest).withCredentials!=undefined:false;var c=function(h){if("XDomainRequest"in window&&h)return new XDomainRequest;if("XMLHttpRequest"in window&&(!h||b))return new XMLHttpRequest;if(!h){try{return new ActiveXObject("MSXML2.XMLHTTP")}catch(l){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(s){}}return false},
e=io.Transport.XHR=function(){io.Transport.apply(this,arguments);this._sendBuffer=[]};io.util.inherit(e,io.Transport);e.prototype.connect=function(){this._get();return this};e.prototype._checkSend=function(){if(!this._posting&&this._sendBuffer.length){var h=this._encode(this._sendBuffer);this._sendBuffer=[];this._send(h)}};e.prototype.send=function(h){io.util.isArray(h)?this._sendBuffer.push.apply(this._sendBuffer,h):this._sendBuffer.push(h);this._checkSend();return this};e.prototype._send=function(h){var l=
this;this._posting=true;this._sendXhr=this._request("send","POST");this._sendXhr.onreadystatechange=function(){var s;if(l._sendXhr.readyState==4){l._sendXhr.onreadystatechange=a;try{s=l._sendXhr.status}catch(t){}l._posting=false;s==200?l._checkSend():l._onDisconnect()}};this._sendXhr.send("data="+encodeURIComponent(h))};e.prototype.disconnect=function(){this._onDisconnect();return this};e.prototype._onDisconnect=function(){if(this._xhr){this._xhr.onreadystatechange=a;try{this._xhr.abort()}catch(h){}this._xhr=
null}if(this._sendXhr){this._sendXhr.onreadystatechange=a;try{this._sendXhr.abort()}catch(l){}this._sendXhr=null}this._sendBuffer=[];io.Transport.prototype._onDisconnect.call(this)};e.prototype._request=function(h,l,s){var t=c(this.base._isXDomain());if(s)t.multipart=true;t.open(l||"GET",this._prepareUrl()+(h?"/"+h:""));l=="POST"&&"setRequestHeader"in t&&t.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8");return t};e.check=function(h){try{if(c(h))return true}catch(l){}return false};
e.xdomainCheck=function(){return e.check(true)};e.request=c})();(function(){var a=io.Transport.websocket=function(){io.Transport.apply(this,arguments)};io.util.inherit(a,io.Transport);a.prototype.type="websocket";a.prototype.connect=function(){var b=this;this.socket=new WebSocket(this._prepareUrl());this.socket.onmessage=function(c){b._onData(c.data)};this.socket.onclose=function(){b._onClose()};this.socket.onerror=function(c){b._onError(c)};return this};a.prototype.send=function(b){this.socket&&
this.socket.send(this._encode(b));return this};a.prototype.disconnect=function(){this.socket&&this.socket.close();return this};a.prototype._onClose=function(){this._onDisconnect();return this};a.prototype._onError=function(b){this.base.emit("error",[b])};a.prototype._prepareUrl=function(){return(this.base.options.secure?"wss":"ws")+"://"+this.base.host+":"+this.base.options.port+"/"+this.base.options.resource+"/"+this.type+(this.sessionid?"/"+this.sessionid:"")};a.check=function(){return"WebSocket"in
window&&WebSocket.prototype&&WebSocket.prototype.send&&!!WebSocket.prototype.send.toString().match(/native/i)&&typeof WebSocket!=="undefined"};a.xdomainCheck=function(){return true}})();(function(){var a=io.Transport.flashsocket=function(){io.Transport.websocket.apply(this,arguments)};io.util.inherit(a,io.Transport.websocket);a.prototype.type="flashsocket";a.prototype.connect=function(){var b=this,c=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.connect.apply(b,c)});return this};
a.prototype.send=function(){var b=this,c=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.send.apply(b,c)});return this};a.check=function(){if(typeof WebSocket=="undefined"||!("__addTask"in WebSocket))return false;if(io.util.opera)return false;if("navigator"in window&&"plugins"in navigator&&navigator.plugins["Shockwave Flash"])return!!navigator.plugins["Shockwave Flash"].description;if("ActiveXObject"in window)try{return!!(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(b){}return false};
a.xdomainCheck=function(){return true}})();(function(){var a=io.Transport.htmlfile=function(){io.Transport.XHR.apply(this,arguments)};io.util.inherit(a,io.Transport.XHR);a.prototype.type="htmlfile";a.prototype._get=function(){var b=this;this._open();window.attachEvent("onunload",function(){b._destroy()})};a.prototype._open=function(){this._doc=new ActiveXObject("htmlfile");this._doc.open();this._doc.write("<html></html>");this._doc.parentWindow.s=this;this._doc.close();var b=this._doc.createElement("div");
this._doc.body.appendChild(b);this._iframe=this._doc.createElement("iframe");b.appendChild(this._iframe);this._iframe.src=this._prepareUrl()+"/"+ +new Date};a.prototype._=function(b,c){this._onData(b);var e=c.getElementsByTagName("script")[0];e.parentNode.removeChild(e)};a.prototype._destroy=function(){if(this._iframe){this._iframe.src="about:blank";this._doc=null;CollectGarbage()}};a.prototype.disconnect=function(){this._destroy();return io.Transport.XHR.prototype.disconnect.call(this)};a.check=
function(){if("ActiveXObject"in window)try{return new ActiveXObject("htmlfile")&&io.Transport.XHR.check()}catch(b){}return false};a.xdomainCheck=function(){return false}})();(function(){var a=io.Transport["xhr-multipart"]=function(){io.Transport.XHR.apply(this,arguments)};io.util.inherit(a,io.Transport.XHR);a.prototype.type="xhr-multipart";a.prototype._get=function(){var b=this;this._xhr=this._request("","GET",true);this._xhr.onreadystatechange=function(){b._xhr.readyState==4&&b._onData(b._xhr.responseText)};
this._xhr.send(null)};a.check=function(){return"XMLHttpRequest"in window&&"prototype"in XMLHttpRequest&&"multipart"in XMLHttpRequest.prototype};a.xdomainCheck=function(){return true}})();(function(){var a=new Function,b=io.Transport["xhr-polling"]=function(){io.Transport.XHR.apply(this,arguments)};io.util.inherit(b,io.Transport.XHR);b.prototype.type="xhr-polling";b.prototype.connect=function(){if(io.util.ios||io.util.android){var c=this;io.util.load(function(){setTimeout(function(){io.Transport.XHR.prototype.connect.call(c)},
10)})}else io.Transport.XHR.prototype.connect.call(this)};b.prototype._get=function(){var c=this;this._xhr=this._request(+new Date,"GET");this._xhr.onreadystatechange=function(){var e;if(c._xhr.readyState==4){c._xhr.onreadystatechange=a;try{e=c._xhr.status}catch(h){}if(e==200){c._onData(c._xhr.responseText);c._get()}else c._onDisconnect()}};this._xhr.send(null)};b.check=function(){return io.Transport.XHR.check()};b.xdomainCheck=function(){return io.Transport.XHR.xdomainCheck()}})();io.JSONP=[];JSONPPolling=
io.Transport["jsonp-polling"]=function(){io.Transport.XHR.apply(this,arguments);this._insertAt=document.getElementsByTagName("script")[0];this._index=io.JSONP.length;io.JSONP.push(this)};io.util.inherit(JSONPPolling,io.Transport["xhr-polling"]);JSONPPolling.prototype.type="jsonp-polling";JSONPPolling.prototype._send=function(a){function b(){c();e._posting=false;e._checkSend()}function c(){e._iframe&&e._form.removeChild(e._iframe);try{t=document.createElement('<iframe name="'+e._iframeId+'">')}catch(q){t=
document.createElement("iframe");t.name=e._iframeId}t.id=e._iframeId;e._form.appendChild(t);e._iframe=t}var e=this;if(!("_form"in this)){var h=document.createElement("FORM"),l=document.createElement("TEXTAREA"),s=this._iframeId="socket_io_iframe_"+this._index,t;h.style.position="absolute";h.style.top="-1000px";h.style.left="-1000px";h.target=s;h.method="POST";h.action=this._prepareUrl()+"/"+ +new Date+"/"+this._index;l.name="data";h.appendChild(l);this._insertAt.parentNode.insertBefore(h,this._insertAt);
document.body.appendChild(h);this._form=h;this._area=l}c();this._posting=true;this._area.value=a;try{this._form.submit()}catch(H){}if(this._iframe.attachEvent)t.onreadystatechange=function(){e._iframe.readyState=="complete"&&b()};else this._iframe.onload=b};JSONPPolling.prototype._get=function(){var a=this,b=document.createElement("SCRIPT");if(this._script){this._script.parentNode.removeChild(this._script);this._script=null}b.async=true;b.src=this._prepareUrl()+"/"+ +new Date+"/"+this._index;b.onerror=
function(){a._onDisconnect()};this._insertAt.parentNode.insertBefore(b,this._insertAt);this._script=b};JSONPPolling.prototype._=function(){this._onData.apply(this,arguments);this._get();return this};JSONPPolling.check=function(){return true};JSONPPolling.xdomainCheck=function(){return true};(function(){var a=io.Socket=function(b,c){this.host=b||document.domain;this.options={secure:false,document:document,port:document.location.port||80,resource:"socket.io",transports:["websocket","flashsocket","htmlfile",
"xhr-multipart","xhr-polling","jsonp-polling"],transportOptions:{"xhr-polling":{timeout:25E3},"jsonp-polling":{timeout:25E3}},connectTimeout:5E3,tryTransportsOnConnectTimeout:true,rememberTransport:true};io.util.merge(this.options,c);this.connecting=this.connected=false;this._events={};this.transport=this.getTransport();!this.transport&&"console"in window&&console.error("No transport available")};a.prototype.getTransport=function(b){var c=b||this.options.transports;if(this.options.rememberTransport&&
!b)if(b=this.options.document.cookie.match("(?:^|;)\\s*socketio=([^;]*)")){this._rememberedTransport=true;c=[decodeURIComponent(b[1])]}b=0;for(var e;e=c[b];b++)if(io.Transport[e]&&io.Transport[e].check()&&(!this._isXDomain()||io.Transport[e].xdomainCheck()))return new io.Transport[e](this,this.options.transportOptions[e]||{});return null};a.prototype.connect=function(){if(this.transport&&!this.connected){this.connecting&&this.disconnect();this.connecting=true;this.emit("connecting",[this.transport.type]);
this.transport.connect();if(this.options.connectTimeout){var b=this;this.connectTimeoutTimer=setTimeout(function(){if(!b.connected){b.disconnect();if(b.options.tryTransportsOnConnectTimeout&&!b._rememberedTransport){if(!b._remainingTransports)b._remainingTransports=b.options.transports.slice(0);for(var c=b._remainingTransports;c.length>0&&c.splice(0,1)[0]!=b.transport.type;);if(c.length){b.transport=b.getTransport(c);b.connect()}}if(!b._remainingTransports||b._remainingTransports.length==0)b.emit("connect_failed")}b._remainingTransports&&
b._remainingTransports.length==0&&delete b._remainingTransports},this.options.connectTimeout)}}return this};a.prototype.send=function(b){if(!this.transport||!this.transport.connected)return this._queue(b);this.transport.send(b);return this};a.prototype.disconnect=function(){this.connectTimeoutTimer&&clearTimeout(this.connectTimeoutTimer);this.transport.disconnect();return this};a.prototype.on=function(b,c){b in this._events||(this._events[b]=[]);this._events[b].push(c);return this};a.prototype.emit=
function(b,c){if(b in this._events)for(var e=this._events[b].concat(),h=0,l=e.length;h<l;h++)e[h].apply(this,c===undefined?[]:c);return this};a.prototype.removeEvent=function(b,c){if(b in this._events)for(var e=0,h=this._events[b].length;e<h;e++)this._events[b][e]==c&&this._events[b].splice(e,1);return this};a.prototype._queue=function(b){if(!("_queueStack"in this))this._queueStack=[];this._queueStack.push(b);return this};a.prototype._doQueue=function(){if(!("_queueStack"in this)||!this._queueStack.length)return this;
this.transport.send(this._queueStack);this._queueStack=[];return this};a.prototype._isXDomain=function(){return this.host!==document.domain};a.prototype._onConnect=function(){this.connected=true;this.connecting=false;this._doQueue();if(this.options.rememberTransport)this.options.document.cookie="socketio="+encodeURIComponent(this.transport.type);this.emit("connect")};a.prototype._onMessage=function(b){this.emit("message",[b])};a.prototype._onDisconnect=function(){var b=this.connected;this.connecting=
this.connected=false;this._queueStack=[];b&&this.emit("disconnect")};a.prototype.fire=a.prototype.emit;a.prototype.addListener=a.prototype.addEvent=a.prototype.addEventListener=a.prototype.on})();var f=function(){function a(){if(!U){try{var g=r.getElementsByTagName("body")[0].appendChild(r.createElement("span"));g.parentNode.removeChild(g)}catch(i){return}U=true;g=Y.length;for(var j=0;j<g;j++)Y[j]()}}function b(g){if(U)g();else Y[Y.length]=g}function c(g){if(typeof I.addEventListener!=A)I.addEventListener("load",
g,false);else if(typeof r.addEventListener!=A)r.addEventListener("load",g,false);else if(typeof I.attachEvent!=A)K(I,"onload",g);else if(typeof I.onload=="function"){var i=I.onload;I.onload=function(){i();g()}}else I.onload=g}function e(){var g=r.getElementsByTagName("body")[0],i=r.createElement(M);i.setAttribute("type",Z);var j=g.appendChild(i);if(j){var m=0;(function(){if(typeof j.GetVariable!=A){var n=j.GetVariable("$version");if(n){n=n.split(" ")[1].split(",");o.pv=[parseInt(n[0],10),parseInt(n[1],
10),parseInt(n[2],10)]}}else if(m<10){m++;setTimeout(arguments.callee,10);return}g.removeChild(i);j=null;h()})()}else h()}function h(){var g=Q.length;if(g>0)for(var i=0;i<g;i++){var j=Q[i].id,m=Q[i].callbackFn,n={success:false,id:j};if(o.pv[0]>0){var v=z(j);if(v)if(L(Q[i].swfVersion)&&!(o.wk&&o.wk<312)){N(j,true);if(m){n.success=true;n.ref=l(j);m(n)}}else if(Q[i].expressInstall&&s()){n={};n.data=Q[i].expressInstall;n.width=v.getAttribute("width")||"0";n.height=v.getAttribute("height")||"0";if(v.getAttribute("class"))n.styleclass=
v.getAttribute("class");if(v.getAttribute("align"))n.align=v.getAttribute("align");var u={};v=v.getElementsByTagName("param");for(var B=v.length,C=0;C<B;C++)if(v[C].getAttribute("name").toLowerCase()!="movie")u[v[C].getAttribute("name")]=v[C].getAttribute("value");t(n,u,j,m)}else{H(v);m&&m(n)}}else{N(j,true);if(m){if((j=l(j))&&typeof j.SetVariable!=A){n.success=true;n.ref=j}m(n)}}}}function l(g){var i=null;if((g=z(g))&&g.nodeName=="OBJECT")if(typeof g.SetVariable!=A)i=g;else if(g=g.getElementsByTagName(M)[0])i=
g;return i}function s(){return!$&&L("6.0.65")&&(o.win||o.mac)&&!(o.wk&&o.wk<312)}function t(g,i,j,m){$=true;fa=m||null;ha={success:false,id:j};var n=z(j);if(n){if(n.nodeName=="OBJECT"){W=q(n);aa=null}else{W=n;aa=j}g.id=ia;if(typeof g.width==A||!/%$/.test(g.width)&&parseInt(g.width,10)<310)g.width="310";if(typeof g.height==A||!/%$/.test(g.height)&&parseInt(g.height,10)<137)g.height="137";r.title=r.title.slice(0,47)+" - Flash Player Installation";m=o.ie&&o.win?"ActiveX":"PlugIn";m="MMredirectURL="+
I.location.toString().replace(/&/g,"%26")+"&MMplayerType="+m+"&MMdoctitle="+r.title;if(typeof i.flashvars!=A)i.flashvars+="&"+m;else i.flashvars=m;if(o.ie&&o.win&&n.readyState!=4){m=r.createElement("div");j+="SWFObjectNew";m.setAttribute("id",j);n.parentNode.insertBefore(m,n);n.style.display="none";(function(){n.readyState==4?n.parentNode.removeChild(n):setTimeout(arguments.callee,10)})()}D(g,i,j)}}function H(g){if(o.ie&&o.win&&g.readyState!=4){var i=r.createElement("div");g.parentNode.insertBefore(i,
g);i.parentNode.replaceChild(q(g),i);g.style.display="none";(function(){g.readyState==4?g.parentNode.removeChild(g):setTimeout(arguments.callee,10)})()}else g.parentNode.replaceChild(q(g),g)}function q(g){var i=r.createElement("div");if(o.win&&o.ie)i.innerHTML=g.innerHTML;else if(g=g.getElementsByTagName(M)[0])if(g=g.childNodes)for(var j=g.length,m=0;m<j;m++)!(g[m].nodeType==1&&g[m].nodeName=="PARAM")&&g[m].nodeType!=8&&i.appendChild(g[m].cloneNode(true));return i}function D(g,i,j){var m,n=z(j);if(o.wk&&
o.wk<312)return m;if(n){if(typeof g.id==A)g.id=j;if(o.ie&&o.win){var v="";for(var u in g)if(g[u]!=Object.prototype[u])if(u.toLowerCase()=="data")i.movie=g[u];else if(u.toLowerCase()=="styleclass")v+=' class="'+g[u]+'"';else if(u.toLowerCase()!="classid")v+=" "+u+'="'+g[u]+'"';u="";for(var B in i)if(i[B]!=Object.prototype[B])u+='<param name="'+B+'" value="'+i[B]+'" />';n.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+v+">"+u+"</object>";ba[ba.length]=g.id;m=z(g.id)}else{B=
r.createElement(M);B.setAttribute("type",Z);for(var C in g)if(g[C]!=Object.prototype[C])if(C.toLowerCase()=="styleclass")B.setAttribute("class",g[C]);else C.toLowerCase()!="classid"&&B.setAttribute(C,g[C]);for(v in i)if(i[v]!=Object.prototype[v]&&v.toLowerCase()!="movie"){g=B;u=v;C=i[v];j=r.createElement("param");j.setAttribute("name",u);j.setAttribute("value",C);g.appendChild(j)}n.parentNode.replaceChild(B,n);m=B}}return m}function E(g){var i=z(g);if(i&&i.nodeName=="OBJECT")if(o.ie&&o.win){i.style.display=
"none";(function(){if(i.readyState==4){var j=z(g);if(j){for(var m in j)if(typeof j[m]=="function")j[m]=null;j.parentNode.removeChild(j)}}else setTimeout(arguments.callee,10)})()}else i.parentNode.removeChild(i)}function z(g){var i=null;try{i=r.getElementById(g)}catch(j){}return i}function K(g,i,j){g.attachEvent(i,j);V[V.length]=[g,i,j]}function L(g){var i=o.pv;g=g.split(".");g[0]=parseInt(g[0],10);g[1]=parseInt(g[1],10)||0;g[2]=parseInt(g[2],10)||0;return i[0]>g[0]||i[0]==g[0]&&i[1]>g[1]||i[0]==g[0]&&
i[1]==g[1]&&i[2]>=g[2]?true:false}function R(g,i,j,m){if(!(o.ie&&o.mac)){var n=r.getElementsByTagName("head")[0];if(n){j=j&&typeof j=="string"?j:"screen";if(m)ga=O=null;if(!O||ga!=j){m=r.createElement("style");m.setAttribute("type","text/css");m.setAttribute("media",j);O=n.appendChild(m);if(o.ie&&o.win&&typeof r.styleSheets!=A&&r.styleSheets.length>0)O=r.styleSheets[r.styleSheets.length-1];ga=j}if(o.ie&&o.win)O&&typeof O.addRule==M&&O.addRule(g,i);else O&&typeof r.createTextNode!=A&&O.appendChild(r.createTextNode(g+
" {"+i+"}"))}}}function N(g,i){if(ja){var j=i?"visible":"hidden";if(U&&z(g))z(g).style.visibility=j;else R("#"+g,"visibility:"+j)}}function ka(g){return/[\\\"<>\.;]/.exec(g)!=null&&typeof encodeURIComponent!=A?encodeURIComponent(g):g}var A="undefined",M="object",Z="application/x-shockwave-flash",ia="SWFObjectExprInst",I=window,r=document,S=navigator,la=false,Y=[function(){la?e():h()}],Q=[],ba=[],V=[],W,aa,fa,ha,U=false,$=false,O,ga,ja=true,o=function(){var g=typeof r.getElementById!=A&&typeof r.getElementsByTagName!=
A&&typeof r.createElement!=A,i=S.userAgent.toLowerCase(),j=S.platform.toLowerCase(),m=j?/win/.test(j):/win/.test(i);j=j?/mac/.test(j):/mac/.test(i);i=/webkit/.test(i)?parseFloat(i.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false;var n=!+"\u000b1",v=[0,0,0],u=null;if(typeof S.plugins!=A&&typeof S.plugins["Shockwave Flash"]==M){if((u=S.plugins["Shockwave Flash"].description)&&!(typeof S.mimeTypes!=A&&S.mimeTypes[Z]&&!S.mimeTypes[Z].enabledPlugin)){la=true;n=false;u=u.replace(/^.*\s+(\S+\s+\S+$)/,
"$1");v[0]=parseInt(u.replace(/^(.*)\..*$/,"$1"),10);v[1]=parseInt(u.replace(/^.*\.(.*)\s.*$/,"$1"),10);v[2]=/[a-zA-Z]/.test(u)?parseInt(u.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof I.ActiveXObject!=A)try{var B=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(B)if(u=B.GetVariable("$version")){n=true;u=u.split(" ")[1].split(",");v=[parseInt(u[0],10),parseInt(u[1],10),parseInt(u[2],10)]}}catch(C){}return{w3:g,pv:v,wk:i,ie:n,win:m,mac:j}}();(function(){if(o.w3){if(typeof r.readyState!=
A&&r.readyState=="complete"||typeof r.readyState==A&&(r.getElementsByTagName("body")[0]||r.body))a();if(!U){typeof r.addEventListener!=A&&r.addEventListener("DOMContentLoaded",a,false);if(o.ie&&o.win){r.attachEvent("onreadystatechange",function(){if(r.readyState=="complete"){r.detachEvent("onreadystatechange",arguments.callee);a()}});I==top&&function(){if(!U){try{r.documentElement.doScroll("left")}catch(g){setTimeout(arguments.callee,0);return}a()}}()}o.wk&&function(){U||(/loaded|complete/.test(r.readyState)?
a():setTimeout(arguments.callee,0))}();c(a)}}})();(function(){o.ie&&o.win&&window.attachEvent("onunload",function(){for(var g=V.length,i=0;i<g;i++)V[i][0].detachEvent(V[i][1],V[i][2]);g=ba.length;for(i=0;i<g;i++)E(ba[i]);for(var j in o)o[j]=null;o=null;for(var m in f)f[m]=null;f=null})})();return{registerObject:function(g,i,j,m){if(o.w3&&g&&i){var n={};n.id=g;n.swfVersion=i;n.expressInstall=j;n.callbackFn=m;Q[Q.length]=n;N(g,false)}else m&&m({success:false,id:g})},getObjectById:function(g){if(o.w3)return l(g)},
embedSWF:function(g,i,j,m,n,v,u,B,C,X){var ca={success:false,id:i};if(o.w3&&!(o.wk&&o.wk<312)&&g&&i&&j&&m&&n){N(i,false);b(function(){j+="";m+="";var T={};if(C&&typeof C===M)for(var P in C)T[P]=C[P];T.data=g;T.width=j;T.height=m;P={};if(B&&typeof B===M)for(var da in B)P[da]=B[da];if(u&&typeof u===M)for(var ea in u)if(typeof P.flashvars!=A)P.flashvars+="&"+ea+"="+u[ea];else P.flashvars=ea+"="+u[ea];if(L(n)){da=D(T,P,i);T.id==i&&N(i,true);ca.success=true;ca.ref=da}else if(v&&s()){T.data=v;t(T,P,i,X);
return}else N(i,true);X&&X(ca)})}else X&&X(ca)},switchOffAutoHideShow:function(){ja=false},ua:o,getFlashPlayerVersion:function(){return{major:o.pv[0],minor:o.pv[1],release:o.pv[2]}},hasFlashPlayerVersion:L,createSWF:function(g,i,j){if(o.w3)return D(g,i,j)},showExpressInstall:function(g,i,j,m){o.w3&&s()&&t(g,i,j,m)},removeSWF:function(g){o.w3&&E(g)},createCSS:function(g,i,j,m){o.w3&&R(g,i,j,m)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(g){var i=r.location.search||r.location.hash;
if(i){if(/\?/.test(i))i=i.split("?")[1];if(g==null)return ka(i);i=i.split("&");for(var j=0;j<i.length;j++)if(i[j].substring(0,i[j].indexOf("="))==g)return ka(i[j].substring(i[j].indexOf("=")+1))}return""},expressInstallCallback:function(){if($){var g=z(ia);if(g&&W){g.parentNode.replaceChild(W,g);if(aa){N(aa,true);if(o.ie&&o.win)W.style.display="block"}fa&&fa(ha)}$=false}}}}();k.TYPE_ASINSTANCE=1;k.TYPE_ASFUNCTION=2;k.TYPE_JSFUNCTION=3;k.TYPE_ANONYMOUS=4;k.initCallbacks={};k.userTypes={};k.addToUserTypes=
function(){for(var a=0;a<arguments.length;a++)k.userTypes[arguments[a]]={typeName:arguments[a],enriched:false}};k.argsToArray=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c];return b};k.addInitializationCallback=function(a,b){var c=k.instances[a];if(c!=undefined)b.call(c);else{c=k.initCallbacks[a];if(c==null)k.initCallbacks[a]=c=[];c.push(b)}};k.nextBridgeID=0;k.instances={};k.idMap={};k.refCount=0;k.extractBridgeFromID=function(a){return k.idMap[a>>16]};k.attachBridge=function(a,b){var c=new k(a,
b);k[b]=c;var e=k.initCallbacks[b];if(e!=null){for(var h=0;h<e.length;h++)e[h].call(c);delete k.initCallbacks[b]}};k.blockedMethods={toString:true,get:true,set:true,call:true};k.prototype={root:function(){return this.deserialize(this.target.getRoot())},releaseASObjects:function(){return this.target.releaseASObjects()},releaseNamedASObject:function(a){return typeof a!="object"?false:this.target.releaseNamedASObject(a.fb_instance_id)},create:function(a){return this.deserialize(this.target.create(a))},
makeID:function(a){return(this.bridgeID<<16)+a},getPropertyFromAS:function(a,b){if(k.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{k.refCount++;retVal=this.target.getPropFromAS(a,b);retVal=this.handleError(retVal);k.refCount--;return retVal}},setPropertyInAS:function(a,b,c){if(k.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");
else{k.refCount++;retVal=this.target.setPropInAS(a,b,this.serialize(c));retVal=this.handleError(retVal);k.refCount--;return retVal}},callASFunction:function(a,b){if(k.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{k.refCount++;retVal=this.target.invokeASFunction(a,this.serialize(b));retVal=this.handleError(retVal);k.refCount--;return retVal}},callASMethod:function(a,
b,c){if(k.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{k.refCount++;c=this.serialize(c);retVal=this.target.invokeASMethod(a,b,c);retVal=this.handleError(retVal);k.refCount--;return retVal}},invokeLocalFunction:function(a,b){var c,e=this.localFunctionCache[a];if(e!=undefined)c=this.serialize(e.apply(null,this.deserialize(b)));return c},getTypeFromName:function(a){return this.remoteTypeCache[a]},
createProxy:function(a,b){var c=this.getTypeFromName(b);p.prototype=c;c=new p(a);return this.remoteInstanceCache[a]=c},getProxy:function(a){return this.remoteInstanceCache[a]},addTypeDataToCache:function(a){for(var b=new ASProxy(this,a.name),c=a.accessors,e=0;e<c.length;e++)this.addPropertyToType(b,c[e]);a=a.methods;for(e=0;e<a.length;e++)k.blockedMethods[a[e]]==undefined&&this.addMethodToType(b,a[e]);return this.remoteTypeCache[b.typeName]=b},addPropertyToType:function(a,b){var c=b.charAt(0),e;if(c>=
"a"&&c<="z"){e="get"+c.toUpperCase()+b.substr(1);c="set"+c.toUpperCase()+b.substr(1)}else{e="get"+b;c="set"+b}a[c]=function(h){this.bridge.setPropertyInAS(this.fb_instance_id,b,h)};a[e]=function(){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,b))}},addMethodToType:function(a,b){a[b]=function(){return this.bridge.deserialize(this.bridge.callASMethod(this.fb_instance_id,b,k.argsToArray(arguments)))}},getFunctionProxy:function(a){var b=this;if(this.remoteFunctionCache[a]==
null)this.remoteFunctionCache[a]=function(){b.callASFunction(a,k.argsToArray(arguments))};return this.remoteFunctionCache[a]},getFunctionID:function(a){if(a.__bridge_id__==undefined){a.__bridge_id__=this.makeID(this.nextLocalFuncID++);this.localFunctionCache[a.__bridge_id__]=a}return a.__bridge_id__},serialize:function(a){var b={},c=typeof a;if(c=="number"||c=="string"||c=="boolean"||c==null||c==undefined)b=a;else if(a instanceof Array){b=[];for(c=0;c<a.length;c++)b[c]=this.serialize(a[c])}else if(c==
"function"){b.type=k.TYPE_JSFUNCTION;b.value=this.getFunctionID(a)}else if(a instanceof ASProxy){b.type=k.TYPE_ASINSTANCE;b.value=a.fb_instance_id}else{b.type=k.TYPE_ANONYMOUS;b.value=a}return b},deserialize:function(a){var b,c=typeof a;if(c=="number"||c=="string"||c=="boolean"||a==null||a==undefined)b=this.handleError(a);else if(a instanceof Array){b=[];for(c=0;c<a.length;c++)b[c]=this.deserialize(a[c])}else if(c=="object"){for(c=0;c<a.newTypes.length;c++)this.addTypeDataToCache(a.newTypes[c]);for(var e in a.newRefs)this.createProxy(e,
a.newRefs[e]);if(a.type==k.TYPE_PRIMITIVE)b=a.value;else if(a.type==k.TYPE_ASFUNCTION)b=this.getFunctionProxy(a.value);else if(a.type==k.TYPE_ASINSTANCE)b=this.getProxy(a.value);else if(a.type==k.TYPE_ANONYMOUS)b=a.value}return b},addRef:function(a){this.target.incRef(a.fb_instance_id)},release:function(a){this.target.releaseRef(a.fb_instance_id)},handleError:function(a){if(typeof a=="string"&&a.indexOf("__FLASHERROR")==0){a=a.split("||");k.refCount>0&&k.refCount--;throw Error(a[1]);}return a}};ASProxy=
function(a,b){this.bridge=a;this.typeName=b;return this};ASProxy.prototype={get:function(a){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,a))},set:function(a,b){this.bridge.setPropertyInAS(this.fb_instance_id,a,b)},call:function(a,b){this.bridge.callASMethod(this.fb_instance_id,a,b)},addRef:function(){this.bridge.addRef(this)},release:function(){this.bridge.release(this)}};(function(){function a(){}if(!window.WebSocket){var b=window.console;if(!b||!b.log||!b.error)b=
{log:function(){},error:function(){}};if(f.hasFlashPlayerVersion("9.0.0")){location.protocol=="file:"&&b.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://...");WebSocket=function(c,e,h,l,s){var t=this;t.readyState=WebSocket.CONNECTING;t.bufferedAmount=0;setTimeout(function(){WebSocket.__addTask(function(){t.__createFlash(c,e,h,l,s)})},0)};WebSocket.prototype.__createFlash=function(c,e,h,l,s){var t=
this;t.__flash=WebSocket.__flash.create(c,e,h||null,l||0,s||null);t.__flash.addEventListener("event",function(){setTimeout(function(){t.__handleEvents()},0)})};WebSocket.prototype.send=function(c){if(!this.__flash||this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";c=this.__flash.send(encodeURIComponent(c));if(c<0)return true;else{this.bufferedAmount+=c;return false}};WebSocket.prototype.close=function(){if(this.__flash)if(!(this.readyState==
WebSocket.CLOSED||this.readyState==WebSocket.CLOSING)){this.__flash.close();this.readyState=WebSocket.CLOSED;this.__timer&&clearInterval(this.__timer);this.onclose&&setTimeout(this.onclose,0)}};WebSocket.prototype.addEventListener=function(c,e){if(!("__events"in this))this.__events={};if(!(c in this.__events)){this.__events[c]=[];if("function"==typeof this["on"+c]){this.__events[c].defaultHandler=this["on"+c];this["on"+c]=this.__createEventHandler(this,c)}}this.__events[c].push(e)};WebSocket.prototype.removeEventListener=
function(c,e){if(!("__events"in this))this.__events={};if(c in this.__events)for(var h=this.__events.length;h>-1;--h)if(e===this.__events[c][h]){this.__events[c].splice(h,1);break}};WebSocket.prototype.dispatchEvent=function(c){if(!("__events"in this))throw"UNSPECIFIED_EVENT_TYPE_ERR";if(!(c.type in this.__events))throw"UNSPECIFIED_EVENT_TYPE_ERR";for(var e=0,h=this.__events[c.type].length;e<h;++e){this.__events[c.type][e](c);if(c.cancelBubble)break}false!==c.returnValue&&"function"==typeof this.__events[c.type].defaultHandler&&
this.__events[c.type].defaultHandler(c)};WebSocket.prototype.__handleEvents=function(){for(var c=this.__flash.receiveEvents(),e=0;e<c.length;e++)try{var h=c[e];if("readyState"in h)this.readyState=h.readyState;if(h.type=="open"){this.__timer&&clearInterval(this.__timer);if(window.opera)this.__timer=setInterval(function(){this.__handleEvents()},500);this.onopen&&this.onopen()}else if(h.type=="close"){this.__timer&&clearInterval(this.__timer);this.onclose&&this.onclose()}else if(h.type=="message"){if(this.onmessage){var l=
decodeURIComponent(h.data),s;if(window.MessageEvent&&!window.opera){s=document.createEvent("MessageEvent");s.initMessageEvent("message",false,false,l,null,null,window,null)}else s={data:l};this.onmessage(s)}}else if(h.type=="error"){this.__timer&&clearInterval(this.__timer);this.onerror&&this.onerror()}else throw"unknown event type: "+h.type;}catch(t){b.error(t.toString())}};WebSocket.prototype.__createEventHandler=function(c,e){return function(h){var l=new a;l.initEvent(e,true,true);l.target=l.currentTarget=
c;for(var s in h)l[s]=h[s];c.dispatchEvent(l,arguments)}};a.prototype.cancelable=true;a.prototype.cancelBubble=false;a.prototype.preventDefault=function(){if(this.cancelable)this.returnValue=false};a.prototype.stopPropagation=function(){this.cancelBubble=true};a.prototype.initEvent=function(c,e,h){this.type=c;this.cancelable=h;this.timeStamp=new Date};WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=2;WebSocket.CLOSED=3;WebSocket.__tasks=[];WebSocket.loadFlashPolicyFile=function(c){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(c)})};
WebSocket.__initialize=function(){if(WebSocket.__swfLocation)window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation;if(window.WEB_SOCKET_SWF_LOCATION){var c=document.createElement("div");c.id="webSocketContainer";c.style.position="absolute";if(WebSocket.__isFlashLite()){c.style.left="0px";c.style.top="0px"}else{c.style.left="-100px";c.style.top="-100px"}var e=document.createElement("div");e.id="webSocketFlash";c.appendChild(e);document.body.appendChild(c);f.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash",
"1","1","9.0.0",null,{bridgeName:"webSocket"},{hasPriority:true,allowScriptAccess:"always"},null,function(h){h.success||b.error("[WebSocket] swfobject.embedSWF failed")});k.addInitializationCallback("webSocket",function(){try{WebSocket.__flash=k.webSocket.root();WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var h=0;h<WebSocket.__tasks.length;++h)WebSocket.__tasks[h]();WebSocket.__tasks=[]}catch(l){b.error("[WebSocket] "+l.toString())}})}else b.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")};
WebSocket.__addTask=function(c){WebSocket.__flash?c():WebSocket.__tasks.push(c)};WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return false;var c=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!c||!c.enabledPlugin||!c.enabledPlugin.filename)return false;return c.enabledPlugin.filename.match(/flashlite/i)?true:false};window.webSocketLog=function(c){b.log(decodeURIComponent(c))};window.webSocketError=function(c){b.error(decodeURIComponent(c))};
window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",WebSocket.__initialize,false):window.attachEvent("onload",WebSocket.__initialize))}else b.error("Flash Player is not installed.")}})();return d.exports}();var x=y.bind,J=y.copyArray;fin=new (function(){function k(d){console.log("fin error:",d);debugger}this.connect=function(d,f,a){this._socket&&k("fin.connect has already been called");this._doConnect(d,f,a)};this.create=function(d,f){typeof f!="function"&&
k("Second argument to fin.create should be a callback");for(var a in d)d[a]instanceof Array&&!d[a].length&&delete d[a];this.requestResponse("create",{data:d},f)};this.observe=function(d,f,a){if(typeof d!="number"||!f||!a)k("observe requires three arguments: "+[itemId,f,a?"function":a].join(" "));return this._observeChain(d,f,0,a,{})};this.set=function(d,f,a){this._mutate("set",d,f,[a])};this.release=function(d){var f=this._subIdToKey[d],a=F.getKeyInfo(f),b=a.id;this._subscriptionPool.remove(f,d);
if(this._subscriptionPool.count(f)==0){b!=this._localID&&this.request("unsubscribe",{id:b,property:a.property});delete this._mutationCache[f];delete this._listLength[f]}delete this._subIdToKey[d];if(this._chainDependants[d]){this.release(this._chainDependants[d]);delete this._chainDependants[d]}};this.getCachedMutation=function(d,f){var a=this._getItemID(d);return this._mutationCache[F.getItemPropertyKey(a,f)]};this.observeSet=function(d,f,a){this._observe({id:d,property:f,type:"SET"},a)};this.addToSet=
function(d,f,a){this._mutate("sadd",d,f,[a])};this.removeFromSet=function(d,f,a){this._mutate("srem",d,f,[a])};this.observeList=function(d,f,a,b){if(typeof d!="number"||!f||!a)k("observe requires at least three arguments: "+[itemName,f,a?"function":a,b].join(" "));a=this._observeChain(d,f,0,a,{snapshot:false});this.extendList(d,f,b);return a};this._listLength={};this.extendList=function(d,f,a){if(typeof d!="number"||!f)k("extendList requires a numeric ID and a property: "+[itemID,f].join(" "));this._resolvePropertyChain(d,
f,x(this,function(b){var c=this._getItemID(b.id),e=b.property;b=F.getItemPropertyKey(c,e);var h=this._listLength[b]||0;if(!(a<=h)){this._listLength[b]=a;b={id:c,property:e,from:h};if(a)b.to=a;this.requestResponse("extend_list",b,x(this,function(l){this._handleMutation({id:c,property:e,op:"push",args:l,index:h})}))}}))};this.push=function(d,f){var a=Array.prototype.slice.call(arguments,2);this._listOp(d,f,"push",a)};this.unshift=function(d,f){var a=Array.prototype.slice.call(arguments,2);this._listOp(d,
f,"unshift",a)};this.request=function(d,f,a){f=f||{};f.request=d;this._send(f,a)};this.requestResponse=function(d,f,a,b){a=this._scheduleCallback(a);f.request=d;f._requestId=a;this._send(f,b)};this._send=function(d,f){var a=this._transactionStack[this._transactionStack.length-1];a&&f?this._transactions[a].actions.push(d):this._socket.send(d)};this.handle=function(d,f){this._eventHandlers[d]=f};this.transact=function(d){var f="t"+this._uniqueRequestId++;this._transactions[f]={waitingFor:1,actions:[]};
this._transactionStack.push(f);d(f);this._endTransaction(f)};this._endTransaction=function(d){var f=this._transactionStack.pop();f!=d&&k("transaction ID mismatch in _endTransaction! "+f+" "+d);if(!--this._transactions[f].waitingFor){this.request("transact",{actions:this._transactions[f].actions});delete this._transactions[f]}};var p={resume:function(){},complete:function(){}};this._holdTransaction=function(){var d=this._transactionStack[this._transactionStack.length-1];if(!d)return p;this._transactions[d].waitingFor++;
return{resume:function(){fin._transactionStack.push(d)},complete:function(){fin._endTransaction(d)}}};this.focus=function(d,f,a){var b=this._client.getSessionID(),c=F.getFocusProperty(f);f={session:b,user:gUserId,time:this.now()};var e,h;this.set(d,c,JSON.stringify(f));e=this._observe({id:d,property:c,useCache:false,snapshot:false},x(this,function(l,s){if(e){var t;try{t=JSON.parse(s)}catch(H){}if(!(!t||t.session==b)){h();a(t)}}}));return h=x(this,function(){if(e){this.release(e);e=null;this.set(d,
c,null)}})};this.now=function(){return(new Date).getTime()};this._init=function(){this._requestCallbacks={};this._eventHandlers={};this._transactions={};this._transactionStack=[];this.handle("mutation",x(this,"_onMutationMessage"))};this._doConnect=function(d,f,a){this._socket=new io.Socket(d,{port:f,connectTimeout:500,transports:"websocket,xhr-multipart,flashsocket,htmlfile,xhr-polling,jsonp-polling".split(",")});this._socket.on("connect",x(this,a)).on("message",x(this,"_handleMessage")).on("disconnect",
x(this,"_handleDisconnect"));this._socket.connect()};this._onMutationMessage=function(d){this._handleMutation(JSON.parse(d))};this._handleMessage=function(d){if(d.response)this._executeCallback(d.response,d.data);else this._eventHandlers[d.event]?this._eventHandlers[d.event](d.data):k("received unknown message: "+JSON.stringify(d))};this._handleDisconnect=function(){console.log("_handleDisconnect",arguments)};this._listOp=function(d,f,a,b){this._mutate(a,d,f,b)};this._chainDependants={};this._observeChain=
function(d,f,a,b,c){var e=typeof f=="string"?f.split("."):f;f=e[a];var h,l,s;if(a==e.length-1){c.id=d;c.property=f;return this._observe(c,b)}else return h=this._observe({id:d,property:f},x(this,function(t,H){if(H!=s){s=H;l&&this.release(l);l=this._observeChain(H,e,a+1,b,c);this._chainDependants[h]=l}}))};this._getItemID=function(d){return d=="LOCAL"?this._localID:d=="GLOBAL"?this._globalID:d};this._subIdToKey={};this._subscriptionPool=new G;this._observe=function(d,f){var a=this._getItemID(d.id),
b=d.property,c=this._subscriptionPool,e=F.getItemPropertyKey(a,b),h=c.add(e,f),l=d.type||"BYTES",s=this._mutationCache[e];if(a==this._localID&&!s)s=this._getNullMutation(l);if(a!=this._localID&&c.count(e)==1){typeof a!="number"&&k("Expected numeric ID but got: "+a);a={id:a,property:b,type:l};if(typeof d.snapshot!="undefined")a.snapshot=d.snapshot;this.request("observe",a)}else s&&d.useCache!==false&&this._handleMutation(s,f);this._subIdToKey[h]=e;return h};this._getNullMutation=function(d){switch(d){case "LIST":case "BYTES":default:}return{op:"set",
args:[""],value:""}};this._resolvePropertyChain=function(d,f,a){var b=typeof f=="string"?f.split("."):J(f);b.pop();if(b.length)var c=this._observeChain(d,b,0,x(this,function(){a(this._resolveCachedPropertyChain(d,f));setTimeout(x(this,function(){this.release(c)}),0)}),{});else a(this._resolveCachedPropertyChain(d,f))};this._resolveCachedPropertyChain=function(d,f){for(var a=typeof f=="string"?f.split("."):J(f);a.length>1;)d=this.getCachedMutation(d,a.shift()).value;return{id:d,property:a[0]}};this._localID=
-1;this._globalID=0;this._mutate=function(d,f,a,b){a=this._resolveCachedPropertyChain(f,a);f=this._getItemID(a.id);d={op:d,args:b,id:f,property:a.property};f!=this._localID&&this.request("mutate",{mutation:d},true);this._handleMutation(d)};this._deserializeMutation=function(d){var f=d.args,a=d.op;switch(a){case "set":d.value=f[0];break;case "push":case "unshift":case "sadd":case "srem":for(d=0;d<f.length;d++)f[d]=f[d];break;case "increment":case "decrement":f.length&&k("Argument for operation without signature: "+
a);break;case "add":case "subtract":f.length!=1&&k("Missing argument for: "+a);break;default:k("Unknown operation for deserialization: "+a)}};this._mutationCache={};this._handleMutation=function(d,f){if(f){[d.op].concat(d.args);f(d,d.value)}else{var a=F.getItemPropertyKey(d.id,d.property),b=this._subscriptionPool.get(a);this._deserializeMutation(d);this._cacheMutation(d,a);for(var c in b)b[c](d,d.value)}};this._cacheMutation=function(d,f){var a=this._mutationCache,b=a[f],c=b&&b.args,e=b&&b.value;
if(!b)return a[f]=d;switch(d.op){case "set":a[f]=d;break;case "push":b.args=b.args.concat(d.args);break;case "unshift":b.args=d.args.concat(b.args);break;case "sadd":for(b=0;e=d.args[b];b++)c.indexOf(e)==-1&&c.push(e);break;case "srem":for(b=0;e=d.args[b];b++)c.splice(c.indexOf(e),1);break;case "increment":b.value=d.value=(e||0)+1;break;case "decrement":b.value=d.value=(e||0)-1;break;case "add":b.value=d.value=(e||0)+d.args[0];break;case "subtract":b.value=d.value=(e||0)-d.args[0];break;default:k("Unknown operation for caching: "+
d.op)}return a[f]};this._uniqueRequestId=0;this._scheduleCallback=function(d){var f="r"+this._uniqueRequestId++;this._requestCallbacks[f]=d;return f};this._executeCallback=function(d,f){var a=this._requestCallbacks[d];delete this._requestCallbacks[d];a(f)};this._init()});return w.exports}();fin.models={process:process,_waitForID:_waitForID};
var CustomModelPrototype=require._=function(){function w(){if(this._id)return this;p(this,function(){J(this,function(d){this._id=d;F.each(this._waitingForID,function(f){f(d)});delete this._waitingForID})});return this}var y=require["/Library/WebServer/Documents/fun/lib/fin/api/models/CustomModel"]={exports:{}};y.exports={_instantiate:function(d){var f;if(typeof d=="number")this._id=d;else f=d;f=f||{};for(var a in this._constructor.description){var b=F.bind(this,x,a,f[a],this._constructor.description[a]);
F.defineGetter(this,a,b)}this._id===undefined&&d!==undefined&&w.call(this)},create:w};var G=require._=function(){function d(q){this._value=q}function f(q,D){this._value=q;this._of=D;this._ofCustomModel=!!fin.models[this._of]}function a(q,D){this._value=q;this._of=D;this._ofCustomModel=!!fin.models[this._of]}function b(q){s(this,function(D,E){q(D,E)})}function c(q,D){s(this,function(E,z){z==q&&D(E,z)})}var e=require["/Library/WebServer/Documents/fun/lib/fin/api/models/propertyModels"]={exports:{}};
e.exports={Text:d,Number:d,List:f,Set:a};var h=e.exports,l=require["/Library/WebServer/Documents/fun/lib/fin/api/fin/util"].exports;d.prototype={observe:b,set:function(q){var D=this._propertyID,E=fin._holdTransaction();fin.models._waitForID(this._parent,function(z){E.resume();fin.set(z,[D],q);E.complete()})}};f.prototype={observe:b,on:c,push:function(q){H(this,"push",q)},unshift:function(q){H(this,"unshift",q)}};a.prototype={observe:b,on:c,add:function(q){H(this,"addToSet",q)},remove:function(q){H(this,
"removeFromSet",q)}};var s=function(q,D){t(q,function(E){var z=q._of;z?fin[q instanceof a?"observeSet":"observeList"](E.id,E.chain,function(K){var L=h[z]||fin.models[z],R=K.op;l.each(K.args,function(N){D.call(q,new L(N),R)})}):fin.observe(E.id,E.chain,function(K){D.call(q,K.args[0],K.op)})})},t=function(q,D){for(var E=[];q._parent;){E.unshift(q._propertyID);q=q._parent}fin.models._waitForID(q,function(z){D({id:z,chain:E})})},H=function(q,D,E){function z(L,R){K.resume();fin[D](L,[q._propertyID],R);
K.complete()}var K=fin._holdTransaction();fin.models._waitForID(q._parent,function(L){q._ofCustomModel?fin.models._waitForID(E,function(R){z(L,R)}):z(itemID,E._value)})};return e.exports}(),F=require["/Library/WebServer/Documents/fun/lib/fin/api/fin/util"].exports,x=function(d,f,a){var b=a.type;if(fin.models[b]){if(typeof f!="object"){b=fin.models[b];f=new b(f)}}else{b=G[b];f=new b(f,a.of)}delete this[d];this[d]=f;this[d]._propertyID=a.id;this[d]._parent=this;return this[d]},J=function(d,f){fin.create(k(d),
function(a){f.call(d,a)})},k=function(d){var f={};F.each(d._constructor.description,function(a,b){var c=d[b];f[a.id]=fin.models[a.type]?c._id:c._value});return f},p=function(d,f){function a(){--b||f.call(d)}var b=1;F.each(d._constructor.description,function(c,e){if(!G[c.type]){b++;fin.models._waitForID(d[e],a)}});a()};return y.exports}(),propertyModels=require["/Library/WebServer/Documents/fun/lib/fin/api/models/propertyModels"].exports;
function process(w){for(var y in w){_validateModelDescription(y,w[y]);_createModelConstructor(y,w[y])}if(fin.models.Global)fin.models.global=new fin.models.Global(0);if(fin.models.Local)fin.models.local=new fin.models.Local(-1)}
var _validateModelDescription=function(w,y){var G=w.charCodeAt(0),F={};assert(65<=G&&G<=90,'Model names should start with an upper case letter. "'+w+'" does not.');assert(!fin.models[w],'Model "'+w+'" already exists');assert(!propertyModels[w],'Property model "'+w+'" already exists');for(propertyName in y){var x=y[propertyName];G=propertyName.charCodeAt(0);var J=x.type,k=x.of,p=J=="List"||J=="Set";x=x.id;var d=w+"."+propertyName;p&&assert(k,'Collections (Sets and Lists) require the "of" descriptor, e.g. { id:1, type:"List" of:"Number" }. "'+
d+'" is a "'+J+'" but it does not have one.');k&&assert(p,'Only collections (Sets and Lists) should have an "of" descriptor. "'+d+'" has one but should not since it is of type "'+J+'".');assert(p==!!k,"Only collections (Sets and Lists) ");assert(97<=G&&G<=122,'Property names should start with a lowercase letter. "'+d+'" does not.');assert(typeof x=="number"||typeof x=="string",'Properties need an id. "'+d+'" does not have one.');prefer(typeof x=="number",'For better performance property IDs should be numeric. "'+
d+'" has ID "'+x+'".');assert(!CustomModelPrototype[propertyName],'Certain property names would overwrite important model methods. "'+d+'" is such a property - pick a different property name.');assert(!F[x],'Property IDs need to be unique. "'+w+'" has two properties with the id '+x+', "'+w+"."+F[x]+'" and "'+d+'"');F[x]=propertyName}},_createModelConstructor=function(w,y){var G=fin.models[w]=function(J){this._constructor=fin.models[w];this._instantiate.call(this,J)},F=[];for(var x in y)F.push(y[x].id);
G.prototype=CustomModelPrototype;G.description=y};function _waitForID(w,y){if(w._id!==undefined)y(w._id);else if(w._waitingForID)w._waitingForID.push(y);else w._waitingForID=[y]}function assert(w,y){if(!w)throw Error(y);}function prefer(w,y){w||(window.console?console.log("Warning: "+y):alert("Warning: "+y))};
