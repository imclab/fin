/*
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
 The MIT license.
 @copyright Copyright (c) 2010 LearnBoost <dev@learnboost.com>
*/
var require={},util=require._=function(){function k(b,c,d){if(b){if(!d){d=c;c=this}if(Object.prototype.toString.call(b)==="[object Array]")for(var h=0;h<b.length;h++)d.call(c,b[h],h);else for(h in b)d.call(c,b[h],h)}}var q=require["/Library/WebServer/Documents/fun/lib/fin/api/fin/util"]={exports:{}};q.exports={bind:function(b,c){if(!b||!c||typeof c=="string"&&!b[c]){console.log("bad bind arguments");debugger}var d=Array.prototype.slice.call(arguments,2);return function(){fn=typeof c=="string"?b[c]:
c;return fn.apply(b,d.concat(Array.prototype.slice.call(arguments,0)))}},curry:function(b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.concat(Array.prototype.slice.call(arguments,0));b.apply(this,d)}},blockCallback:function(b,c){c=c||{};c.fireOnce=typeof c.fireOnce!="undefined"?c.fireOnce:true;var d=0,h=false,l={addBlock:function(){d++;var t=false;return function(r){if(r&&c.throwErr)throw Error(r);if(t)l.tryNow();else{t=true;d--;setTimeout(l.tryNow)}}},tryNow:function(){if(!(h&&
c.fireOnce))if(d==0){h=true;b()}}};return l},each:k,map:function(b,c){var d=[];k(b,function(h,l){d.push(c(h,l))});return d},pick:function(b,c){for(var d=[],h=0,l;h<b.length;h++)(l=c(b[h]))&&d.push(l);return d},copyArray:function(b){return Array.prototype.slice.call(b,0)},defineGetter:function(b){var c=b.defineGetter?e:b.__defineGetter__?g:Object.defineProperty?a:function(){throw"defineGetter not supported";};q.exports.defineGetter=c;c.apply(this,arguments)}};var e=function(b,c,d){b.defineGetter(c,
d)},g=function(b,c,d){b.__defineGetter__(c,d)},a=function(b,c,d){Object.defineProperty(b,c,{value:d,enumerable:true,configurable:true})};return q.exports}(),Pool=require._=function(){var k=require["/Library/WebServer/Documents/fun/lib/fin/api/fin/Pool"]={exports:{}};k.exports=function(){this._pool={};this._counts={};this._uniqueId=0};k.exports.prototype={add:function(q,e){if(!this._pool[q]){this._pool[q]={};this._counts[q]=0}this._counts[q]++;var g="p"+this._uniqueId++;this._pool[q][g]=e;return g},
remove:function(q,e){var g=this._pool[q][e];delete this._pool[q][e];if(this._counts[q]--==0){delete this._counts[q];delete this._pool[q]}return g},get:function(q){return this._pool[q]},count:function(q){return this._counts[q]||0}};return k.exports}(),keys=require._=function(){var k=require["/Library/WebServer/Documents/fun/lib/fin/api/fin/keys"]={exports:{}};k.exports={getItemPropertyKey:function(q,e){if(q===undefined||e===undefined)throw Error("itemID and propName are required for keys.getItemPropertyKey");
return"I"+q+"@"+e},getKeyInfo:function(q){var e=q[0];q=q.substr(1).split("@");return{type:e,id:parseInt(q[0]),property:q[1]}},getPropertyChannel:function(q){return"#P"+q},getFocusProperty:function(q){return"_focus_"+q},uniqueIdKey:"__fin_unique_id"};return k.exports}();
require._=function(){function k(a,b){this.target=a;this.remoteTypeCache={};this.remoteInstanceCache={};this.remoteFunctionCache={};this.localFunctionCache={};this.bridgeID=k.nextBridgeID++;this.name=b;this.nextLocalFuncID=0;k.instances[this.name]=this;k.idMap[this.bridgeID]=this;return this}function q(a){this.fb_instance_id=a;return this}var e=require["/Library/WebServer/Documents/fun/lib/fin/lib/socket.io/support/socket.io-client/socket.io"]={exports:{}};this.io={version:"0.6.2",setPath:function(a){window.console&&
console.error&&console.error("io.setPath will be removed. Please set the variable WEB_SOCKET_SWF_LOCATION pointing to WebSocketMain.swf");this.path=/\/$/.test(a)?a:a+"/";WEB_SOCKET_SWF_LOCATION=a+"lib/vendor/web-socket-js/WebSocketMain.swf"}};if("jQuery"in this)jQuery.io=this.io;if(typeof window!="undefined")if(typeof WEB_SOCKET_SWF_LOCATION==="undefined")WEB_SOCKET_SWF_LOCATION="/socket.io/lib/vendor/web-socket-js/WebSocketMain.swf";(function(){var a=false;io.util={ios:false,load:function(b){if(/loaded|complete/.test(document.readyState)||
a)return b();"attachEvent"in window?window.attachEvent("onload",b):window.addEventListener("load",b,false)},inherit:function(b,c){for(var d in c.prototype)b.prototype[d]=c.prototype[d]},indexOf:function(b,c,d){var h=b.length;for(d=d<0?Math.max(0,h+d):d||0;d<h;d++)if(b[d]===c)return d;return-1},isArray:function(b){return Object.prototype.toString.call(b)==="[object Array]"},merge:function(b,c){for(var d in c)if(c.hasOwnProperty(d))b[d]=c[d]}};io.util.ios=/iphone|ipad/i.test(navigator.userAgent);io.util.android=
/android/i.test(navigator.userAgent);io.util.opera=/opera/i.test(navigator.userAgent);io.util.load(function(){a=true})})();(function(){Transport=io.Transport=function(a,b){this.base=a;this.options={timeout:15E3};io.util.merge(this.options,b)};Transport.prototype.send=function(){throw Error("Missing send() implementation");};Transport.prototype.connect=function(){throw Error("Missing connect() implementation");};Transport.prototype.disconnect=function(){throw Error("Missing disconnect() implementation");
};Transport.prototype._encode=function(a){var b="",c;a=io.util.isArray(a)?a:[a];for(var d=0,h=a.length;d<h;d++){if(a[d]===null||a[d]===undefined)c="";else{c=a[d];if(Object.prototype.toString.call(c)=="[object Object]")if("JSON"in window)c="~j~"+JSON.stringify(c);else{"console"in window&&console.error&&console.error("Trying to encode as JSON, but JSON.stringify is missing.");c='{ "$error": "Invalid message" }'}else c=String(c)}c=c;b+="~m~"+c.length+"~m~"+c}return b};Transport.prototype._decode=function(a){var b=
[],c,d;do{if(a.substr(0,3)!=="~m~")return b;a=a.substr(3);c="";for(var h=0,l=a.length;h<l;h++){d=Number(a.substr(h,1));if(a.substr(h,1)==d)c+=d;else{a=a.substr(c.length+3);c=Number(c);break}}b.push(a.substr(0,c));a=a.substr(c)}while(a!=="");return b};Transport.prototype._onData=function(a){this._setTimeout();if((a=this._decode(a))&&a.length)for(var b=0,c=a.length;b<c;b++)this._onMessage(a[b])};Transport.prototype._setTimeout=function(){var a=this;this._timeout&&clearTimeout(this._timeout);this._timeout=
setTimeout(function(){a._onTimeout()},this.options.timeout)};Transport.prototype._onTimeout=function(){this._onDisconnect()};Transport.prototype._onMessage=function(a){if(this.sessionid)if(a.substr(0,3)=="~h~")this._onHeartbeat(a.substr(3));else a.substr(0,3)=="~j~"?this.base._onMessage(JSON.parse(a.substr(3))):this.base._onMessage(a);else{this.sessionid=a;this._onConnect()}};Transport.prototype._onHeartbeat=function(a){this.send("~h~"+a)};Transport.prototype._onConnect=function(){this.connected=
true;this.connecting=false;this.base._onConnect();this._setTimeout()};Transport.prototype._onDisconnect=function(){this.connected=this.connecting=false;this.sessionid=null;this.base._onDisconnect()};Transport.prototype._prepareUrl=function(){return(this.base.options.secure?"https":"http")+"://"+this.base.host+":"+this.base.options.port+"/"+this.base.options.resource+"/"+this.type+(this.sessionid?"/"+this.sessionid:"/")}})();(function(){var a=new Function,b;b="XMLHttpRequest"in window?(new XMLHttpRequest).withCredentials!=
undefined:false;var c=function(h){if("XDomainRequest"in window&&h)return new XDomainRequest;if("XMLHttpRequest"in window&&(!h||b))return new XMLHttpRequest;if(!h){try{return new ActiveXObject("MSXML2.XMLHTTP")}catch(l){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}return false},d=io.Transport.XHR=function(){io.Transport.apply(this,arguments);this._sendBuffer=[]};io.util.inherit(d,io.Transport);d.prototype.connect=function(){this._get();return this};d.prototype._checkSend=function(){if(!this._posting&&
this._sendBuffer.length){var h=this._encode(this._sendBuffer);this._sendBuffer=[];this._send(h)}};d.prototype.send=function(h){io.util.isArray(h)?this._sendBuffer.push.apply(this._sendBuffer,h):this._sendBuffer.push(h);this._checkSend();return this};d.prototype._send=function(h){var l=this;this._posting=true;this._sendXhr=this._request("send","POST");this._sendXhr.onreadystatechange=function(){var t;if(l._sendXhr.readyState==4){l._sendXhr.onreadystatechange=a;try{t=l._sendXhr.status}catch(r){}l._posting=
false;t==200?l._checkSend():l._onDisconnect()}};this._sendXhr.send("data="+encodeURIComponent(h))};d.prototype.disconnect=function(){this._onDisconnect();return this};d.prototype._onDisconnect=function(){if(this._xhr){this._xhr.onreadystatechange=a;try{this._xhr.abort()}catch(h){}this._xhr=null}if(this._sendXhr){this._sendXhr.onreadystatechange=a;try{this._sendXhr.abort()}catch(l){}this._sendXhr=null}this._sendBuffer=[];io.Transport.prototype._onDisconnect.call(this)};d.prototype._request=function(h,
l,t){var r=c(this.base._isXDomain());if(t)r.multipart=true;r.open(l||"GET",this._prepareUrl()+(h?"/"+h:""));l=="POST"&&"setRequestHeader"in r&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8");return r};d.check=function(h){try{if(c(h))return true}catch(l){}return false};d.xdomainCheck=function(){return d.check(true)};d.request=c})();(function(){var a=io.Transport.websocket=function(){io.Transport.apply(this,arguments)};io.util.inherit(a,io.Transport);a.prototype.type=
"websocket";a.prototype.connect=function(){var b=this;this.socket=new WebSocket(this._prepareUrl());this.socket.onmessage=function(c){b._onData(c.data)};this.socket.onclose=function(){b._onClose()};this.socket.onerror=function(c){b._onError(c)};return this};a.prototype.send=function(b){this.socket&&this.socket.send(this._encode(b));return this};a.prototype.disconnect=function(){this.socket&&this.socket.close();return this};a.prototype._onClose=function(){this._onDisconnect();return this};a.prototype._onError=
function(b){this.base.emit("error",[b])};a.prototype._prepareUrl=function(){return(this.base.options.secure?"wss":"ws")+"://"+this.base.host+":"+this.base.options.port+"/"+this.base.options.resource+"/"+this.type+(this.sessionid?"/"+this.sessionid:"")};a.check=function(){return"WebSocket"in window&&WebSocket.prototype&&WebSocket.prototype.send&&!!WebSocket.prototype.send.toString().match(/native/i)&&typeof WebSocket!=="undefined"};a.xdomainCheck=function(){return true}})();(function(){var a=io.Transport.flashsocket=
function(){io.Transport.websocket.apply(this,arguments)};io.util.inherit(a,io.Transport.websocket);a.prototype.type="flashsocket";a.prototype.connect=function(){var b=this,c=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.connect.apply(b,c)});return this};a.prototype.send=function(){var b=this,c=arguments;WebSocket.__addTask(function(){io.Transport.websocket.prototype.send.apply(b,c)});return this};a.check=function(){if(typeof WebSocket=="undefined"||!("__addTask"in WebSocket))return false;
if(io.util.opera)return false;if("navigator"in window&&"plugins"in navigator&&navigator.plugins["Shockwave Flash"])return!!navigator.plugins["Shockwave Flash"].description;if("ActiveXObject"in window)try{return!!(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(b){}return false};a.xdomainCheck=function(){return true}})();(function(){var a=io.Transport.htmlfile=function(){io.Transport.XHR.apply(this,arguments)};io.util.inherit(a,io.Transport.XHR);a.prototype.type="htmlfile";
a.prototype._get=function(){var b=this;this._open();window.attachEvent("onunload",function(){b._destroy()})};a.prototype._open=function(){this._doc=new ActiveXObject("htmlfile");this._doc.open();this._doc.write("<html></html>");this._doc.parentWindow.s=this;this._doc.close();var b=this._doc.createElement("div");this._doc.body.appendChild(b);this._iframe=this._doc.createElement("iframe");b.appendChild(this._iframe);this._iframe.src=this._prepareUrl()+"/"+ +new Date};a.prototype._=function(b,c){this._onData(b);
var d=c.getElementsByTagName("script")[0];d.parentNode.removeChild(d)};a.prototype._destroy=function(){if(this._iframe){this._iframe.src="about:blank";this._doc=null;CollectGarbage()}};a.prototype.disconnect=function(){this._destroy();return io.Transport.XHR.prototype.disconnect.call(this)};a.check=function(){if("ActiveXObject"in window)try{return new ActiveXObject("htmlfile")&&io.Transport.XHR.check()}catch(b){}return false};a.xdomainCheck=function(){return false}})();(function(){var a=io.Transport["xhr-multipart"]=
function(){io.Transport.XHR.apply(this,arguments)};io.util.inherit(a,io.Transport.XHR);a.prototype.type="xhr-multipart";a.prototype._get=function(){var b=this;this._xhr=this._request("","GET",true);this._xhr.onreadystatechange=function(){b._xhr.readyState==4&&b._onData(b._xhr.responseText)};this._xhr.send(null)};a.check=function(){return"XMLHttpRequest"in window&&"prototype"in XMLHttpRequest&&"multipart"in XMLHttpRequest.prototype};a.xdomainCheck=function(){return true}})();(function(){var a=new Function,
b=io.Transport["xhr-polling"]=function(){io.Transport.XHR.apply(this,arguments)};io.util.inherit(b,io.Transport.XHR);b.prototype.type="xhr-polling";b.prototype.connect=function(){if(io.util.ios||io.util.android){var c=this;io.util.load(function(){setTimeout(function(){io.Transport.XHR.prototype.connect.call(c)},10)})}else io.Transport.XHR.prototype.connect.call(this)};b.prototype._get=function(){var c=this;this._xhr=this._request(+new Date,"GET");this._xhr.onreadystatechange=function(){var d;if(c._xhr.readyState==
4){c._xhr.onreadystatechange=a;try{d=c._xhr.status}catch(h){}if(d==200){c._onData(c._xhr.responseText);c._get()}else c._onDisconnect()}};this._xhr.send(null)};b.check=function(){return io.Transport.XHR.check()};b.xdomainCheck=function(){return io.Transport.XHR.xdomainCheck()}})();io.JSONP=[];JSONPPolling=io.Transport["jsonp-polling"]=function(){io.Transport.XHR.apply(this,arguments);this._insertAt=document.getElementsByTagName("script")[0];this._index=io.JSONP.length;io.JSONP.push(this)};io.util.inherit(JSONPPolling,
io.Transport["xhr-polling"]);JSONPPolling.prototype.type="jsonp-polling";JSONPPolling.prototype._send=function(a){function b(){c();d._posting=false;d._checkSend()}function c(){d._iframe&&d._form.removeChild(d._iframe);try{r=document.createElement('<iframe name="'+d._iframeId+'">')}catch(M){r=document.createElement("iframe");r.name=d._iframeId}r.id=d._iframeId;d._form.appendChild(r);d._iframe=r}var d=this;if(!("_form"in this)){var h=document.createElement("FORM"),l=document.createElement("TEXTAREA"),
t=this._iframeId="socket_io_iframe_"+this._index,r;h.style.position="absolute";h.style.top="-1000px";h.style.left="-1000px";h.target=t;h.method="POST";h.action=this._prepareUrl()+"/"+ +new Date+"/"+this._index;l.name="data";h.appendChild(l);this._insertAt.parentNode.insertBefore(h,this._insertAt);document.body.appendChild(h);this._form=h;this._area=l}c();this._posting=true;this._area.value=a;try{this._form.submit()}catch(G){}if(this._iframe.attachEvent)r.onreadystatechange=function(){d._iframe.readyState==
"complete"&&b()};else this._iframe.onload=b};JSONPPolling.prototype._get=function(){var a=this,b=document.createElement("SCRIPT");if(this._script){this._script.parentNode.removeChild(this._script);this._script=null}b.async=true;b.src=this._prepareUrl()+"/"+ +new Date+"/"+this._index;b.onerror=function(){a._onDisconnect()};this._insertAt.parentNode.insertBefore(b,this._insertAt);this._script=b};JSONPPolling.prototype._=function(){this._onData.apply(this,arguments);this._get();return this};JSONPPolling.check=
function(){return true};JSONPPolling.xdomainCheck=function(){return true};(function(){var a=io.Socket=function(b,c){this.host=b||document.domain;this.options={secure:false,document:document,port:document.location.port||80,resource:"socket.io",transports:["websocket","flashsocket","htmlfile","xhr-multipart","xhr-polling","jsonp-polling"],transportOptions:{"xhr-polling":{timeout:25E3},"jsonp-polling":{timeout:25E3}},connectTimeout:5E3,tryTransportsOnConnectTimeout:true,rememberTransport:true};io.util.merge(this.options,
c);this.connecting=this.connected=false;this._events={};this.transport=this.getTransport();!this.transport&&"console"in window&&console.error("No transport available")};a.prototype.getTransport=function(b){var c=b||this.options.transports;if(this.options.rememberTransport&&!b)if(b=this.options.document.cookie.match("(?:^|;)\\s*socketio=([^;]*)")){this._rememberedTransport=true;c=[decodeURIComponent(b[1])]}b=0;for(var d;d=c[b];b++)if(io.Transport[d]&&io.Transport[d].check()&&(!this._isXDomain()||io.Transport[d].xdomainCheck()))return new io.Transport[d](this,
this.options.transportOptions[d]||{});return null};a.prototype.connect=function(){if(this.transport&&!this.connected){this.connecting&&this.disconnect();this.connecting=true;this.emit("connecting",[this.transport.type]);this.transport.connect();if(this.options.connectTimeout){var b=this;this.connectTimeoutTimer=setTimeout(function(){if(!b.connected){b.disconnect();if(b.options.tryTransportsOnConnectTimeout&&!b._rememberedTransport){if(!b._remainingTransports)b._remainingTransports=b.options.transports.slice(0);
for(var c=b._remainingTransports;c.length>0&&c.splice(0,1)[0]!=b.transport.type;);if(c.length){b.transport=b.getTransport(c);b.connect()}}if(!b._remainingTransports||b._remainingTransports.length==0)b.emit("connect_failed")}b._remainingTransports&&b._remainingTransports.length==0&&delete b._remainingTransports},this.options.connectTimeout)}}return this};a.prototype.send=function(b){if(!this.transport||!this.transport.connected)return this._queue(b);this.transport.send(b);return this};a.prototype.disconnect=
function(){this.connectTimeoutTimer&&clearTimeout(this.connectTimeoutTimer);this.transport.disconnect();return this};a.prototype.on=function(b,c){b in this._events||(this._events[b]=[]);this._events[b].push(c);return this};a.prototype.emit=function(b,c){if(b in this._events)for(var d=this._events[b].concat(),h=0,l=d.length;h<l;h++)d[h].apply(this,c===undefined?[]:c);return this};a.prototype.removeEvent=function(b,c){if(b in this._events)for(var d=0,h=this._events[b].length;d<h;d++)this._events[b][d]==
c&&this._events[b].splice(d,1);return this};a.prototype._queue=function(b){if(!("_queueStack"in this))this._queueStack=[];this._queueStack.push(b);return this};a.prototype._doQueue=function(){if(!("_queueStack"in this)||!this._queueStack.length)return this;this.transport.send(this._queueStack);this._queueStack=[];return this};a.prototype._isXDomain=function(){return this.host!==document.domain};a.prototype._onConnect=function(){this.connected=true;this.connecting=false;this._doQueue();if(this.options.rememberTransport)this.options.document.cookie=
"socketio="+encodeURIComponent(this.transport.type);this.emit("connect")};a.prototype._onMessage=function(b){this.emit("message",[b])};a.prototype._onDisconnect=function(){var b=this.connected;this.connecting=this.connected=false;this._queueStack=[];b&&this.emit("disconnect")};a.prototype.fire=a.prototype.emit;a.prototype.addListener=a.prototype.addEvent=a.prototype.addEventListener=a.prototype.on})();var g=function(){function a(){if(!H){try{var f=p.getElementsByTagName("body")[0].appendChild(p.createElement("span"));
f.parentNode.removeChild(f)}catch(i){return}H=true;f=N.length;for(var j=0;j<f;j++)N[j]()}}function b(f){if(H)f();else N[N.length]=f}function c(f){if(typeof y.addEventListener!=v)y.addEventListener("load",f,false);else if(typeof p.addEventListener!=v)p.addEventListener("load",f,false);else if(typeof y.attachEvent!=v)fa(y,"onload",f);else if(typeof y.onload=="function"){var i=y.onload;y.onload=function(){i();f()}}else y.onload=f}function d(){var f=p.getElementsByTagName("body")[0],i=p.createElement(A);
i.setAttribute("type",O);var j=f.appendChild(i);if(j){var m=0;(function(){if(typeof j.GetVariable!=v){var n=j.GetVariable("$version");if(n){n=n.split(" ")[1].split(",");o.pv=[parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10)]}}else if(m<10){m++;setTimeout(arguments.callee,10);return}f.removeChild(i);j=null;h()})()}else h()}function h(){var f=D.length;if(f>0)for(var i=0;i<f;i++){var j=D[i].id,m=D[i].callbackFn,n={success:false,id:j};if(o.pv[0]>0){var u=z(j);if(u)if(P(D[i].swfVersion)&&!(o.wk&&
o.wk<312)){I(j,true);if(m){n.success=true;n.ref=l(j);m(n)}}else if(D[i].expressInstall&&t()){n={};n.data=D[i].expressInstall;n.width=u.getAttribute("width")||"0";n.height=u.getAttribute("height")||"0";if(u.getAttribute("class"))n.styleclass=u.getAttribute("class");if(u.getAttribute("align"))n.align=u.getAttribute("align");var s={};u=u.getElementsByTagName("param");for(var w=u.length,x=0;x<w;x++)if(u[x].getAttribute("name").toLowerCase()!="movie")s[u[x].getAttribute("name")]=u[x].getAttribute("value");
r(n,s,j,m)}else{G(u);m&&m(n)}}else{I(j,true);if(m){if((j=l(j))&&typeof j.SetVariable!=v){n.success=true;n.ref=j}m(n)}}}}function l(f){var i=null;if((f=z(f))&&f.nodeName=="OBJECT")if(typeof f.SetVariable!=v)i=f;else if(f=f.getElementsByTagName(A)[0])i=f;return i}function t(){return!Q&&P("6.0.65")&&(o.win||o.mac)&&!(o.wk&&o.wk<312)}function r(f,i,j,m){Q=true;W=m||null;Z={success:false,id:j};var n=z(j);if(n){if(n.nodeName=="OBJECT"){K=M(n);R=null}else{K=n;R=j}f.id=$;if(typeof f.width==v||!/%$/.test(f.width)&&
parseInt(f.width,10)<310)f.width="310";if(typeof f.height==v||!/%$/.test(f.height)&&parseInt(f.height,10)<137)f.height="137";p.title=p.title.slice(0,47)+" - Flash Player Installation";m=o.ie&&o.win?"ActiveX":"PlugIn";m="MMredirectURL="+y.location.toString().replace(/&/g,"%26")+"&MMplayerType="+m+"&MMdoctitle="+p.title;if(typeof i.flashvars!=v)i.flashvars+="&"+m;else i.flashvars=m;if(o.ie&&o.win&&n.readyState!=4){m=p.createElement("div");j+="SWFObjectNew";m.setAttribute("id",j);n.parentNode.insertBefore(m,
n);n.style.display="none";(function(){n.readyState==4?n.parentNode.removeChild(n):setTimeout(arguments.callee,10)})()}X(f,i,j)}}function G(f){if(o.ie&&o.win&&f.readyState!=4){var i=p.createElement("div");f.parentNode.insertBefore(i,f);i.parentNode.replaceChild(M(f),i);f.style.display="none";(function(){f.readyState==4?f.parentNode.removeChild(f):setTimeout(arguments.callee,10)})()}else f.parentNode.replaceChild(M(f),f)}function M(f){var i=p.createElement("div");if(o.win&&o.ie)i.innerHTML=f.innerHTML;
else if(f=f.getElementsByTagName(A)[0])if(f=f.childNodes)for(var j=f.length,m=0;m<j;m++)!(f[m].nodeType==1&&f[m].nodeName=="PARAM")&&f[m].nodeType!=8&&i.appendChild(f[m].cloneNode(true));return i}function X(f,i,j){var m,n=z(j);if(o.wk&&o.wk<312)return m;if(n){if(typeof f.id==v)f.id=j;if(o.ie&&o.win){var u="";for(var s in f)if(f[s]!=Object.prototype[s])if(s.toLowerCase()=="data")i.movie=f[s];else if(s.toLowerCase()=="styleclass")u+=' class="'+f[s]+'"';else if(s.toLowerCase()!="classid")u+=" "+s+'="'+
f[s]+'"';s="";for(var w in i)if(i[w]!=Object.prototype[w])s+='<param name="'+w+'" value="'+i[w]+'" />';n.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+u+">"+s+"</object>";S[S.length]=f.id;m=z(f.id)}else{w=p.createElement(A);w.setAttribute("type",O);for(var x in f)if(f[x]!=Object.prototype[x])if(x.toLowerCase()=="styleclass")w.setAttribute("class",f[x]);else x.toLowerCase()!="classid"&&w.setAttribute(x,f[x]);for(u in i)if(i[u]!=Object.prototype[u]&&u.toLowerCase()!="movie"){f=
w;s=u;x=i[u];j=p.createElement("param");j.setAttribute("name",s);j.setAttribute("value",x);f.appendChild(j)}n.parentNode.replaceChild(w,n);m=w}}return m}function aa(f){var i=z(f);if(i&&i.nodeName=="OBJECT")if(o.ie&&o.win){i.style.display="none";(function(){if(i.readyState==4){var j=z(f);if(j){for(var m in j)if(typeof j[m]=="function")j[m]=null;j.parentNode.removeChild(j)}}else setTimeout(arguments.callee,10)})()}else i.parentNode.removeChild(i)}function z(f){var i=null;try{i=p.getElementById(f)}catch(j){}return i}
function fa(f,i,j){f.attachEvent(i,j);J[J.length]=[f,i,j]}function P(f){var i=o.pv;f=f.split(".");f[0]=parseInt(f[0],10);f[1]=parseInt(f[1],10)||0;f[2]=parseInt(f[2],10)||0;return i[0]>f[0]||i[0]==f[0]&&i[1]>f[1]||i[0]==f[0]&&i[1]==f[1]&&i[2]>=f[2]?true:false}function ba(f,i,j,m){if(!(o.ie&&o.mac)){var n=p.getElementsByTagName("head")[0];if(n){j=j&&typeof j=="string"?j:"screen";if(m)Y=B=null;if(!B||Y!=j){m=p.createElement("style");m.setAttribute("type","text/css");m.setAttribute("media",j);B=n.appendChild(m);
if(o.ie&&o.win&&typeof p.styleSheets!=v&&p.styleSheets.length>0)B=p.styleSheets[p.styleSheets.length-1];Y=j}if(o.ie&&o.win)B&&typeof B.addRule==A&&B.addRule(f,i);else B&&typeof p.createTextNode!=v&&B.appendChild(p.createTextNode(f+" {"+i+"}"))}}}function I(f,i){if(ca){var j=i?"visible":"hidden";if(H&&z(f))z(f).style.visibility=j;else ba("#"+f,"visibility:"+j)}}function da(f){return/[\\\"<>\.;]/.exec(f)!=null&&typeof encodeURIComponent!=v?encodeURIComponent(f):f}var v="undefined",A="object",O="application/x-shockwave-flash",
$="SWFObjectExprInst",y=window,p=document,E=navigator,ea=false,N=[function(){ea?d():h()}],D=[],S=[],J=[],K,R,W,Z,H=false,Q=false,B,Y,ca=true,o=function(){var f=typeof p.getElementById!=v&&typeof p.getElementsByTagName!=v&&typeof p.createElement!=v,i=E.userAgent.toLowerCase(),j=E.platform.toLowerCase(),m=j?/win/.test(j):/win/.test(i);j=j?/mac/.test(j):/mac/.test(i);i=/webkit/.test(i)?parseFloat(i.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false;var n=!+"\u000b1",u=[0,0,0],s=null;if(typeof E.plugins!=
v&&typeof E.plugins["Shockwave Flash"]==A){if((s=E.plugins["Shockwave Flash"].description)&&!(typeof E.mimeTypes!=v&&E.mimeTypes[O]&&!E.mimeTypes[O].enabledPlugin)){ea=true;n=false;s=s.replace(/^.*\s+(\S+\s+\S+$)/,"$1");u[0]=parseInt(s.replace(/^(.*)\..*$/,"$1"),10);u[1]=parseInt(s.replace(/^.*\.(.*)\s.*$/,"$1"),10);u[2]=/[a-zA-Z]/.test(s)?parseInt(s.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof y.ActiveXObject!=v)try{var w=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(w)if(s=w.GetVariable("$version")){n=
true;s=s.split(" ")[1].split(",");u=[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10)]}}catch(x){}return{w3:f,pv:u,wk:i,ie:n,win:m,mac:j}}();(function(){if(o.w3){if(typeof p.readyState!=v&&p.readyState=="complete"||typeof p.readyState==v&&(p.getElementsByTagName("body")[0]||p.body))a();if(!H){typeof p.addEventListener!=v&&p.addEventListener("DOMContentLoaded",a,false);if(o.ie&&o.win){p.attachEvent("onreadystatechange",function(){if(p.readyState=="complete"){p.detachEvent("onreadystatechange",
arguments.callee);a()}});y==top&&function(){if(!H){try{p.documentElement.doScroll("left")}catch(f){setTimeout(arguments.callee,0);return}a()}}()}o.wk&&function(){H||(/loaded|complete/.test(p.readyState)?a():setTimeout(arguments.callee,0))}();c(a)}}})();(function(){o.ie&&o.win&&window.attachEvent("onunload",function(){for(var f=J.length,i=0;i<f;i++)J[i][0].detachEvent(J[i][1],J[i][2]);f=S.length;for(i=0;i<f;i++)aa(S[i]);for(var j in o)o[j]=null;o=null;for(var m in g)g[m]=null;g=null})})();return{registerObject:function(f,
i,j,m){if(o.w3&&f&&i){var n={};n.id=f;n.swfVersion=i;n.expressInstall=j;n.callbackFn=m;D[D.length]=n;I(f,false)}else m&&m({success:false,id:f})},getObjectById:function(f){if(o.w3)return l(f)},embedSWF:function(f,i,j,m,n,u,s,w,x,L){var T={success:false,id:i};if(o.w3&&!(o.wk&&o.wk<312)&&f&&i&&j&&m&&n){I(i,false);b(function(){j+="";m+="";var F={};if(x&&typeof x===A)for(var C in x)F[C]=x[C];F.data=f;F.width=j;F.height=m;C={};if(w&&typeof w===A)for(var U in w)C[U]=w[U];if(s&&typeof s===A)for(var V in s)if(typeof C.flashvars!=
v)C.flashvars+="&"+V+"="+s[V];else C.flashvars=V+"="+s[V];if(P(n)){U=X(F,C,i);F.id==i&&I(i,true);T.success=true;T.ref=U}else if(u&&t()){F.data=u;r(F,C,i,L);return}else I(i,true);L&&L(T)})}else L&&L(T)},switchOffAutoHideShow:function(){ca=false},ua:o,getFlashPlayerVersion:function(){return{major:o.pv[0],minor:o.pv[1],release:o.pv[2]}},hasFlashPlayerVersion:P,createSWF:function(f,i,j){if(o.w3)return X(f,i,j)},showExpressInstall:function(f,i,j,m){o.w3&&t()&&r(f,i,j,m)},removeSWF:function(f){o.w3&&aa(f)},
createCSS:function(f,i,j,m){o.w3&&ba(f,i,j,m)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(f){var i=p.location.search||p.location.hash;if(i){if(/\?/.test(i))i=i.split("?")[1];if(f==null)return da(i);i=i.split("&");for(var j=0;j<i.length;j++)if(i[j].substring(0,i[j].indexOf("="))==f)return da(i[j].substring(i[j].indexOf("=")+1))}return""},expressInstallCallback:function(){if(Q){var f=z($);if(f&&K){f.parentNode.replaceChild(K,f);if(R){I(R,true);if(o.ie&&o.win)K.style.display="block"}W&&
W(Z)}Q=false}}}}();k.TYPE_ASINSTANCE=1;k.TYPE_ASFUNCTION=2;k.TYPE_JSFUNCTION=3;k.TYPE_ANONYMOUS=4;k.initCallbacks={};k.userTypes={};k.addToUserTypes=function(){for(var a=0;a<arguments.length;a++)k.userTypes[arguments[a]]={typeName:arguments[a],enriched:false}};k.argsToArray=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c];return b};k.addInitializationCallback=function(a,b){var c=k.instances[a];if(c!=undefined)b.call(c);else{c=k.initCallbacks[a];if(c==null)k.initCallbacks[a]=c=[];c.push(b)}};
k.nextBridgeID=0;k.instances={};k.idMap={};k.refCount=0;k.extractBridgeFromID=function(a){return k.idMap[a>>16]};k.attachBridge=function(a,b){var c=new k(a,b);k[b]=c;var d=k.initCallbacks[b];if(d!=null){for(var h=0;h<d.length;h++)d[h].call(c);delete k.initCallbacks[b]}};k.blockedMethods={toString:true,get:true,set:true,call:true};k.prototype={root:function(){return this.deserialize(this.target.getRoot())},releaseASObjects:function(){return this.target.releaseASObjects()},releaseNamedASObject:function(a){return typeof a!=
"object"?false:this.target.releaseNamedASObject(a.fb_instance_id)},create:function(a){return this.deserialize(this.target.create(a))},makeID:function(a){return(this.bridgeID<<16)+a},getPropertyFromAS:function(a,b){if(k.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{k.refCount++;retVal=this.target.getPropFromAS(a,b);retVal=this.handleError(retVal);k.refCount--;
return retVal}},setPropertyInAS:function(a,b,c){if(k.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{k.refCount++;retVal=this.target.setPropInAS(a,b,this.serialize(c));retVal=this.handleError(retVal);k.refCount--;return retVal}},callASFunction:function(a,b){if(k.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");
else{k.refCount++;retVal=this.target.invokeASFunction(a,this.serialize(b));retVal=this.handleError(retVal);k.refCount--;return retVal}},callASMethod:function(a,b,c){if(k.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{k.refCount++;c=this.serialize(c);retVal=this.target.invokeASMethod(a,b,c);retVal=this.handleError(retVal);k.refCount--;return retVal}},invokeLocalFunction:function(a,
b){var c,d=this.localFunctionCache[a];if(d!=undefined)c=this.serialize(d.apply(null,this.deserialize(b)));return c},getTypeFromName:function(a){return this.remoteTypeCache[a]},createProxy:function(a,b){var c=this.getTypeFromName(b);q.prototype=c;c=new q(a);return this.remoteInstanceCache[a]=c},getProxy:function(a){return this.remoteInstanceCache[a]},addTypeDataToCache:function(a){for(var b=new ASProxy(this,a.name),c=a.accessors,d=0;d<c.length;d++)this.addPropertyToType(b,c[d]);a=a.methods;for(d=0;d<
a.length;d++)k.blockedMethods[a[d]]==undefined&&this.addMethodToType(b,a[d]);return this.remoteTypeCache[b.typeName]=b},addPropertyToType:function(a,b){var c=b.charAt(0),d;if(c>="a"&&c<="z"){d="get"+c.toUpperCase()+b.substr(1);c="set"+c.toUpperCase()+b.substr(1)}else{d="get"+b;c="set"+b}a[c]=function(h){this.bridge.setPropertyInAS(this.fb_instance_id,b,h)};a[d]=function(){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,b))}},addMethodToType:function(a,b){a[b]=function(){return this.bridge.deserialize(this.bridge.callASMethod(this.fb_instance_id,
b,k.argsToArray(arguments)))}},getFunctionProxy:function(a){var b=this;if(this.remoteFunctionCache[a]==null)this.remoteFunctionCache[a]=function(){b.callASFunction(a,k.argsToArray(arguments))};return this.remoteFunctionCache[a]},getFunctionID:function(a){if(a.__bridge_id__==undefined){a.__bridge_id__=this.makeID(this.nextLocalFuncID++);this.localFunctionCache[a.__bridge_id__]=a}return a.__bridge_id__},serialize:function(a){var b={},c=typeof a;if(c=="number"||c=="string"||c=="boolean"||c==null||c==
undefined)b=a;else if(a instanceof Array){b=[];for(c=0;c<a.length;c++)b[c]=this.serialize(a[c])}else if(c=="function"){b.type=k.TYPE_JSFUNCTION;b.value=this.getFunctionID(a)}else if(a instanceof ASProxy){b.type=k.TYPE_ASINSTANCE;b.value=a.fb_instance_id}else{b.type=k.TYPE_ANONYMOUS;b.value=a}return b},deserialize:function(a){var b,c=typeof a;if(c=="number"||c=="string"||c=="boolean"||a==null||a==undefined)b=this.handleError(a);else if(a instanceof Array){b=[];for(c=0;c<a.length;c++)b[c]=this.deserialize(a[c])}else if(c==
"object"){for(c=0;c<a.newTypes.length;c++)this.addTypeDataToCache(a.newTypes[c]);for(var d in a.newRefs)this.createProxy(d,a.newRefs[d]);if(a.type==k.TYPE_PRIMITIVE)b=a.value;else if(a.type==k.TYPE_ASFUNCTION)b=this.getFunctionProxy(a.value);else if(a.type==k.TYPE_ASINSTANCE)b=this.getProxy(a.value);else if(a.type==k.TYPE_ANONYMOUS)b=a.value}return b},addRef:function(a){this.target.incRef(a.fb_instance_id)},release:function(a){this.target.releaseRef(a.fb_instance_id)},handleError:function(a){if(typeof a==
"string"&&a.indexOf("__FLASHERROR")==0){a=a.split("||");k.refCount>0&&k.refCount--;throw Error(a[1]);}return a}};ASProxy=function(a,b){this.bridge=a;this.typeName=b;return this};ASProxy.prototype={get:function(a){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,a))},set:function(a,b){this.bridge.setPropertyInAS(this.fb_instance_id,a,b)},call:function(a,b){this.bridge.callASMethod(this.fb_instance_id,a,b)},addRef:function(){this.bridge.addRef(this)},release:function(){this.bridge.release(this)}};
(function(){function a(){}if(!window.WebSocket){var b=window.console;if(!b||!b.log||!b.error)b={log:function(){},error:function(){}};if(g.hasFlashPlayerVersion("9.0.0")){location.protocol=="file:"&&b.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://...");WebSocket=function(c,d,h,l,t){var r=this;r.readyState=WebSocket.CONNECTING;r.bufferedAmount=0;setTimeout(function(){WebSocket.__addTask(function(){r.__createFlash(c,
d,h,l,t)})},0)};WebSocket.prototype.__createFlash=function(c,d,h,l,t){var r=this;r.__flash=WebSocket.__flash.create(c,d,h||null,l||0,t||null);r.__flash.addEventListener("event",function(){setTimeout(function(){r.__handleEvents()},0)})};WebSocket.prototype.send=function(c){if(!this.__flash||this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";c=this.__flash.send(encodeURIComponent(c));if(c<0)return true;else{this.bufferedAmount+=c;return false}};
WebSocket.prototype.close=function(){if(this.__flash)if(!(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING)){this.__flash.close();this.readyState=WebSocket.CLOSED;this.__timer&&clearInterval(this.__timer);this.onclose&&setTimeout(this.onclose,0)}};WebSocket.prototype.addEventListener=function(c,d){if(!("__events"in this))this.__events={};if(!(c in this.__events)){this.__events[c]=[];if("function"==typeof this["on"+c]){this.__events[c].defaultHandler=this["on"+c];this["on"+c]=
this.__createEventHandler(this,c)}}this.__events[c].push(d)};WebSocket.prototype.removeEventListener=function(c,d){if(!("__events"in this))this.__events={};if(c in this.__events)for(var h=this.__events.length;h>-1;--h)if(d===this.__events[c][h]){this.__events[c].splice(h,1);break}};WebSocket.prototype.dispatchEvent=function(c){if(!("__events"in this))throw"UNSPECIFIED_EVENT_TYPE_ERR";if(!(c.type in this.__events))throw"UNSPECIFIED_EVENT_TYPE_ERR";for(var d=0,h=this.__events[c.type].length;d<h;++d){this.__events[c.type][d](c);
if(c.cancelBubble)break}false!==c.returnValue&&"function"==typeof this.__events[c.type].defaultHandler&&this.__events[c.type].defaultHandler(c)};WebSocket.prototype.__handleEvents=function(){for(var c=this.__flash.receiveEvents(),d=0;d<c.length;d++)try{var h=c[d];if("readyState"in h)this.readyState=h.readyState;if(h.type=="open"){this.__timer&&clearInterval(this.__timer);if(window.opera)this.__timer=setInterval(function(){this.__handleEvents()},500);this.onopen&&this.onopen()}else if(h.type=="close"){this.__timer&&
clearInterval(this.__timer);this.onclose&&this.onclose()}else if(h.type=="message"){if(this.onmessage){var l=decodeURIComponent(h.data),t;if(window.MessageEvent&&!window.opera){t=document.createEvent("MessageEvent");t.initMessageEvent("message",false,false,l,null,null,window,null)}else t={data:l};this.onmessage(t)}}else if(h.type=="error"){this.__timer&&clearInterval(this.__timer);this.onerror&&this.onerror()}else throw"unknown event type: "+h.type;}catch(r){b.error(r.toString())}};WebSocket.prototype.__createEventHandler=
function(c,d){return function(h){var l=new a;l.initEvent(d,true,true);l.target=l.currentTarget=c;for(var t in h)l[t]=h[t];c.dispatchEvent(l,arguments)}};a.prototype.cancelable=true;a.prototype.cancelBubble=false;a.prototype.preventDefault=function(){if(this.cancelable)this.returnValue=false};a.prototype.stopPropagation=function(){this.cancelBubble=true};a.prototype.initEvent=function(c,d,h){this.type=c;this.cancelable=h;this.timeStamp=new Date};WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=
2;WebSocket.CLOSED=3;WebSocket.__tasks=[];WebSocket.loadFlashPolicyFile=function(c){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(c)})};WebSocket.__initialize=function(){if(WebSocket.__swfLocation)window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation;if(window.WEB_SOCKET_SWF_LOCATION){var c=document.createElement("div");c.id="webSocketContainer";c.style.position="absolute";if(WebSocket.__isFlashLite()){c.style.left="0px";c.style.top="0px"}else{c.style.left="-100px";c.style.top=
"-100px"}var d=document.createElement("div");d.id="webSocketFlash";c.appendChild(d);document.body.appendChild(c);g.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","9.0.0",null,{bridgeName:"webSocket"},{hasPriority:true,allowScriptAccess:"always"},null,function(h){h.success||b.error("[WebSocket] swfobject.embedSWF failed")});k.addInitializationCallback("webSocket",function(){try{WebSocket.__flash=k.webSocket.root();WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);
for(var h=0;h<WebSocket.__tasks.length;++h)WebSocket.__tasks[h]();WebSocket.__tasks=[]}catch(l){b.error("[WebSocket] "+l.toString())}})}else b.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")};WebSocket.__addTask=function(c){WebSocket.__flash?c():WebSocket.__tasks.push(c)};WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return false;var c=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!c||!c.enabledPlugin||!c.enabledPlugin.filename)return false;
return c.enabledPlugin.filename.match(/flashlite/i)?true:false};window.webSocketLog=function(c){b.log(decodeURIComponent(c))};window.webSocketError=function(c){b.error(decodeURIComponent(c))};window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",WebSocket.__initialize,false):window.attachEvent("onload",WebSocket.__initialize))}else b.error("Flash Player is not installed.")}})();return e.exports}();var bind=util.bind,forEach=util.forEach,copyArray=util.copyArray;
fin=new (function(){function k(e){console.log("fin error:",e);debugger}this.connect=function(e,g,a){this._socket&&k("fin.connect has already been called");this._doConnect(e,g,a)};this.create=function(e,g){typeof g!="function"&&k("Second argument to fin.create should be a callback");for(var a in e)e[a]instanceof Array&&!e[a].length&&delete e[a];this.requestResponse("create",{data:e},g)};this.observe=function(e,g,a){if(typeof e!="number"||!g||!a)k("observe requires three arguments: "+[itemId,g,a?"function":
a].join(" "));return this._observeChain(e,g,0,a,{})};this.set=function(e,g,a){this._mutate("set",e,g,[a])};this.release=function(e){var g=this._subIdToKey[e],a=keys.getKeyInfo(g),b=a.id;this._subscriptionPool.remove(g,e);if(this._subscriptionPool.count(g)==0){b!=this._localID&&this.request("unsubscribe",{id:b,property:a.property});delete this._mutationCache[g];delete this._listLength[g]}delete this._subIdToKey[e];if(this._chainDependants[e]){this.release(this._chainDependants[e]);delete this._chainDependants[e]}};
this.getCachedMutation=function(e,g){var a=this._getItemID(e);return this._mutationCache[keys.getItemPropertyKey(a,g)]};this.observeSet=function(e,g,a){this._observe({id:e,property:g,type:"SET"},a)};this.addToSet=function(e,g,a){this._mutate("sadd",e,g,[a])};this.removeFromSet=function(e,g,a){this._mutate("srem",e,g,[a])};this.observeList=function(e,g,a,b){if(typeof e!="number"||!g||!a)k("observe requires at least three arguments: "+[itemName,g,a?"function":a,b].join(" "));a=this._observeChain(e,
g,0,a,{snapshot:false});this.extendList(e,g,b);return a};this._listLength={};this.extendList=function(e,g,a){if(typeof e!="number"||!g)k("extendList requires a numeric ID and a property: "+[itemID,g].join(" "));this._resolvePropertyChain(e,g,bind(this,function(b){var c=this._getItemID(b.id),d=b.property;b=keys.getItemPropertyKey(c,d);var h=this._listLength[b]||0;if(!(a<=h)){this._listLength[b]=a;b={id:c,property:d,from:h};if(a)b.to=a;this.requestResponse("extend_list",b,bind(this,function(l){this._handleMutation({id:c,
property:d,op:"push",args:l,index:h})}))}}))};this.push=function(e,g){var a=Array.prototype.slice.call(arguments,2);this._listOp(e,g,"push",a)};this.unshift=function(e,g){var a=Array.prototype.slice.call(arguments,2);this._listOp(e,g,"unshift",a)};this.request=function(e,g,a){g=g||{};g.request=e;this._send(g,a)};this.requestResponse=function(e,g,a,b){a=this._scheduleCallback(a);g.request=e;g._requestId=a;this._send(g,b)};this._send=function(e,g){var a=this._transactionStack[this._transactionStack.length-
1];a&&g?this._transactions[a].actions.push(e):this._socket.send(e)};this.handle=function(e,g){this._eventHandlers[e]=g};this.transact=function(e){var g="t"+this._uniqueRequestId++;this._transactions[g]={waitingFor:1,actions:[]};this._transactionStack.push(g);e(g);this._endTransaction(g)};this._endTransaction=function(e){var g=this._transactionStack.pop();g!=e&&k("transaction ID mismatch in _endTransaction! "+g+" "+e);if(!--this._transactions[g].waitingFor){this.request("transact",{actions:this._transactions[g].actions});
delete this._transactions[g]}};var q={resume:function(){},complete:function(){}};this._holdTransaction=function(){var e=this._transactionStack[this._transactionStack.length-1];if(!e)return q;this._transactions[e].waitingFor++;return{resume:function(){fin._transactionStack.push(e)},complete:function(){fin._endTransaction(e)}}};this.focus=function(e,g,a){var b=this._client.getSessionID(),c=keys.getFocusProperty(g);g={session:b,user:gUserId,time:this.now()};var d,h;this.set(e,c,JSON.stringify(g));d=
this._observe({id:e,property:c,useCache:false,snapshot:false},bind(this,function(l,t){if(d){var r;try{r=JSON.parse(t)}catch(G){}if(!(!r||r.session==b)){h();a(r)}}}));return h=bind(this,function(){if(d){this.release(d);d=null;this.set(e,c,null)}})};this.now=function(){return(new Date).getTime()};this._init=function(){this._requestCallbacks={};this._eventHandlers={};this._transactions={};this._transactionStack=[];this.handle("mutation",bind(this,"_onMutationMessage"))};this._doConnect=function(e,g,
a){this._socket=new io.Socket(e,{port:g,connectTimeout:500,transports:"websocket,xhr-multipart,flashsocket,htmlfile,xhr-polling,jsonp-polling".split(",")});this._socket.on("connect",bind(this,a)).on("message",bind(this,"_handleMessage")).on("disconnect",bind(this,"_handleDisconnect"));this._socket.connect()};this._onMutationMessage=function(e){this._handleMutation(JSON.parse(e))};this._handleMessage=function(e){if(e.response)this._executeCallback(e.response,e.data);else this._eventHandlers[e.event]?
this._eventHandlers[e.event](e.data):k("received unknown message: "+JSON.stringify(e))};this._handleDisconnect=function(){console.log("_handleDisconnect",arguments)};this._listOp=function(e,g,a,b){this._mutate(a,e,g,b)};this._chainDependants={};this._observeChain=function(e,g,a,b,c){var d=typeof g=="string"?g.split("."):g;g=d[a];var h,l,t;if(a==d.length-1){c.id=e;c.property=g;return this._observe(c,b)}else return h=this._observe({id:e,property:g},bind(this,function(r,G){if(G!=t){t=G;l&&this.release(l);
l=this._observeChain(G,d,a+1,b,c);this._chainDependants[h]=l}}))};this._getItemID=function(e){return e=="LOCAL"?this._localID:e=="GLOBAL"?this._globalID:e};this._subIdToKey={};this._subscriptionPool=new Pool;this._observe=function(e,g){var a=this._getItemID(e.id),b=e.property,c=this._subscriptionPool,d=keys.getItemPropertyKey(a,b),h=c.add(d,g),l=e.type||"BYTES",t=this._mutationCache[d];if(a==this._localID&&!t)t=this._getNullMutation(l);if(a!=this._localID&&c.count(d)==1){typeof a!="number"&&k("Expected numeric ID but got: "+
a);a={id:a,property:b,type:l};if(typeof e.snapshot!="undefined")a.snapshot=e.snapshot;this.request("observe",a)}else t&&e.useCache!==false&&this._handleMutation(t,g);this._subIdToKey[h]=d;return h};this._getNullMutation=function(e){switch(e){case "LIST":case "BYTES":default:}return{op:"set",args:[""],value:""}};this._resolvePropertyChain=function(e,g,a){var b=typeof g=="string"?g.split("."):copyArray(g);b.pop();if(b.length)var c=this._observeChain(e,b,0,bind(this,function(){a(this._resolveCachedPropertyChain(e,
g));setTimeout(bind(this,function(){this.release(c)}),0)}),{});else a(this._resolveCachedPropertyChain(e,g))};this._resolveCachedPropertyChain=function(e,g){for(var a=typeof g=="string"?g.split("."):copyArray(g);a.length>1;)e=this.getCachedMutation(e,a.shift()).value;return{id:e,property:a[0]}};this._localID=-1;this._globalID=0;this._mutate=function(e,g,a,b){a=this._resolveCachedPropertyChain(g,a);g=this._getItemID(a.id);e={op:e,args:b,id:g,property:a.property};g!=this._localID&&this.request("mutate",
{mutation:e},true);this._handleMutation(e)};this._deserializeMutation=function(e){var g=e.args,a=e.op;switch(a){case "set":e.value=g[0];break;case "push":case "unshift":case "sadd":case "srem":for(e=0;e<g.length;e++)g[e]=g[e];break;case "increment":case "decrement":g.length&&k("Argument for operation without signature: "+a);break;case "add":case "subtract":g.length!=1&&k("Missing argument for: "+a);break;default:k("Unknown operation for deserialization: "+a)}};this._mutationCache={};this._handleMutation=
function(e,g){if(g){[e.op].concat(e.args);g(e,e.value)}else{var a=keys.getItemPropertyKey(e.id,e.property),b=this._subscriptionPool.get(a);this._deserializeMutation(e);this._cacheMutation(e,a);for(var c in b)b[c](e,e.value)}};this._cacheMutation=function(e,g){var a=this._mutationCache,b=a[g],c=b&&b.args,d=b&&b.value;if(!b)return a[g]=e;switch(e.op){case "set":a[g]=e;break;case "push":b.args=b.args.concat(e.args);break;case "unshift":b.args=e.args.concat(b.args);break;case "sadd":for(b=0;d=e.args[b];b++)c.indexOf(d)==
-1&&c.push(d);break;case "srem":for(b=0;d=e.args[b];b++)c.splice(c.indexOf(d),1);break;case "increment":b.value=e.value=(d||0)+1;break;case "decrement":b.value=e.value=(d||0)-1;break;case "add":b.value=e.value=(d||0)+e.args[0];break;case "subtract":b.value=e.value=(d||0)-e.args[0];break;default:k("Unknown operation for caching: "+e.op)}return a[g]};this._uniqueRequestId=0;this._scheduleCallback=function(e){var g="r"+this._uniqueRequestId++;this._requestCallbacks[g]=e;return g};this._executeCallback=
function(e,g){var a=this._requestCallbacks[e];delete this._requestCallbacks[e];a(g)};this._init()});
