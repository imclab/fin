var a={};(function(){function l(a,c,d){var e=a.defineGetter?m:a.__defineGetter__?n:Object.defineProperty?o:function(){throw"defineGetter not supported"};b.exports.defineGetter=e,e.apply(this,arguments)}function k(a){return Array.prototype.slice.call(a,0)}function j(a,b){b=b||{},b.fireOnce=typeof b.fireOnce!="undefined"?b.fireOnce:!0;var c=0,d=!1,e={addBlock:function(){c++;var a=!1;return function(d){if(d&&b.throwErr)throw new Error(d);a?e.tryNow():(a=!0,c--,setTimeout(e.tryNow))}},tryNow:function(){(!d||!b.fireOnce)&&c==0&&(d=!0,a())}};return e}function i(a){return Object.prototype.toString.call(a)==="[object Array]"}function h(a,b){var c=[];for(var d=0,e;d<a.length;d++)e=b(a[d]),e&&c.push(e);return c}function g(a,b){var c=[];f(a,function(a,d){c.push(b(a,d))});return c}function f(a,b,c){if(!!a){c||(c=b,b=this);if(i(a))for(var d=0;d<a.length;d++)c.call(b,a[d],d);else for(var e in a)c.call(b,a[e],e)}}function e(a,b){(!a||!b||typeof b=="string"&&!a[b])&&console.log("bad bind arguments");var c=Array.prototype.slice.call(arguments,2);return function(){fn=typeof b=="string"?a[b]:b;return fn.apply(a,c.concat(Array.prototype.slice.call(arguments,0)))}}function d(a){var b=Array.prototype.slice.call(arguments,1);return function(){var c=b.concat(Array.prototype.slice.call(arguments,0));a.apply(this,c)}}var b=a._1={exports:{}},c=b.exports;b.exports={bind:e,curry:d,blockCallback:j,each:f,map:g,pick:h,copyArray:k,defineGetter:l};var m=function(a,b,c){a.defineGetter(b,c)},n=function(a,b,c){a.__defineGetter__(b,c)},o=function(a,b,c){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0})}})(),function(){var b=a._2={exports:{}},c=b.exports;b.exports=function(){this._pool={},this._counts={},this._uniqueId=0},b.exports.prototype={add:function(a,b){this._pool[a]||(this._pool[a]={},this._counts[a]=0),this._counts[a]++;var c="p"+this._uniqueId++;this._pool[a][c]=b;return c},remove:function(a,b){var c=this._pool[a][b];delete this._pool[a][b],this._counts[a]--==0&&(delete this._counts[a],delete this._pool[a]);return c},get:function(a){return this._pool[a]},count:function(a){return this._counts[a]||0}}}(),function(){function g(a){return"_focus_"+a}function f(a){return"#P"+a}function e(a){var b=a[0],c=a.substr(1).split("@");return{type:b,id:parseInt(c[0]),property:c[1]}}function d(a,b){if(a===undefined||b===undefined)throw new Error("itemID and propName are required for keys.getItemPropertyKey");return"I"+a+"@"+b}var b=a._3={exports:{}},c=b.exports;b.exports={getItemPropertyKey:d,getKeyInfo:e,getPropertyChannel:f,getFocusProperty:g,uniqueIdKey:"__fin_unique_id"}}(),function(){var b=a._4={exports:{}},c=b.exports,d=b.exports=this.io={version:"0.6.2"};"jQuery"in this&&(jQuery.io=this.io),function(){var a=this.io,b=!1;a.util={ios:!1,load:function(a){if(/loaded|complete/.test(document.readyState)||b)return a();"attachEvent"in window?window.attachEvent("onload",a):window.addEventListener("load",a,!1)},inherit:function(a,b){for(var c in b.prototype)a.prototype[c]=b.prototype[c]},indexOf:function(a,b,c){for(var d=a.length,e=c<0?Math.max(0,d+c):c||0;e<d;e++)if(a[e]===b)return e;return-1},isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},merge:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}},a.util.ios=/iphone|ipad/i.test(navigator.userAgent),a.util.android=/android/i.test(navigator.userAgent),a.util.opera=/opera/i.test(navigator.userAgent),a.util.load(function(){b=!0})}(),function(){var a=this.io,b="~m~",c=function(a){if(Object.prototype.toString.call(a)=="[object Object]"){if(!("JSON"in window)){"console"in window&&console.error&&console.error("Trying to encode as JSON, but JSON.stringify is missing.");return'{ "$error": "Invalid message" }'}return"~j~"+JSON.stringify(a)}return String(a)};Transport=a.Transport=function(b,c){this.base=b,this.options={timeout:15e3},a.util.merge(this.options,c)},Transport.prototype.send=function(){throw new Error("Missing send() implementation")},Transport.prototype.connect=function(){throw new Error("Missing connect() implementation")},Transport.prototype.disconnect=function(){throw new Error("Missing disconnect() implementation")},Transport.prototype._encode=function(d){var e="",f,d=a.util.isArray(d)?d:[d];for(var g=0,h=d.length;g<h;g++)f=d[g]===null||d[g]===undefined?"":c(d[g]),e+=b+f.length+b+f;return e},Transport.prototype._decode=function(a){var c=[],d,e;do{if(a.substr(0,3)!==b)return c;a=a.substr(3),d="",e="";for(var f=0,g=a.length;f<g;f++){e=Number(a.substr(f,1));if(a.substr(f,1)==e)d+=e;else{a=a.substr(d.length+b.length),d=Number(d);break}}c.push(a.substr(0,d)),a=a.substr(d)}while(a!=="");return c},Transport.prototype._onData=function(a){this._setTimeout();var b=this._decode(a);if(b&&b.length)for(var c=0,d=b.length;c<d;c++)this._onMessage(b[c])},Transport.prototype._setTimeout=function(){var a=this;this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(){a._onTimeout()},this.options.timeout)},Transport.prototype._onTimeout=function(){this._onDisconnect()},Transport.prototype._onMessage=function(a){this.sessionid?a.substr(0,3)=="~h~"?this._onHeartbeat(a.substr(3)):a.substr(0,3)=="~j~"?this.base._onMessage(JSON.parse(a.substr(3))):this.base._onMessage(a):(this.sessionid=a,this._onConnect())},Transport.prototype._onHeartbeat=function(a){this.send("~h~"+a)},Transport.prototype._onConnect=function(){this.connected=!0,this.connecting=!1,this.base._onConnect(),this._setTimeout()},Transport.prototype._onDisconnect=function(){this.connecting=!1,this.connected=!1,this.sessionid=null,this.base._onDisconnect()},Transport.prototype._prepareUrl=function(){return(this.base.options.secure?"https":"http")+"://"+this.base.host+":"+this.base.options.port+"/"+this.base.options.resource+"/"+this.type+(this.sessionid?"/"+this.sessionid:"/")}}(),function(){var a=this.io,b=new Function,c=function(){if(!("XMLHttpRequest"in window))return!1;var a=new XMLHttpRequest;return a.withCredentials!=undefined}(),d=function(a){if("XDomainRequest"in window&&a)return new XDomainRequest;if("XMLHttpRequest"in window&&(!a||c))return new XMLHttpRequest;if(!a){try{var b=new ActiveXObject("MSXML2.XMLHTTP");return b}catch(d){}try{var e=new ActiveXObject("Microsoft.XMLHTTP");return e}catch(d){}}return!1},e=a.Transport.XHR=function(){a.Transport.apply(this,arguments),this._sendBuffer=[]};a.util.inherit(e,a.Transport),e.prototype.connect=function(){this._get();return this},e.prototype._checkSend=function(){if(!this._posting&&this._sendBuffer.length){var a=this._encode(this._sendBuffer);this._sendBuffer=[],this._send(a)}},e.prototype.send=function(b){a.util.isArray(b)?this._sendBuffer.push.apply(this._sendBuffer,b):this._sendBuffer.push(b),this._checkSend();return this},e.prototype._send=function(a){var c=this;this._posting=!0,this._sendXhr=this._request("send","POST"),this._sendXhr.onreadystatechange=function(){var a;if(c._sendXhr.readyState==4){c._sendXhr.onreadystatechange=b;try{a=c._sendXhr.status}catch(d){}c._posting=!1,a==200?c._checkSend():c._onDisconnect()}},this._sendXhr.send("data="+encodeURIComponent(a))},e.prototype.disconnect=function(){this._onDisconnect();return this},e.prototype._onDisconnect=function(){if(this._xhr){this._xhr.onreadystatechange=b;try{this._xhr.abort()}catch(c){}this._xhr=null}if(this._sendXhr){this._sendXhr.onreadystatechange=b;try{this._sendXhr.abort()}catch(c){}this._sendXhr=null}this._sendBuffer=[],a.Transport.prototype._onDisconnect.call(this)},e.prototype._request=function(a,b,c){var e=d(this.base._isXDomain());c&&(e.multipart=!0),e.open(b||"GET",this._prepareUrl()+(a?"/"+a:"")),b=="POST"&&"setRequestHeader"in e&&e.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8");return e},e.check=function(a){try{if(d(a))return!0}catch(b){}return!1},e.xdomainCheck=function(){return e.check(!0)},e.request=d}(),function(){var a=this.io,b=a.Transport.websocket=function(){a.Transport.apply(this,arguments)};a.util.inherit(b,a.Transport),b.prototype.type="websocket",b.prototype.connect=function(){var a=this;this.socket=new WebSocket(this._prepareUrl()),this.socket.onmessage=function(b){a._onData(b.data)},this.socket.onclose=function(b){a._onClose()},this.socket.onerror=function(b){a._onError(b)};return this},b.prototype.send=function(a){this.socket&&this.socket.send(this._encode(a));return this},b.prototype.disconnect=function(){this.socket&&this.socket.close();return this},b.prototype._onClose=function(){this._onDisconnect();return this},b.prototype._onError=function(a){this.base.emit("error",[a])},b.prototype._prepareUrl=function(){return(this.base.options.secure?"wss":"ws")+"://"+this.base.host+":"+this.base.options.port+"/"+this.base.options.resource+"/"+this.type+(this.sessionid?"/"+this.sessionid:"")},b.check=function(){return"WebSocket"in window&&WebSocket.prototype&&WebSocket.prototype.send&&!!WebSocket.prototype.send.toString().match(/native/i)&&typeof WebSocket!="undefined"},b.xdomainCheck=function(){return!0}}(),function(){var a=this.io,b=a.Transport.flashsocket=function(){a.Transport.websocket.apply(this,arguments)};a.util.inherit(b,a.Transport.websocket),b.prototype.type="flashsocket",b.prototype.connect=function(){var b=this,c=arguments;WebSocket.__addTask(function(){a.Transport.websocket.prototype.connect.apply(b,c)});return this},b.prototype.send=function(){var b=this,c=arguments;WebSocket.__addTask(function(){a.Transport.websocket.prototype.send.apply(b,c)});return this},b.check=function(){if(typeof WebSocket=="undefined"||!("__addTask"in WebSocket))return!1;if(a.util.opera)return!1;if("navigator"in window&&"plugins"in navigator&&navigator.plugins["Shockwave Flash"])return!!navigator.plugins["Shockwave Flash"].description;if("ActiveXObject"in window)try{return!!(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(b){}return!1},b.xdomainCheck=function(){return!0}}(),function(){var a=this.io,b=a.Transport.htmlfile=function(){a.Transport.XHR.apply(this,arguments)};a.util.inherit(b,a.Transport.XHR),b.prototype.type="htmlfile",b.prototype._get=function(){var a=this;this._open(),window.attachEvent("onunload",function(){a._destroy()})},b.prototype._open=function(){this._doc=new ActiveXObject("htmlfile"),this._doc.open(),this._doc.write("<html></html>"),this._doc.parentWindow.s=this,this._doc.close();var a=this._doc.createElement("div");this._doc.body.appendChild(a),this._iframe=this._doc.createElement("iframe"),a.appendChild(this._iframe),this._iframe.src=this._prepareUrl()+"/"+ +(new Date)},b.prototype._=function(a,b){this._onData(a);var c=b.getElementsByTagName("script")[0];c.parentNode.removeChild(c)},b.prototype._destroy=function(){this._iframe&&(this._iframe.src="about:blank",this._doc=null,CollectGarbage())},b.prototype.disconnect=function(){this._destroy();return a.Transport.XHR.prototype.disconnect.call(this)},b.check=function(){if("ActiveXObject"in window)try{var b=new ActiveXObject("htmlfile");return b&&a.Transport.XHR.check()}catch(c){}return!1},b.xdomainCheck=function(){return!1}}(),function(){var a=this.io,b=a.Transport["xhr-multipart"]=function(){a.Transport.XHR.apply(this,arguments)};a.util.inherit(b,a.Transport.XHR),b.prototype.type="xhr-multipart",b.prototype._get=function(){var a=this;this._xhr=this._request("","GET",!0),this._xhr.onreadystatechange=function(){a._xhr.readyState==4&&a._onData(a._xhr.responseText)},this._xhr.send(null)},b.check=function(){return"XMLHttpRequest"in window&&"prototype"in XMLHttpRequest&&"multipart"in XMLHttpRequest.prototype},b.xdomainCheck=function(){return!0}}(),function(){var a=this.io,b=new Function,c=a.Transport["xhr-polling"]=function(){a.Transport.XHR.apply(this,arguments)};a.util.inherit(c,a.Transport.XHR),c.prototype.type="xhr-polling",c.prototype.connect=function(){if(a.util.ios||a.util.android){var b=this;a.util.load(function(){setTimeout(function(){a.Transport.XHR.prototype.connect.call(b)},10)})}else a.Transport.XHR.prototype.connect.call(this)},c.prototype._get=function(){var a=this;this._xhr=this._request(+(new Date),"GET"),this._xhr.onreadystatechange=function(){var c;if(a._xhr.readyState==4){a._xhr.onreadystatechange=b;try{c=a._xhr.status}catch(d){}c==200?(a._onData(a._xhr.responseText),a._get()):a._onDisconnect()}},this._xhr.send(null)},c.check=function(){return a.Transport.XHR.check()},c.xdomainCheck=function(){return a.Transport.XHR.xdomainCheck()}}(),function(){var a=this.io;a.JSONP=[],JSONPPolling=a.Transport["jsonp-polling"]=function(){a.Transport.XHR.apply(this,arguments),this._insertAt=document.getElementsByTagName("script")[0],this._index=a.JSONP.length,a.JSONP.push(this)},a.util.inherit(JSONPPolling,a.Transport["xhr-polling"]),JSONPPolling.prototype.type="jsonp-polling",JSONPPolling.prototype._send=function(a){function h(){b._iframe&&b._form.removeChild(b._iframe);try{f=document.createElement('<iframe name="'+b._iframeId+'">')}catch(a){f=document.createElement("iframe"),f.name=b._iframeId}f.id=b._iframeId,b._form.appendChild(f),b._iframe=f}function g(){h(),b._posting=!1,b._checkSend()}var b=this;if(!("_form"in this)){var c=document.createElement("FORM"),d=document.createElement("TEXTAREA"),e=this._iframeId="socket_io_iframe_"+this._index,f;c.style.position="absolute",c.style.top="-1000px",c.style.left="-1000px",c.target=e,c.method="POST",c.action=this._prepareUrl()+"/"+ +(new Date)+"/"+this._index,d.name="data",c.appendChild(d),this._insertAt.parentNode.insertBefore(c,this._insertAt),document.body.appendChild(c),this._form=c,this._area=d}h(),this._posting=!0,this._area.value=a;try{this._form.submit()}catch(i){}this._iframe.attachEvent?f.onreadystatechange=function(){b._iframe.readyState=="complete"&&g()}:this._iframe.onload=g},JSONPPolling.prototype._get=function(){var a=this,b=document.createElement("SCRIPT");this._script&&(this._script.parentNode.removeChild(this._script),this._script=null),b.async=!0,b.src=this._prepareUrl()+"/"+ +(new Date)+"/"+this._index,b.onerror=function(){a._onDisconnect()},this._insertAt.parentNode.insertBefore(b,this._insertAt),this._script=b},JSONPPolling.prototype._=function(){this._onData.apply(this,arguments),this._get();return this},JSONPPolling.check=function(){return!0},JSONPPolling.xdomainCheck=function(){return!0}}(),function(){var a=this.io,b=a.Socket=function(b,c){this.host=b||document.domain,this.options={secure:!1,document:document,port:document.location.port||80,resource:"socket.io",transports:["websocket","flashsocket","htmlfile","xhr-multipart","xhr-polling","jsonp-polling"],transportOptions:{"xhr-polling":{timeout:25e3},"jsonp-polling":{timeout:25e3}},connectTimeout:5e3,reconnect:!0,reconnectionDelay:500,maxReconnectionAttempts:10,tryTransportsOnConnectTimeout:!0,rememberTransport:!0},a.util.merge(this.options,c),this.connected=!1,this.connecting=!1,this._events={},this.transport=this.getTransport(),!this.transport&&"console"in window&&console.error("No transport available")};b.prototype.getTransport=function(b){var c=b||this.options.transports,d;this.options.rememberTransport&&!b&&(d=this.options.document.cookie.match("(?:^|;)\\s*socketio=([^;]*)"),d&&(this._rememberedTransport=!0,c=[decodeURIComponent(d[1])]));for(var e=0,f;f=c[e];e++)if(a.Transport[f]&&a.Transport[f].check()&&(!this._isXDomain()||a.Transport[f].xdomainCheck()))return new a.Transport[f](this,this.options.transportOptions[f]||{});return null},b.prototype.connect=function(){if(this.transport&&!this.connected){this.connecting&&this.disconnect(!0),this.connecting=!0,this.emit("connecting",[this.transport.type]),this.transport.connect();if(this.options.connectTimeout){var a=this;this.connectTimeoutTimer=setTimeout(function(){if(!a.connected){a.disconnect(!0);if(a.options.tryTransportsOnConnectTimeout&&!a._rememberedTransport){a._remainingTransports||(a._remainingTransports=a.options.transports.slice(0));var b=a._remainingTransports;while(b.length>0&&b.splice(0,1)[0]!=a.transport.type);b.length&&(a.transport=a.getTransport(b),a.connect())}(!a._remainingTransports||a._remainingTransports.length==0)&&a.emit("connect_failed")}a._remainingTransports&&a._remainingTransports.length==0&&delete a._remainingTransports},this.options.connectTimeout)}}return this},b.prototype.send=function(a){if(!this.transport||!this.transport.connected)return this._queue(a);this.transport.send(a);return this},b.prototype.disconnect=function(a){this.connectTimeoutTimer&&clearTimeout(this.connectTimeoutTimer),a||(this.options.reconnect=!1),this.transport.disconnect();return this},b.prototype.on=function(a,b){a in this._events||(this._events[a]=[]),this._events[a].push(b);return this},b.prototype.emit=function(a,b){if(a in this._events){var c=this._events[a].concat();for(var d=0,e=c.length;d<e;d++)c[d].apply(this,b===undefined?[]:b)}return this},b.prototype.removeEvent=function(a,b){if(a in this._events)for(var c=0,d=this._events[a].length;c<d;c++)this._events[a][c]==b&&this._events[a].splice(c,1);return this},b.prototype._queue=function(a){"_queueStack"in this||(this._queueStack=[]),this._queueStack.push(a);return this},b.prototype._doQueue=function(){if(!("_queueStack"in this)||!this._queueStack.length)return this;this.transport.send(this._queueStack),this._queueStack=[];return this},b.prototype._isXDomain=function(){var a=window.location.port||80;return this.host!==document.domain||this.options.port!=a},b.prototype._onConnect=function(){this.connected=!0,this.connecting=!1,this._doQueue(),this.options.rememberTransport&&(this.options.document.cookie="socketio="+encodeURIComponent(this.transport.type)),this.emit("connect")},b.prototype._onMessage=function(a){this.emit("message",[a])},b.prototype._onDisconnect=function(){var a=this.connected;this.connected=!1,this.connecting=!1,this._queueStack=[],a&&(this.emit("disconnect"),this.options.reconnect&&!this.reconnecting&&this._onReconnect())},b.prototype._onReconnect=function(){function e(){if(!!a.reconnecting)if(!a.connected){if(a.connecting&&a.reconnecting)return a.reconnectionTimer=setTimeout(e,1e3);a.reconnectionAttempts++>=a.options.maxReconnectionAttempts?a.redoTransports?(a.emit("reconnect_failed"),d()):(a.on("connect_failed",e),a.options.tryTransportsOnConnectTimeout=!0,a.transport=a.getTransport(a.options.transports),a.redoTransports=!0,a.connect()):(a.reconnectionDelay*=2,a.connect(),a.emit("reconnecting",[a.reconnectionDelay,a.reconnectionAttempts]),a.reconnectionTimer=setTimeout(e,a.reconnectionDelay))}else d()}function d(){a.connected&&a.emit("reconnect",[a.transport.type,a.reconnectionAttempts]),a.removeEvent("connect_failed",e).removeEvent("connect",e),delete a.reconnecting,delete a.reconnectionAttempts,delete a.reconnectionDelay,delete a.reconnectionTimer,delete a.redoTransports,a.options.tryTransportsOnConnectTimeout=b,a.options.rememberTransport=c;return}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options.reconnectionDelay;var a=this,b=this.options.tryTransportsOnConnectTimeout,c=this.options.rememberTransport;this.options.tryTransportsOnConnectTimeout=!1,this.reconnectionTimer=setTimeout(e,this.reconnectionDelay),this.on("connect",e)},b.prototype.fire=b.prototype.emit,b.prototype.addListener=b.prototype.addEvent=b.prototype.addEventListener=b.prototype.on,b.prototype.removeListener=b.prototype.removeEventListener=b.prototype.removeEvent}()}(),function(){var b=a._5={exports:{}},c=b.exports,d=a._1.exports,e=a._2.exports,f=a._3.exports;a._4.exports;var g=d.bind,h=d.forEach,i=d.copyArray;fin=new function(){function b(a){console.log("fin error:",a)}this.connect=function(a,c,d){this._socket&&b("fin.connect has already been called"),this._doConnect(a,c,d)},this.create=function(a,c){typeof c!="function"&&b("Second argument to fin.create should be a callback");for(var d in a)a[d]instanceof Array&&!a[d].length&&delete a[d];this.requestResponse("create",{data:a},c)},this.observe=function(a,c,d){(typeof a!="number"||!c||!d)&&b("observe requires three arguments: "+[itemId,c,d?"function":d].join(" "));return this._observeChain(a,c,0,d,{})},this.set=function(a,b,c){this._mutate("set",a,b,[c])},this.release=function(a){var b=this._subIdToKey[a],c=f.getKeyInfo(b),d=c.id;this._subscriptionPool.remove(b,a),this._subscriptionPool.count(b)==0&&(d!=this._localID&&this.request("unsubscribe",{id:d,property:c.property}),delete this._mutationCache[b],delete this._listLength[b]),delete this._subIdToKey[a],this._chainDependants[a]&&(this.release(this._chainDependants[a]),delete this._chainDependants[a])},this.getCachedMutation=function(a,b){var c=this._getItemID(a),d=f.getItemPropertyKey(c,b);return this._mutationCache[d]},this.observeSet=function(a,b,c){this._observe({id:a,property:b,type:"SET"},c)},this.addToSet=function(a,b,c){this._mutate("sadd",a,b,[c])},this.removeFromSet=function(a,b,c){this._mutate("srem",a,b,[c])},this.observeList=function(a,c,d,e){(typeof a!="number"||!c||!d)&&b("observe requires at least three arguments: "+[itemName,c,d?"function":d,e].join(" "));var f=this._observeChain(a,c,0,d,{snapshot:!1});this.extendList(a,c,e);return f},this._listLength={},this.extendList=function(a,c,d){(typeof a!="number"||!c)&&b("extendList requires a numeric ID and a property: "+[itemID,c].join(" ")),this._resolvePropertyChain(a,c,g(this,function(a){var b=this._getItemID(a.id),c=a.property,e=f.getItemPropertyKey(b,c),h=this._listLength[e]||0;if(!(d<=h)){this._listLength[e]=d;var i={id:b,property:c,from:h};d&&(i.to=d),this.requestResponse("extend_list",i,g(this,function(a){var d={id:b,property:c,op:"push",args:a,index:h};this._handleMutation(d)}))}}))},this.push=function(a,b){var c=Array.prototype.slice.call(arguments,2);this._listOp(a,b,"push",c)},this.unshift=function(a,b){var c=Array.prototype.slice.call(arguments,2);this._listOp(a,b,"unshift",c)},this.request=function(a,b,c){b=b||{},b.request=a,this._send(b,c)},this.requestResponse=function(a,b,c,d){var e=this._scheduleCallback(c);b.request=a,b._requestId=e,this._send(b,d)},this._send=function(a,b){var c=this._transactionStack[this._transactionStack.length-1];c&&b?this._transactions[c].actions.push(a):this._socket.send(a)},this.handle=function(a,b){this._eventHandlers[a]=b},this.transact=function(a){var b="t"+this._uniqueRequestId++;this._transactions[b]={waitingFor:1,actions:[]},this._transactionStack.push(b),a(b),this._endTransaction(b)},this._endTransaction=function(a){var c=this._transactionStack.pop();c!=a&&b("transaction ID mismatch in _endTransaction! "+c+" "+a);--this._transactions[c].waitingFor||(this.request("transact",{actions:this._transactions[c].actions}),delete this._transactions[c])};var a={resume:function(){},complete:function(){}};this._holdTransaction=function(){var b=this._transactionStack[this._transactionStack.length-1];if(!b)return a;this._transactions[b].waitingFor++;var c=function(){fin._transactionStack.push(b)},d=function(){fin._endTransaction(b)};return{resume:c,complete:d}},this.focus=function(a,b,c){var d=this._client.getSessionID(),e=f.getFocusProperty(b),h={session:d,user:gUserId,time:this.now()},i,j,k;this.set(a,e,JSON.stringify(h)),j={id:a,property:e,useCache:!1,snapshot:!1},i=this._observe(j,g(this,function(a,b){if(!!i){var e;try{e=JSON.parse(b)}catch(f){}if(!e||e.session==d)return;k(),c(e)}})),k=g(this,function(){!i||(this.release(i),i=null,this.set(a,e,null))});return k},this.now=function(){return(new Date).getTime()},this._init=function(){this._requestCallbacks={},this._eventHandlers={},this._transactions={},this._transactionStack=[],this.handle("mutation",g(this,"_onMutationMessage"))},this._doConnect=function(a,b,c){this._socket=new io.Socket(a,{port:b,connectTimeout:500,transports:"websocket,xhr-multipart,flashsocket,htmlfile,xhr-polling,jsonp-polling".split(",")}),this._socket.on("connect",g(this,c)).on("message",g(this,"_handleMessage")).on("disconnect",g(this,"_handleDisconnect")),this._socket.connect()},this._onMutationMessage=function(a){var b=JSON.parse(a);this._handleMutation(b)},this._handleMessage=function(a){a.response?this._executeCallback(a.response,a.data):this._eventHandlers[a.event]?this._eventHandlers[a.event](a.data):b("received unknown message: "+JSON.stringify(a))},this._handleDisconnect=function(){console.log("_handleDisconnect",arguments)},this._listOp=function(a,b,c,d){this._mutate(c,a,b,d)},this._chainDependants={},this._observeChain=function(a,b,c,d,e){var f=typeof b=="string"?b.split("."):b,b=f[c],h,i,j;if(c==f.length-1){e.id=a,e.property=b;return this._observe(e,d)}return h=this._observe({id:a,property:b},g(this,function(a,b){b!=j&&(j=b,i&&this.release(i),i=this._observeChain(b,f,c+1,d,e),this._chainDependants[h]=i)}))},this._getItemID=function(a){return a=="LOCAL"?this._localID:a=="GLOBAL"?this._globalID:a},this._subIdToKey={},this._subscriptionPool=new e,this._observe=function(a,c){var d=this._getItemID(a.id),e=a.property,g=this._subscriptionPool,h=f.getItemPropertyKey(d,e),i=g.add(h,c),j=a.type||"BYTES",k=this._mutationCache[h];d==this._localID&&!k&&(k=this._getNullMutation(j));if(d!=this._localID&&g.count(h)==1){typeof d!="number"&&b("Expected numeric ID but got: "+d);var l={id:d,property:e,type:j};typeof a.snapshot!="undefined"&&(l.snapshot=a.snapshot),this.request("observe",l)}else k&&a.useCache!==!1&&this._handleMutation(k,c);this._subIdToKey[i]=h;return i},this._getNullMutation=function(a){var b;switch(a){case"LIST":b={op:"push",args:[]};case"BYTES":default:b={op:"set",args:[""],value:""}}return b},this._resolvePropertyChain=function(a,b,c){var d=typeof b=="string"?b.split("."):i(b);d.pop();if(!d.length)c(this._resolveCachedPropertyChain(a,b));else var e=this._observeChain(a,d,0,g(this,function(){c(this._resolveCachedPropertyChain(a,b)),setTimeout(g(this,function(){this.release(e)}),0)}),{})},this._resolveCachedPropertyChain=function(a,b){var c=typeof b=="string"?b.split("."):i(b);while(c.length>1)a=this.getCachedMutation(a,c.shift()).value;return{id:a,property:c[0]}},this._localID=-1,this._globalID=0,this._mutate=function(a,b,c,d){var e=this._resolveCachedPropertyChain(b,c),f=this._getItemID(e.id),g={op:a,args:d,id:f,property:e.property};f!=this._localID&&this.request("mutate",{mutation:g},!0),this._handleMutation(g)},this._deserializeMutation=function(a){var c=a.args,d=a.op;switch(d){case"set":a.value=c[0];break;case"push":case"unshift":case"sadd":case"srem":for(var e=0;e<c.length;e++)c[e]=c[e];break;case"increment":case"decrement":c.length&&b("Argument for operation without signature: "+d);break;case"add":case"subtract":c.length!=1&&b("Missing argument for: "+d);break;default:b("Unknown operation for deserialization: "+d)}},this._mutationCache={},this._handleMutation=function(a,b){if(b){var c=[a.op].concat(a.args);b(a,a.value)}else{var d=f.getItemPropertyKey(a.id,a.property),e=this._subscriptionPool.get(d);this._deserializeMutation(a),this._cacheMutation(a,d);for(var g in e)e[g](a,a.value)}},this._cacheMutation=function(a,c){var d=this._mutationCache,e=d[c],f=e&&e.args,g=e&&e.value;if(!e)return d[c]=a;switch(a.op){case"set":d[c]=a;break;case"push":e.args=e.args.concat(a.args);break;case"unshift":e.args=a.args.concat(e.args);break;case"sadd":for(var h=0,i;i=a.args[h];h++)f.indexOf(i)==-1&&f.push(i);break;case"srem":for(var h=0,i;i=a.args[h];h++)f.splice(f.indexOf(i),1);break;case"increment":e.value=a.value=(g||0)+1;break;case"decrement":e.value=a.value=(g||0)-1;break;case"add":e.value=a.value=(g||0)+a.args[0];break;case"subtract":e.value=a.value=(g||0)-a.args[0];break;default:b("Unknown operation for caching: "+a.op)}return d[c]},this._uniqueRequestId=0,this._scheduleCallback=function(a){var b="r"+this._uniqueRequestId++;this._requestCallbacks[b]=a;return b},this._executeCallback=function(a,b){var c=this._requestCallbacks[a];delete this._requestCallbacks[a],c(b)},this._init()}}(),function(){function o(a){r(this,"removeFromSet",a)}function n(a){r(this,"addToSet",a)}function m(a){r(this,"unshift",a)}function l(a){r(this,"push",a)}function k(a){var b=this._propertyID,c=fin._holdTransaction();fin.models._waitForID(this._parent,function(d){c.resume(),fin.set(d,[b],a),c.complete()})}function j(a,b){p(this,function(c,d){d==a&&b(c,d)})}function i(a){p(this,function(b,c){a(b,c)})}function h(a,b){this._value=a,this._of=b,this._ofCustomModel=!!fin.models[this._of]}function g(a,b){this._value=a,this._of=b,this._ofCustomModel=!!fin.models[this._of]}function f(a){this._value=a}var b=a._6={exports:{}},c=b.exports;b.exports={Text:f,Number:f,List:g,Set:h};var d=b.exports,e=a._1.exports;f.prototype={observe:i,set:k},g.prototype={observe:i,on:j,push:l,unshift:m},h.prototype={observe:i,on:j,add:n,remove:o};var p=function(a,b){q(a,function(c){var f=a._of;if(f){var g=a instanceof h?"observeSet":"observeList";fin[g](c.id,c.chain,function(c){var g=d[f]||fin.models[f],h=c.op;e.each(c.args,function(c){b.call(a,new g(c),h)})})}else fin.observe(c.id,c.chain,function(c){var d=c.args[0];b.call(a,d,c.op)})})},q=function(a,b){var c=[];while(a._parent)c.unshift(a._propertyID),a=a._parent;fin.models._waitForID(a,function(a){b({id:a,chain:c})})},r=function(a,b,c){function e(c,e){d.resume(),fin[b](c,[a._propertyID],e),d.complete()}var d=fin._holdTransaction();fin.models._waitForID(a._parent,function(b){a._ofCustomModel?fin.models._waitForID(c,function(a){e(b,a)}):e(itemID,c._value)})}}(),function(){function h(){if(this._id)return this;k(this,function(){i(this,function(a){this._id=a,e.each(this._waitingForID,function(b){b(a)}),delete this._waitingForID})});return this}function f(a){var b;typeof a=="number"?this._id=a:b=a,b=b||{};for(var c in this._constructor.description){var d=b[c],f=this._constructor.description[c],i=e.bind(this,g,c,d,f);e.defineGetter(this,c,i)}this._id===undefined&&a!==undefined&&h.call(this)}var b=a._7={exports:{}},c=b.exports;b.exports={_instantiate:f,create:h};var d=a._6.exports,e=a._1.exports,g=function(a,b,c){var e=c.type;if(fin.models[e]){if(typeof b!="object"){var f=fin.models[e];b=new f(b)}}else{var f=d[e];b=new f(b,c.of)}delete this[a],this[a]=b,this[a]._propertyID=c.id,this[a]._parent=this;return this[a]},i=function(a,b){fin.create(j(a),function(c){b.call(a,c)})},j=function(a){var b={};e.each(a._constructor.description,function(c,d){var e=a[d],f=fin.models[c.type]?e._id:e._value;b[c.id]=f});return b},k=function(a,b){function f(){--c||b.call(a)}var c=1;e.each(a._constructor.description,function(b,e){d[b.type]||(c++,fin.models._waitForID(a[e],f))}),f()},l=function(a,b){a._id!==undefined?b(a._id):a._waitingForID?a._waitingForID.push(b):a._waitingForID=[b]}}(),function(){function k(a,b){a||(window.console?console.log("Warning: "+b):alert("Warning: "+b))}function j(a,b){if(!a)throw new Error(b)}function i(a,b){a._id!==undefined?b(a._id):a._waitingForID?a._waitingForID.push(b):a._waitingForID=[b]}function f(a){for(var b in a)g(b,a[b]),h(b,a[b]);fin.models.Global&&(fin.models.global=new fin.models.Global(0)),fin.models.Local&&(fin.models.local=new fin.models.Local(-1))}var b=a._0={exports:{}},c=b.exports;a._5.exports,fin.models={process:f,_waitForID:i};var d=a._7.exports,e=a._6.exports,g=function(a,b){var c=a.charCodeAt(0),f={};j(65<=c&&c<=90,'Model names should start with an upper case letter. "'+a+'" does not.'),j(!fin.models[a],'Model "'+a+'" already exists'),j(!e[a],'Property model "'+a+'" already exists');for(propertyName in b){var g=b[propertyName],c=propertyName.charCodeAt(0),h=g.type,i=g.of,l=h=="List"||h=="Set",m=g.id,n=a+"."+propertyName;l&&j(i,'Collections (Sets and Lists) require the "of" descriptor, e.g. { id:1, type:"List" of:"Number" }. "'+n+'" is a "'+h+'" but it does not have one.'),i&&j(l,'Only collections (Sets and Lists) should have an "of" descriptor. "'+n+'" has one but should not since it is of type "'+h+'".'),j(l==!!i,"Only collections (Sets and Lists) "),j(97<=c&&c<=122,'Property names should start with a lowercase letter. "'+n+'" does not.'),j(typeof m=="number"||typeof m=="string",'Properties need an id. "'+n+'" does not have one.'),k(typeof m=="number",'For better performance property IDs should be numeric. "'+n+'" has ID "'+m+'".'),j(!d[propertyName],'Certain property names would overwrite important model methods. "'+n+'" is such a property - pick a different property name.'),j(!f[m],'Property IDs need to be unique. "'+a+'" has two properties with the id '+m+', "'+a+"."+f[m]+'" and "'+n+'"'),f[m]=propertyName}},h=function(a,b){var c=fin.models[a]=function(b){this._constructor=fin.models[a],this._instantiate.call(this,b)},e=[];for(var f in b)e.push(b[f].id);c.prototype=d,c.description=b}}()